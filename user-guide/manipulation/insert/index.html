


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-5.0.2">
    
    
      
        <title>INSERT - Beam Documentation</title>
      
    
    

      <link rel="stylesheet" href="../../../assets/stylesheets/main.07c9fbf5.min.css">
      
      
    
<link rel="stylesheet" type="text/css" href="../../../css/beam.css"/>

    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../../../docs/theme/css/beam.css">
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#inserting-explicit-new-values" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../../.." title="Beam Documentation" class="md-header-nav__button md-logo" aria-label="Beam Documentation">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,8A3,3 0 0,0 15,5A3,3 0 0,0 12,2A3,3 0 0,0 9,5A3,3 0 0,0 12,8M12,11.54C9.64,9.35 6.5,8 3,8V19C6.5,19 9.64,20.35 12,22.54C14.36,20.35 17.5,19 21,19V8C17.5,8 14.36,9.35 12,11.54Z" /></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z" /></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Beam Documentation
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              INSERT
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" /></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/haskell-beam/beam/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    haskell-beam/beam
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Beam Documentation" class="md-nav__button md-logo" aria-label="Beam Documentation">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,8A3,3 0 0,0 15,5A3,3 0 0,0 12,2A3,3 0 0,0 9,5A3,3 0 0,0 12,8M12,11.54C9.64,9.35 6.5,8 3,8V19C6.5,19 9.64,20.35 12,22.54C14.36,20.35 17.5,19 21,19V8C17.5,8 14.36,9.35 12,11.54Z" /></svg>

    </a>
    Beam Documentation
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/haskell-beam/beam/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    haskell-beam/beam
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../about/faq/" title="Frequently Asked Questions" class="md-nav__link">
      Frequently Asked Questions
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Tutorial
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Tutorial" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Tutorial
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorials/tutorial1/" title="Part 1" class="md-nav__link">
      Part 1
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorials/tutorial2/" title="Part 2" class="md-nav__link">
      Part 2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tutorials/tutorial3/" title="Part 3" class="md-nav__link">
      Part 3
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      User Guide
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="User Guide" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        User Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../models/" title="Models" class="md-nav__link">
      Models
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../databases/" title="Databases" class="md-nav__link">
      Databases
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../backends/" title="Backends" class="md-nav__link">
      Backends
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../expressions/" title="Expressions" class="md-nav__link">
      Expressions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4-5" type="checkbox" id="nav-4-5">
    
    <label class="md-nav__link" for="nav-4-5">
      Queries
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Queries" data-md-level="2">
      <label class="md-nav__title" for="nav-4-5">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Queries
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../queries/basic/" title="Basic Queries" class="md-nav__link">
      Basic Queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../queries/select/" title="More complex SELECTs" class="md-nav__link">
      More complex SELECTs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../queries/ordering/" title="Ordering" class="md-nav__link">
      Ordering
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../queries/relationships/" title="Relationships" class="md-nav__link">
      Relationships
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../queries/aggregates/" title="Aggregates" class="md-nav__link">
      Aggregates
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../queries/combining-queries/" title="Combining queries" class="md-nav__link">
      Combining queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../queries/window-functions/" title="Window functions" class="md-nav__link">
      Window functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../queries/advanced-features/" title="Advanced features" class="md-nav__link">
      Advanced features
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../queries/common-table-expressions/" title="Common table expressions" class="md-nav__link">
      Common table expressions
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../extensibility/" title="Custom queries" class="md-nav__link">
      Custom queries
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4-7" type="checkbox" id="nav-4-7" checked>
    
    <label class="md-nav__link" for="nav-4-7">
      Data Manipulation
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Data Manipulation" data-md-level="2">
      <label class="md-nav__title" for="nav-4-7">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Data Manipulation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        INSERT
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,9H17V7H3V9M3,13H17V11H3V13M3,17H17V15H3V17M19,17H21V15H19V17M19,7V9H21V7H19M19,13H21V11H19V13Z" /></svg>
        </span>
      </label>
    
    <a href="./" title="INSERT" class="md-nav__link md-nav__link--active">
      INSERT
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#inserting-explicit-new-values" class="md-nav__link">
    Inserting explicit new values
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inserting-calculated-values" class="md-nav__link">
    Inserting calculated values
  </a>
  
    <nav class="md-nav" aria-label="Inserting calculated values">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#retrieving-the-rows-inserted" class="md-nav__link">
    Retrieving the rows inserted
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inserting-from-the-result-of-a-select-statement" class="md-nav__link">
    Inserting from the result of a SELECT statement
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#choosing-a-subset-of-columns" class="md-nav__link">
    Choosing a subset of columns
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inserting-nothing" class="md-nav__link">
    Inserting nothing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#on-conflict" class="md-nav__link">
    ON CONFLICT
  </a>
  
    <nav class="md-nav" aria-label="ON CONFLICT">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#acting-on-any-conflict" class="md-nav__link">
    Acting on any conflict
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#acting-only-on-certain-conflicts" class="md-nav__link">
    Acting only on certain conflicts
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../update/" title="UPDATE" class="md-nav__link">
      UPDATE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../delete/" title="DELETE" class="md-nav__link">
      DELETE
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Schema management
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Schema management" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Schema management
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../schema-guide/migrations/" title="The Migrations Framework" class="md-nav__link">
      The Migrations Framework
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../schema-guide/tool/" title="The beam-migrate tool" class="md-nav__link">
      The beam-migrate tool
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../schema-guide/library/" title="The beam-migrate library" class="md-nav__link">
      The beam-migrate library
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Backends
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Backends" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Backends
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../backends/beam-postgres/" title="beam-postgres" class="md-nav__link">
      beam-postgres
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../backends/beam-sqlite/" title="beam-sqlite" class="md-nav__link">
      beam-sqlite
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../custom-backends/" title="Writing a Custom Backend" class="md-nav__link">
      Writing a Custom Backend
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      About
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="About" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        About
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../about/compatibility/" title="Compatibility Matrix" class="md-nav__link">
      Compatibility Matrix
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../about/license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../about/release-notes/" title="Release Notes" class="md-nav__link">
      Release Notes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#inserting-explicit-new-values" class="md-nav__link">
    Inserting explicit new values
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inserting-calculated-values" class="md-nav__link">
    Inserting calculated values
  </a>
  
    <nav class="md-nav" aria-label="Inserting calculated values">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#retrieving-the-rows-inserted" class="md-nav__link">
    Retrieving the rows inserted
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inserting-from-the-result-of-a-select-statement" class="md-nav__link">
    Inserting from the result of a SELECT statement
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#choosing-a-subset-of-columns" class="md-nav__link">
    Choosing a subset of columns
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inserting-nothing" class="md-nav__link">
    Inserting nothing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#on-conflict" class="md-nav__link">
    ON CONFLICT
  </a>
  
    <nav class="md-nav" aria-label="ON CONFLICT">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#acting-on-any-conflict" class="md-nav__link">
    Acting on any conflict
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#acting-only-on-certain-conflicts" class="md-nav__link">
    Acting only on certain conflicts
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/haskell-beam/beam/edit/master/docs/user-guide/manipulation/insert.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z" /></svg>
                  </a>
                
                
                  
                
                
                  <h1>INSERT</h1>
                
                <p>SQL <code>INSERT</code> expressions allow you to insert rows in the database.</p>
<p>There is a lot of variety in how you can provide new data, and Beam supports all
standard ways.</p>
<p>The <code>insert</code> function from <code>Database.Beam.Query</code> can be used to insert rows into
a particular table. <code>insert</code> takes a table and a source of values, represented
by <code>SqlInsertValues</code>, and returns a <code>SqlInsert</code> object that can be run in a
<code>MonadBeam</code> with <code>runInsert</code>.</p>
<p>The <code>SqlInsertValues</code> type takes two type parameters. The first is the
underlying database syntax, and the second is the shape of the data it carries,
specified as a beam table type. For example, a source of values in Postgres that
can be inserted in the Chinook customers table would have the type
<code>SqlInsertValues PgInsertValuesSyntax CustomerT</code>. This abstracts over where
those values actually are. The values may be explicit haskell values,
expressions returning customers, a query returning customers, or something
else. Either way, they can all be used in the same way with the <code>insert</code>
function.</p>
<h2 id="inserting-explicit-new-values">Inserting explicit new values</h2>
<p>If you have a record of explicit Haskell values, use the <code>insertValues</code>
function. For example, to insert a new playlist into our chinook database</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item">
            <a href="#tab-0-Haskell" aria-controls="tab-0-Haskell" role="tab" data-toggle="tab" data-lang="haskell">Haskell</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-0-Postgres" aria-controls="tab-0-Postgres" role="tab" data-toggle="tab" data-lang="sql">Postgres</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-0-Sqlite" aria-controls="tab-0-Sqlite" role="tab" data-toggle="tab" data-lang="sql">Sqlite</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-0-Haskell">
            <div class="codehilite"><pre><span></span><code><span class="nf">runInsert</span> <span class="o">$</span> <span class="n">insert</span> <span class="p">(</span><span class="n">playlist</span> <span class="n">chinookDb</span><span class="p">)</span> <span class="o">$</span>
  <span class="n">insertValues</span> <span class="p">[</span> <span class="kt">Playlist</span> <span class="mi">700</span> <span class="p">(</span><span class="kt">Just</span> <span class="s">&quot;My New Playlist&quot;</span><span class="p">)</span>
               <span class="p">,</span> <span class="kt">Playlist</span> <span class="mi">701</span> <span class="p">(</span><span class="kt">Just</span> <span class="s">&quot;Another Playlist&quot;</span><span class="p">)</span>
               <span class="p">,</span> <span class="kt">Playlist</span> <span class="mi">702</span> <span class="p">(</span><span class="kt">Just</span> <span class="s">&quot;Look... more playlists&quot;</span><span class="p">)</span> <span class="p">]</span>

<span class="nf">insertedPlaylists</span> <span class="ow">&lt;-</span>
  <span class="n">runSelectReturningList</span> <span class="o">$</span>
  <span class="n">select</span> <span class="o">$</span> <span class="n">filter_</span> <span class="p">(</span><span class="nf">\</span><span class="n">p</span> <span class="ow">-&gt;</span> <span class="n">playlistId</span> <span class="n">p</span> <span class="o">&gt;=.</span> <span class="mi">700</span><span class="p">)</span> <span class="o">$</span>
  <span class="n">all_</span> <span class="p">(</span><span class="n">playlist</span> <span class="n">chinookDb</span><span class="p">)</span>

<span class="nf">putStrLn</span> <span class="s">&quot;Inserted playlists:&quot;</span>
<span class="nf">forM_</span> <span class="n">insertedPlaylists</span> <span class="o">$</span> <span class="nf">\</span><span class="n">p</span> <span class="ow">-&gt;</span>
  <span class="n">putStrLn</span> <span class="p">(</span><span class="n">show</span> <span class="n">p</span><span class="p">)</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-0-Postgres">
            <div class="codehilite"><pre><span></span><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="ss">&quot;Playlist&quot;</span><span class="p">(</span><span class="ss">&quot;PlaylistId&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;Name&quot;</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="mi">700</span><span class="p">,</span> <span class="s1">&#39;My New Playlist&#39;</span><span class="p">),</span>
       <span class="p">(</span><span class="mi">701</span><span class="p">,</span> <span class="s1">&#39;Another Playlist&#39;</span><span class="p">),</span>
       <span class="p">(</span><span class="mi">702</span><span class="p">,</span> <span class="s1">&#39;Look... more playlists&#39;</span><span class="p">);</span>


<span class="k">SELECT</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;PlaylistId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span>
<span class="k">FROM</span> <span class="ss">&quot;Playlist&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span>
<span class="k">WHERE</span> <span class="p">(</span><span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;PlaylistId&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">700</span><span class="p">);</span>

<span class="c1">-- Output: Inserted playlists:</span>
<span class="c1">-- Output: Playlist {playlistId = 700, playlistName = Just &quot;My New Playlist&quot;}</span>
<span class="c1">-- Output: Playlist {playlistId = 701, playlistName = Just &quot;Another Playlist&quot;}</span>
<span class="c1">-- Output: Playlist {playlistId = 702, playlistName = Just &quot;Look... more playlists&quot;}</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-0-Sqlite">
            <div class="codehilite"><pre><span></span><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="ss">&quot;Playlist&quot;</span><span class="p">(</span><span class="ss">&quot;PlaylistId&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;Name&quot;</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">),</span>
       <span class="p">(</span><span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">),</span>
       <span class="p">(</span><span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">);</span>

<span class="c1">-- With values: [SQLInteger 700,SQLText &quot;My New Playlist&quot;,SQLInteger 701,SQLText &quot;Another Playlist&quot;,SQLInteger 702,SQLText &quot;Look... more playlists&quot;];</span>

<span class="k">SELECT</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;PlaylistId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span>
<span class="k">FROM</span> <span class="ss">&quot;Playlist&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span>
<span class="k">WHERE</span> <span class="p">(</span><span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;PlaylistId&quot;</span><span class="p">)</span><span class="o">&gt;=</span><span class="p">(</span><span class="o">?</span><span class="p">);</span>

<span class="c1">-- With values: [SQLInteger 700];</span>
<span class="c1">-- Output: Inserted playlists:</span>
<span class="c1">-- Output: Playlist {playlistId = 700, playlistName = Just &quot;My New Playlist&quot;}</span>
<span class="c1">-- Output: Playlist {playlistId = 701, playlistName = Just &quot;Another Playlist&quot;}</span>
<span class="c1">-- Output: Playlist {playlistId = 702, playlistName = Just &quot;Look... more playlists&quot;}</span>
</code></pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<h2 id="inserting-calculated-values">Inserting calculated values</h2>
<p>Inserting explicit values is all well and good, but sometimes we want to defer
some processing to the database. For example, perhaps we want to create a new
invoice and use the current time as the invoice date. We could grab the current
time using <code>getCurrentTime</code> and then use this to construct an explicit Haskell
value, but this may cause synchronization issues for our application. To do
this, beam allows us to specify arbitrary expressions as a source of values
using the <code>insertExpressions</code> function.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item">
            <a href="#tab-1-Haskell" aria-controls="tab-1-Haskell" role="tab" data-toggle="tab" data-lang="haskell">Haskell</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-1-Postgres" aria-controls="tab-1-Postgres" role="tab" data-toggle="tab" data-lang="sql">Postgres</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-1-Sqlite" aria-controls="tab-1-Sqlite" role="tab" data-toggle="tab" data-lang="sql">Sqlite</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-1-Haskell">
            <div class="codehilite"><pre><span></span><code><span class="nf">runInsert</span> <span class="o">$</span> <span class="n">insert</span> <span class="p">(</span><span class="n">invoice</span> <span class="n">chinookDb</span><span class="p">)</span> <span class="o">$</span>
  <span class="n">insertExpressions</span> <span class="p">[</span> <span class="kt">Invoice</span> <span class="p">(</span><span class="n">val_</span> <span class="mi">800</span><span class="p">)</span> <span class="p">(</span><span class="kt">CustomerId</span> <span class="p">(</span><span class="n">val_</span> <span class="mi">1</span><span class="p">))</span> <span class="n">currentTimestamp_</span>
                              <span class="p">(</span><span class="n">val_</span> <span class="p">(</span><span class="kt">Address</span> <span class="p">(</span><span class="kt">Just</span> <span class="s">&quot;123 My Street&quot;</span><span class="p">)</span> <span class="p">(</span><span class="kt">Just</span> <span class="s">&quot;Buenos Noches&quot;</span><span class="p">)</span> <span class="p">(</span><span class="kt">Just</span> <span class="s">&quot;Rio&quot;</span><span class="p">)</span> <span class="p">(</span><span class="kt">Just</span> <span class="s">&quot;Mozambique&quot;</span><span class="p">)</span> <span class="p">(</span><span class="kt">Just</span> <span class="s">&quot;ABCDEF&quot;</span><span class="p">)))</span>
                              <span class="p">(</span><span class="n">val_</span> <span class="mi">1000</span><span class="p">)</span> <span class="p">]</span>

<span class="kt">Just</span> <span class="n">newInvoice</span> <span class="ow">&lt;-</span>
  <span class="n">runSelectReturningOne</span> <span class="o">$</span>
  <span class="n">lookup_</span> <span class="p">(</span><span class="n">invoice</span> <span class="n">chinookDb</span><span class="p">)</span> <span class="p">(</span><span class="kt">InvoiceId</span> <span class="mi">800</span><span class="p">)</span>

<span class="nf">putStrLn</span> <span class="p">(</span><span class="s">&quot;Inserted invoice: &quot;</span> <span class="o">++</span> <span class="n">show</span> <span class="n">newInvoice</span><span class="p">)</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-1-Postgres">
            <div class="codehilite"><pre><span></span><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="ss">&quot;Invoice&quot;</span><span class="p">(</span><span class="ss">&quot;InvoiceId&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;CustomerId&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;InvoiceDate&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;BillingAddress&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;BillingCity&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;BillingState&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;BillingCountry&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;BillingPostalCode&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;Total&quot;</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="mi">800</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="k">CURRENT_TIMESTAMP</span><span class="p">,</span> <span class="s1">&#39;123 My Street&#39;</span><span class="p">,</span> <span class="s1">&#39;Buenos Noches&#39;</span><span class="p">,</span> <span class="s1">&#39;Rio&#39;</span><span class="p">,</span> <span class="s1">&#39;Mozambique&#39;</span><span class="p">,</span> <span class="s1">&#39;ABCDEF&#39;</span><span class="p">,</span> <span class="s1">&#39;1000.0&#39;</span><span class="p">);</span>


<span class="k">SELECT</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;InvoiceId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;CustomerId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;InvoiceDate&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res2&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;BillingAddress&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res3&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;BillingCity&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res4&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;BillingState&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res5&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;BillingCountry&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res6&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;BillingPostalCode&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res7&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Total&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res8&quot;</span>
<span class="k">FROM</span> <span class="ss">&quot;Invoice&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span>
<span class="k">WHERE</span> <span class="p">(</span><span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;InvoiceId&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">800</span><span class="p">);</span>

<span class="c1">-- Output: Inserted invoice: Invoice {invoiceId = SqlSerial {unSerial = 800}, invoiceCustomer = CustomerId 1, invoiceDate = 2022-01-18 01:31:21.436807, invoiceBillingAddress = Address {address = Just &quot;123 My Street&quot;, addressCity = Just &quot;Buenos Noches&quot;, addressState = Just &quot;Rio&quot;, addressCountry = Just &quot;Mozambique&quot;, addressPostalCode = Just &quot;ABCDEF&quot;}, invoiceTotal = 1000.0}</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-1-Sqlite">
            <div class="codehilite"><pre><span></span><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="ss">&quot;Invoice&quot;</span><span class="p">(</span><span class="ss">&quot;InvoiceId&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;CustomerId&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;InvoiceDate&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;BillingAddress&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;BillingCity&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;BillingState&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;BillingCountry&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;BillingPostalCode&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;Total&quot;</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="k">CURRENT_TIMESTAMP</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">);</span>

<span class="c1">-- With values: [SQLInteger 800,SQLInteger 1,SQLText &quot;123 My Street&quot;,SQLText &quot;Buenos Noches&quot;,SQLText &quot;Rio&quot;,SQLText &quot;Mozambique&quot;,SQLText &quot;ABCDEF&quot;,SQLText &quot;1000.0&quot;];</span>

<span class="k">SELECT</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;InvoiceId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;CustomerId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;InvoiceDate&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res2&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;BillingAddress&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res3&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;BillingCity&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res4&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;BillingState&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res5&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;BillingCountry&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res6&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;BillingPostalCode&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res7&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Total&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res8&quot;</span>
<span class="k">FROM</span> <span class="ss">&quot;Invoice&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span>
<span class="k">WHERE</span> <span class="p">(</span><span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;InvoiceId&quot;</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="o">?</span><span class="p">);</span>

<span class="c1">-- With values: [SQLInteger 800];</span>
<span class="c1">-- Output: Inserted invoice: Invoice {invoiceId = SqlSerial {unSerial = 800}, invoiceCustomer = CustomerId 1, invoiceDate = 2022-01-18 01:31:24, invoiceBillingAddress = Address {address = Just &quot;123 My Street&quot;, addressCity = Just &quot;Buenos Noches&quot;, addressState = Just &quot;Rio&quot;, addressCountry = Just &quot;Mozambique&quot;, addressPostalCode = Just &quot;ABCDEF&quot;}, invoiceTotal = 1000.0}</span>
</code></pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<p><code>insertExpressions</code> is strictly more general than <code>insertValues</code>. We can turn
any <code>insertValues</code> to an <code>insertExpressions</code> by running every table value
through the <code>val_</code> function to convert a Haskell literal to an expression.</p>
<p>For example, we can write the playlist example above as</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item">
            <a href="#tab-2-Haskell" aria-controls="tab-2-Haskell" role="tab" data-toggle="tab" data-lang="haskell">Haskell</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-2-Postgres" aria-controls="tab-2-Postgres" role="tab" data-toggle="tab" data-lang="sql">Postgres</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-2-Sqlite" aria-controls="tab-2-Sqlite" role="tab" data-toggle="tab" data-lang="sql">Sqlite</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-2-Haskell">
            <div class="codehilite"><pre><span></span><code><span class="nf">runInsert</span> <span class="o">$</span> <span class="n">insert</span> <span class="p">(</span><span class="n">playlist</span> <span class="n">chinookDb</span><span class="p">)</span> <span class="o">$</span>
  <span class="n">insertExpressions</span> <span class="p">[</span> <span class="n">val_</span> <span class="o">$</span> <span class="kt">Playlist</span> <span class="mi">700</span> <span class="p">(</span><span class="kt">Just</span> <span class="s">&quot;My New Playlist&quot;</span><span class="p">)</span>
                    <span class="p">,</span> <span class="n">val_</span> <span class="o">$</span> <span class="kt">Playlist</span> <span class="mi">701</span> <span class="p">(</span><span class="kt">Just</span> <span class="s">&quot;Another Playlist&quot;</span><span class="p">)</span>
                    <span class="p">,</span> <span class="n">val_</span> <span class="o">$</span> <span class="kt">Playlist</span> <span class="mi">702</span> <span class="p">(</span><span class="kt">Just</span> <span class="s">&quot;Look... more playlists&quot;</span><span class="p">)</span> <span class="p">]</span>

<span class="nf">insertedPlaylists</span> <span class="ow">&lt;-</span>
  <span class="n">runSelectReturningList</span> <span class="o">$</span>
  <span class="n">select</span> <span class="o">$</span> <span class="n">filter_</span> <span class="p">(</span><span class="nf">\</span><span class="n">p</span> <span class="ow">-&gt;</span> <span class="n">playlistId</span> <span class="n">p</span> <span class="o">&gt;=.</span> <span class="mi">700</span><span class="p">)</span> <span class="o">$</span>
  <span class="n">all_</span> <span class="p">(</span><span class="n">playlist</span> <span class="n">chinookDb</span><span class="p">)</span>

<span class="nf">putStrLn</span> <span class="s">&quot;Inserted playlists:&quot;</span>
<span class="nf">forM_</span> <span class="n">insertedPlaylists</span> <span class="o">$</span> <span class="nf">\</span><span class="n">p</span> <span class="ow">-&gt;</span>
  <span class="n">putStrLn</span> <span class="p">(</span><span class="n">show</span> <span class="n">p</span><span class="p">)</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-2-Postgres">
            <div class="codehilite"><pre><span></span><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="ss">&quot;Playlist&quot;</span><span class="p">(</span><span class="ss">&quot;PlaylistId&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;Name&quot;</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="mi">700</span><span class="p">,</span> <span class="s1">&#39;My New Playlist&#39;</span><span class="p">),</span>
       <span class="p">(</span><span class="mi">701</span><span class="p">,</span> <span class="s1">&#39;Another Playlist&#39;</span><span class="p">),</span>
       <span class="p">(</span><span class="mi">702</span><span class="p">,</span> <span class="s1">&#39;Look... more playlists&#39;</span><span class="p">);</span>


<span class="k">SELECT</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;PlaylistId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span>
<span class="k">FROM</span> <span class="ss">&quot;Playlist&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span>
<span class="k">WHERE</span> <span class="p">(</span><span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;PlaylistId&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">700</span><span class="p">);</span>

<span class="c1">-- Output: Inserted playlists:</span>
<span class="c1">-- Output: Playlist {playlistId = 700, playlistName = Just &quot;My New Playlist&quot;}</span>
<span class="c1">-- Output: Playlist {playlistId = 701, playlistName = Just &quot;Another Playlist&quot;}</span>
<span class="c1">-- Output: Playlist {playlistId = 702, playlistName = Just &quot;Look... more playlists&quot;}</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-2-Sqlite">
            <div class="codehilite"><pre><span></span><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="ss">&quot;Playlist&quot;</span><span class="p">(</span><span class="ss">&quot;PlaylistId&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;Name&quot;</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">),</span>
       <span class="p">(</span><span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">),</span>
       <span class="p">(</span><span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">);</span>

<span class="c1">-- With values: [SQLInteger 700,SQLText &quot;My New Playlist&quot;,SQLInteger 701,SQLText &quot;Another Playlist&quot;,SQLInteger 702,SQLText &quot;Look... more playlists&quot;];</span>

<span class="k">SELECT</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;PlaylistId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span>
<span class="k">FROM</span> <span class="ss">&quot;Playlist&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span>
<span class="k">WHERE</span> <span class="p">(</span><span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;PlaylistId&quot;</span><span class="p">)</span><span class="o">&gt;=</span><span class="p">(</span><span class="o">?</span><span class="p">);</span>

<span class="c1">-- With values: [SQLInteger 700];</span>
<span class="c1">-- Output: Inserted playlists:</span>
<span class="c1">-- Output: Playlist {playlistId = 700, playlistName = Just &quot;My New Playlist&quot;}</span>
<span class="c1">-- Output: Playlist {playlistId = 701, playlistName = Just &quot;Another Playlist&quot;}</span>
<span class="c1">-- Output: Playlist {playlistId = 702, playlistName = Just &quot;Look... more playlists&quot;}</span>
</code></pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<p>One common use of <code>insertExpressions_</code> is when adding new rows to tables where
one field needs to be set to the default value. For example, auto-incrementing
keys or random UUIDs are a common way to assign primary keys to rows. You can
use <code>insertExpressions_</code> using the <code>default_</code> expression for each column that
you want to use the default value for.</p>
<p>For example, the query below adds a new invoice asking the database to assign a
new id.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item">
            <a href="#tab-3-Haskell" aria-controls="tab-3-Haskell" role="tab" data-toggle="tab" data-lang="haskell">Haskell</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-3-Postgres" aria-controls="tab-3-Postgres" role="tab" data-toggle="tab" data-lang="sql">Postgres</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-3-Haskell">
            <div class="codehilite"><pre><span></span><code><span class="nf">runInsert</span> <span class="o">$</span> <span class="n">insert</span> <span class="p">(</span><span class="n">invoice</span> <span class="n">chinookDb</span><span class="p">)</span> <span class="o">$</span>
  <span class="n">insertExpressions</span> <span class="p">[</span> <span class="kt">Invoice</span> <span class="n">default_</span> <span class="c1">-- Ask the database to give us a default id</span>
                              <span class="p">(</span><span class="n">val_</span> <span class="p">(</span><span class="kt">CustomerId</span> <span class="mi">1</span><span class="p">))</span> <span class="n">currentTimestamp_</span>
                              <span class="p">(</span><span class="n">val_</span> <span class="p">(</span><span class="kt">Address</span> <span class="p">(</span><span class="kt">Just</span> <span class="s">&quot;123 My Street&quot;</span><span class="p">)</span> <span class="p">(</span><span class="kt">Just</span> <span class="s">&quot;Buenos Noches&quot;</span><span class="p">)</span> <span class="p">(</span><span class="kt">Just</span> <span class="s">&quot;Rio&quot;</span><span class="p">)</span> <span class="p">(</span><span class="kt">Just</span> <span class="s">&quot;Mozambique&quot;</span><span class="p">)</span> <span class="p">(</span><span class="kt">Just</span> <span class="s">&quot;ABCDEF&quot;</span><span class="p">)))</span>
                              <span class="p">(</span><span class="n">val_</span> <span class="mi">1000</span><span class="p">)</span> <span class="p">]</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-3-Postgres">
            <div class="codehilite"><pre><span></span><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="ss">&quot;Invoice&quot;</span><span class="p">(</span><span class="ss">&quot;InvoiceId&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;CustomerId&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;InvoiceDate&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;BillingAddress&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;BillingCity&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;BillingState&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;BillingCountry&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;BillingPostalCode&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;Total&quot;</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="k">DEFAULT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="k">CURRENT_TIMESTAMP</span><span class="p">,</span> <span class="s1">&#39;123 My Street&#39;</span><span class="p">,</span> <span class="s1">&#39;Buenos Noches&#39;</span><span class="p">,</span> <span class="s1">&#39;Rio&#39;</span><span class="p">,</span> <span class="s1">&#39;Mozambique&#39;</span><span class="p">,</span> <span class="s1">&#39;ABCDEF&#39;</span><span class="p">,</span> <span class="s1">&#39;1000.0&#39;</span><span class="p">);</span>
</code></pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>SQLite is a great little backend, but it doesn't support some standard SQL
features, like the <code>DEFAULT</code> keyword in inserts. You can retrieve the same
functionality by only inserting into a subset of columns. See the section on
<a href="#choosing-a-subset-of-columns">that</a> below.</p>
</div>
<h3 id="retrieving-the-rows-inserted">Retrieving the rows inserted</h3>
<p>However, now we have no way of knowing <em>what</em> value the database
assigned. Unfortunately, there is no database-agnostic solution to this
problem. However, it's a common enough use case that beam provides a
backend-agnostic way for some backends. Backends that provide this functionality
provide an instance of <code>MonadBeamInsertReturning</code>. In order to use this class,
you'll need to explicitly import
<code>Database.Beam.Backend.SQL.BeamExtensions</code>. Below, we've imported this module
qualified.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item">
            <a href="#tab-4-Haskell" aria-controls="tab-4-Haskell" role="tab" data-toggle="tab" data-lang="haskell">Haskell</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-4-Postgres" aria-controls="tab-4-Postgres" role="tab" data-toggle="tab" data-lang="sql">Postgres</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-4-Sqlite" aria-controls="tab-4-Sqlite" role="tab" data-toggle="tab" data-lang="sql">Sqlite</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-4-Haskell">
            <div class="codehilite"><pre><span></span><code><span class="p">[</span><span class="n">newInvoice</span><span class="p">]</span> <span class="ow">&lt;-</span>
  <span class="kt">BeamExtensions</span><span class="o">.</span><span class="n">runInsertReturningList</span> <span class="o">$</span> <span class="n">insert</span> <span class="p">(</span><span class="n">invoice</span> <span class="n">chinookDb</span><span class="p">)</span> <span class="o">$</span>
  <span class="n">insertExpressions</span> <span class="p">[</span> <span class="kt">Invoice</span> <span class="n">default_</span> <span class="c1">-- Ask the database to give us a default id</span>
                              <span class="p">(</span><span class="n">val_</span> <span class="p">(</span><span class="kt">CustomerId</span> <span class="mi">1</span><span class="p">))</span> <span class="n">currentTimestamp_</span>
                              <span class="p">(</span><span class="n">val_</span> <span class="p">(</span><span class="kt">Address</span> <span class="p">(</span><span class="kt">Just</span> <span class="s">&quot;123 My Street&quot;</span><span class="p">)</span> <span class="p">(</span><span class="kt">Just</span> <span class="s">&quot;Buenos Noches&quot;</span><span class="p">)</span> <span class="p">(</span><span class="kt">Just</span> <span class="s">&quot;Rio&quot;</span><span class="p">)</span> <span class="p">(</span><span class="kt">Just</span> <span class="s">&quot;Mozambique&quot;</span><span class="p">)</span> <span class="p">(</span><span class="kt">Just</span> <span class="s">&quot;ABCDEF&quot;</span><span class="p">)))</span>
                              <span class="p">(</span><span class="n">val_</span> <span class="mi">1000</span><span class="p">)</span> <span class="p">]</span>

<span class="nf">putStrLn</span> <span class="p">(</span><span class="s">&quot;We inserted a new invoice, and the result was &quot;</span> <span class="o">++</span> <span class="n">show</span> <span class="n">newInvoice</span><span class="p">)</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-4-Postgres">
            <div class="codehilite"><pre><span></span><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="ss">&quot;Invoice&quot;</span><span class="p">(</span><span class="ss">&quot;InvoiceId&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;CustomerId&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;InvoiceDate&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;BillingAddress&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;BillingCity&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;BillingState&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;BillingCountry&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;BillingPostalCode&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;Total&quot;</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="k">DEFAULT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="k">CURRENT_TIMESTAMP</span><span class="p">,</span> <span class="s1">&#39;123 My Street&#39;</span><span class="p">,</span> <span class="s1">&#39;Buenos Noches&#39;</span><span class="p">,</span> <span class="s1">&#39;Rio&#39;</span><span class="p">,</span> <span class="s1">&#39;Mozambique&#39;</span><span class="p">,</span> <span class="s1">&#39;ABCDEF&#39;</span><span class="p">,</span> <span class="s1">&#39;1000.0&#39;</span><span class="p">)</span> <span class="n">RETURNING</span> <span class="ss">&quot;InvoiceId&quot;</span><span class="p">,</span>
                                                                                                                            <span class="ss">&quot;CustomerId&quot;</span><span class="p">,</span>
                                                                                                                            <span class="ss">&quot;InvoiceDate&quot;</span><span class="p">,</span>
                                                                                                                            <span class="ss">&quot;BillingAddress&quot;</span><span class="p">,</span>
                                                                                                                            <span class="ss">&quot;BillingCity&quot;</span><span class="p">,</span>
                                                                                                                            <span class="ss">&quot;BillingState&quot;</span><span class="p">,</span>
                                                                                                                            <span class="ss">&quot;BillingCountry&quot;</span><span class="p">,</span>
                                                                                                                            <span class="ss">&quot;BillingPostalCode&quot;</span><span class="p">,</span>
                                                                                                                            <span class="ss">&quot;Total&quot;</span><span class="p">;</span>

<span class="c1">-- Output: We inserted a new invoice, and the result was Invoice {invoiceId = SqlSerial {unSerial = 501}, invoiceCustomer = CustomerId 1, invoiceDate = 2022-01-18 01:31:34.451145, invoiceBillingAddress = Address {address = Just &quot;123 My Street&quot;, addressCity = Just &quot;Buenos Noches&quot;, addressState = Just &quot;Rio&quot;, addressCountry = Just &quot;Mozambique&quot;, addressPostalCode = Just &quot;ABCDEF&quot;}, invoiceTotal = 1000.0}</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-4-Sqlite">
            <div class="codehilite"><pre><span></span><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="ss">&quot;Invoice&quot;</span><span class="p">(</span><span class="ss">&quot;CustomerId&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;InvoiceDate&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;BillingAddress&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;BillingCity&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;BillingState&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;BillingCountry&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;BillingPostalCode&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;Total&quot;</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="o">?</span><span class="p">,</span> <span class="k">CURRENT_TIMESTAMP</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">);</span>

<span class="c1">-- With values: [SQLInteger 1,SQLText &quot;123 My Street&quot;,SQLText &quot;Buenos Noches&quot;,SQLText &quot;Rio&quot;,SQLText &quot;Mozambique&quot;,SQLText &quot;ABCDEF&quot;,SQLText &quot;1000.0&quot;];</span>
<span class="c1">-- Output: We inserted a new invoice, and the result was Invoice {invoiceId = SqlSerial {unSerial = 413}, invoiceCustomer = CustomerId 1, invoiceDate = 2022-01-18 01:31:37, invoiceBillingAddress = Address {address = Just &quot;123 My Street&quot;, addressCity = Just &quot;Buenos Noches&quot;, addressState = Just &quot;Rio&quot;, addressCountry = Just &quot;Mozambique&quot;, addressPostalCode = Just &quot;ABCDEF&quot;}, invoiceTotal = 1000.0}</span>
</code></pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<p>The pattern match on the single <code>newInvoice</code> is safe, even though its
partial. In general, you can expect the same amount of rows returned as
specified in your <code>SqlInsertValues</code>. If you know what this is statically, then
you can feel free to pattern match directly. Otherwise (if you used
<code>insertFrom</code>, for example), you'll need to handle the possibility that nothing
was inserted.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Although SQLite has no support for the <code>DEFAULT</code> clause,
<code>MonadBeamInsertReturning</code> in <code>beam-sqlite</code> inserts rows one at a time and
will detect usage of the <code>DEFAULT</code> keyword. The beam authors consider this
okay. While most beam statements are guaranteed to translate directly to the
underlying DBMS system, <code>runInsertReturningList</code> is explicitly marked as
emulated functionality.</p>
</div>
<h2 id="inserting-from-the-result-of-a-select-statement">Inserting from the result of a <code>SELECT</code> statement</h2>
<p>Sometimes you want to use existing data to insert values. For example, perhaps
we want to give every customer their own playlist, titled "<name>'s playlist".</p>
<p>We can use the <code>insertFrom</code> function to make a <code>SqlInsertValues</code> corresponding
to the result of a query. Make sure to return a projection with the same 'shape'
as your data. If not, you'll get a compile time error.</p>
<p>For example, to create the playlists as above</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item">
            <a href="#tab-5-Haskell" aria-controls="tab-5-Haskell" role="tab" data-toggle="tab" data-lang="haskell">Haskell</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-5-Postgres" aria-controls="tab-5-Postgres" role="tab" data-toggle="tab" data-lang="sql">Postgres</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-5-Sqlite" aria-controls="tab-5-Sqlite" role="tab" data-toggle="tab" data-lang="sql">Sqlite</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-5-Haskell">
            <div class="codehilite"><pre><span></span><code><span class="nf">runInsert</span> <span class="o">$</span> <span class="n">insert</span> <span class="p">(</span><span class="n">playlist</span> <span class="n">chinookDb</span><span class="p">)</span> <span class="o">$</span>
  <span class="n">insertFrom</span> <span class="o">$</span> <span class="kr">do</span>
    <span class="n">c</span> <span class="ow">&lt;-</span> <span class="n">all_</span> <span class="p">(</span><span class="n">customer</span> <span class="n">chinookDb</span><span class="p">)</span>
    <span class="n">pure</span> <span class="p">(</span><span class="kt">Playlist</span> <span class="p">(</span><span class="n">customerId</span> <span class="n">c</span> <span class="o">+</span> <span class="mi">1000</span><span class="p">)</span> <span class="p">(</span><span class="n">just_</span> <span class="p">(</span><span class="n">concat_</span> <span class="p">[</span> <span class="n">customerFirstName</span> <span class="n">c</span><span class="p">,</span> <span class="s">&quot;&#39;s Playlist&quot;</span> <span class="p">])))</span>

<span class="nf">playlists</span> <span class="ow">&lt;-</span> <span class="n">runSelectReturningList</span> <span class="o">$</span> <span class="n">select</span> <span class="o">$</span> <span class="n">limit_</span> <span class="mi">10</span> <span class="o">$</span>
             <span class="n">orderBy_</span> <span class="p">(</span><span class="nf">\</span><span class="n">p</span> <span class="ow">-&gt;</span> <span class="n">asc_</span> <span class="p">(</span><span class="n">playlistId</span> <span class="n">p</span><span class="p">))</span> <span class="o">$</span>
             <span class="n">filter_</span> <span class="p">(</span><span class="nf">\</span><span class="n">p</span> <span class="ow">-&gt;</span> <span class="n">playlistId</span> <span class="n">p</span> <span class="o">&gt;=.</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">$</span>
             <span class="n">all_</span> <span class="p">(</span><span class="n">playlist</span> <span class="n">chinookDb</span><span class="p">)</span>

<span class="nf">putStrLn</span> <span class="s">&quot;Inserted playlists&quot;</span>
<span class="nf">forM_</span> <span class="n">playlists</span> <span class="o">$</span> <span class="nf">\</span><span class="n">playlist</span> <span class="ow">-&gt;</span>
  <span class="n">putStrLn</span> <span class="p">(</span><span class="s">&quot;  - &quot;</span> <span class="o">++</span> <span class="n">show</span> <span class="n">playlist</span><span class="p">)</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-5-Postgres">
            <div class="codehilite"><pre><span></span><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="ss">&quot;Playlist&quot;</span><span class="p">(</span><span class="ss">&quot;PlaylistId&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;Name&quot;</span><span class="p">)</span>
<span class="k">SELECT</span> <span class="p">(</span><span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;CustomerId&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1000</span><span class="p">)</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
       <span class="n">CONCAT</span><span class="p">(</span><span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;FirstName&quot;</span><span class="p">,</span> <span class="s1">&#39;&#39;&#39;s Playlist&#39;</span><span class="p">)</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span>
<span class="k">FROM</span> <span class="ss">&quot;Customer&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span><span class="p">;</span>


<span class="k">SELECT</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;PlaylistId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span>
<span class="k">FROM</span> <span class="ss">&quot;Playlist&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span>
<span class="k">WHERE</span> <span class="p">(</span><span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;PlaylistId&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;PlaylistId&quot;</span> <span class="k">ASC</span>
<span class="k">LIMIT</span> <span class="mi">10</span><span class="p">;</span>

<span class="c1">-- Output: Inserted playlists</span>
<span class="c1">-- Output:   - Playlist {playlistId = 1001, playlistName = Just &quot;Lu\237s&#39;s Playlist&quot;}</span>
<span class="c1">-- Output:   - Playlist {playlistId = 1002, playlistName = Just &quot;Leonie&#39;s Playlist&quot;}</span>
<span class="c1">-- Output:   - Playlist {playlistId = 1003, playlistName = Just &quot;Fran\231ois&#39;s Playlist&quot;}</span>
<span class="c1">-- Output:   - Playlist {playlistId = 1004, playlistName = Just &quot;Bj\345rn&#39;s Playlist&quot;}</span>
<span class="c1">-- Output:   - Playlist {playlistId = 1005, playlistName = Just &quot;Franti\154ek&#39;s Playlist&quot;}</span>
<span class="c1">-- Output:   - Playlist {playlistId = 1006, playlistName = Just &quot;Helena&#39;s Playlist&quot;}</span>
<span class="c1">-- Output:   - Playlist {playlistId = 1007, playlistName = Just &quot;Astrid&#39;s Playlist&quot;}</span>
<span class="c1">-- Output:   - Playlist {playlistId = 1008, playlistName = Just &quot;Daan&#39;s Playlist&quot;}</span>
<span class="c1">-- Output:   - Playlist {playlistId = 1009, playlistName = Just &quot;Kara&#39;s Playlist&quot;}</span>
<span class="c1">-- Output:   - Playlist {playlistId = 1010, playlistName = Just &quot;Eduardo&#39;s Playlist&quot;}</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-5-Sqlite">
            <div class="codehilite"><pre><span></span><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="ss">&quot;Playlist&quot;</span><span class="p">(</span><span class="ss">&quot;PlaylistId&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;Name&quot;</span><span class="p">)</span>
<span class="k">SELECT</span> <span class="p">(</span><span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;CustomerId&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="o">?</span><span class="p">)</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
       <span class="p">(</span><span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;FirstName&quot;</span> <span class="o">||</span> <span class="p">(</span><span class="o">?</span><span class="p">))</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span>
<span class="k">FROM</span> <span class="ss">&quot;Customer&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span><span class="p">;</span>

<span class="c1">-- With values: [SQLInteger 1000,SQLText &quot;&#39;s Playlist&quot;];</span>

<span class="k">SELECT</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;PlaylistId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span>
<span class="k">FROM</span> <span class="ss">&quot;Playlist&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span>
<span class="k">WHERE</span> <span class="p">(</span><span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;PlaylistId&quot;</span><span class="p">)</span><span class="o">&gt;=</span><span class="p">(</span><span class="o">?</span><span class="p">)</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;PlaylistId&quot;</span> <span class="k">ASC</span>
<span class="k">LIMIT</span> <span class="mi">10</span><span class="p">;</span>

<span class="c1">-- With values: [SQLInteger 1000];</span>
<span class="c1">-- Output: Inserted playlists</span>
<span class="c1">-- Output:   - Playlist {playlistId = 1001, playlistName = Just &quot;Lu\237s&#39;s Playlist&quot;}</span>
<span class="c1">-- Output:   - Playlist {playlistId = 1002, playlistName = Just &quot;Leonie&#39;s Playlist&quot;}</span>
<span class="c1">-- Output:   - Playlist {playlistId = 1003, playlistName = Just &quot;Fran\231ois&#39;s Playlist&quot;}</span>
<span class="c1">-- Output:   - Playlist {playlistId = 1004, playlistName = Just &quot;Bj\248rn&#39;s Playlist&quot;}</span>
<span class="c1">-- Output:   - Playlist {playlistId = 1005, playlistName = Just &quot;Franti\353ek&#39;s Playlist&quot;}</span>
<span class="c1">-- Output:   - Playlist {playlistId = 1006, playlistName = Just &quot;Helena&#39;s Playlist&quot;}</span>
<span class="c1">-- Output:   - Playlist {playlistId = 1007, playlistName = Just &quot;Astrid&#39;s Playlist&quot;}</span>
<span class="c1">-- Output:   - Playlist {playlistId = 1008, playlistName = Just &quot;Daan&#39;s Playlist&quot;}</span>
<span class="c1">-- Output:   - Playlist {playlistId = 1009, playlistName = Just &quot;Kara&#39;s Playlist&quot;}</span>
<span class="c1">-- Output:   - Playlist {playlistId = 1010, playlistName = Just &quot;Eduardo&#39;s Playlist&quot;}</span>
</code></pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<h2 id="choosing-a-subset-of-columns">Choosing a subset of columns</h2>
<p>Above, we used the <code>default_</code> clause to set a column to a default
value. Unfortunately, not all backends support <code>default_</code> (SQLite being a
notable exception). Moreover, some <code>INSERT</code> forms simply can't use <code>default_</code>,
such as <code>insertFrom_</code> (you can't return <code>default_</code> from a query). The standard
SQL tool used in these cases is limiting the inserted data to specific
columns. For example, suppose we want to insert new invoices for every customer
with today's date. We can use the <code>insertOnly</code> function to project which field's
are being inserted.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item">
            <a href="#tab-6-Haskell" aria-controls="tab-6-Haskell" role="tab" data-toggle="tab" data-lang="haskell">Haskell</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-6-Postgres" aria-controls="tab-6-Postgres" role="tab" data-toggle="tab" data-lang="sql">Postgres</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-6-Sqlite" aria-controls="tab-6-Sqlite" role="tab" data-toggle="tab" data-lang="sql">Sqlite</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-6-Haskell">
            <div class="codehilite"><pre><span></span><code><span class="nf">runInsert</span> <span class="o">$</span>
  <span class="n">insertOnly</span> <span class="p">(</span><span class="n">invoice</span> <span class="n">chinookDb</span><span class="p">)</span>
             <span class="p">(</span><span class="nf">\</span><span class="n">i</span> <span class="ow">-&gt;</span> <span class="p">(</span> <span class="n">invoiceCustomer</span> <span class="n">i</span><span class="p">,</span> <span class="n">invoiceDate</span> <span class="n">i</span><span class="p">,</span> <span class="n">invoiceBillingAddress</span> <span class="n">i</span><span class="p">,</span> <span class="n">invoiceTotal</span> <span class="n">i</span> <span class="p">)</span> <span class="p">)</span> <span class="o">$</span>
  <span class="n">insertFrom</span> <span class="o">$</span> <span class="kr">do</span>
    <span class="n">c</span> <span class="ow">&lt;-</span> <span class="n">all_</span> <span class="p">(</span><span class="n">customer</span> <span class="n">chinookDb</span><span class="p">)</span>

    <span class="c1">-- We&#39;ll just charge each customer $10 to be mean!</span>
    <span class="n">pure</span> <span class="p">(</span><span class="n">primaryKey</span> <span class="n">c</span><span class="p">,</span> <span class="n">currentTimestamp_</span><span class="p">,</span> <span class="n">customerAddress</span> <span class="n">c</span><span class="p">,</span> <span class="n">as_</span> <span class="o">@</span><span class="kt">Scientific</span> <span class="o">$</span> <span class="n">val_</span> <span class="mi">10</span><span class="p">)</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-6-Postgres">
            <div class="codehilite"><pre><span></span><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="ss">&quot;Invoice&quot;</span><span class="p">(</span><span class="ss">&quot;CustomerId&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;InvoiceDate&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;BillingAddress&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;BillingCity&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;BillingState&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;BillingCountry&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;BillingPostalCode&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;Total&quot;</span><span class="p">)</span>
<span class="k">SELECT</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;CustomerId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
       <span class="k">CURRENT_TIMESTAMP</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span><span class="p">,</span>
                            <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Address&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res2&quot;</span><span class="p">,</span>
                            <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;City&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res3&quot;</span><span class="p">,</span>
                            <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;State&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res4&quot;</span><span class="p">,</span>
                            <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Country&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res5&quot;</span><span class="p">,</span>
                            <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;PostalCode&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res6&quot;</span><span class="p">,</span>
                            <span class="s1">&#39;10.0&#39;</span> <span class="k">AS</span> <span class="ss">&quot;res7&quot;</span>
<span class="k">FROM</span> <span class="ss">&quot;Customer&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span><span class="p">;</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-6-Sqlite">
            <div class="codehilite"><pre><span></span><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="ss">&quot;Invoice&quot;</span><span class="p">(</span><span class="ss">&quot;CustomerId&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;InvoiceDate&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;BillingAddress&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;BillingCity&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;BillingState&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;BillingCountry&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;BillingPostalCode&quot;</span><span class="p">,</span>
                      <span class="ss">&quot;Total&quot;</span><span class="p">)</span>
<span class="k">SELECT</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;CustomerId&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
       <span class="k">CURRENT_TIMESTAMP</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span><span class="p">,</span>
                            <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Address&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res2&quot;</span><span class="p">,</span>
                            <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;City&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res3&quot;</span><span class="p">,</span>
                            <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;State&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res4&quot;</span><span class="p">,</span>
                            <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;Country&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res5&quot;</span><span class="p">,</span>
                            <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;PostalCode&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res6&quot;</span><span class="p">,</span>
                            <span class="o">?</span> <span class="k">AS</span> <span class="ss">&quot;res7&quot;</span>
<span class="k">FROM</span> <span class="ss">&quot;Customer&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span><span class="p">;</span>

<span class="c1">-- With values: [SQLText &quot;10.0&quot;];</span>
</code></pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<h2 id="inserting-nothing">Inserting nothing</h2>
<p>Oftentimes, the values to be inserted are generated automatically by some
Haskell function, and you just insert the resulting list. Sometimes, these lists
may be empty. If you blindly translated this into SQL, you'd end up with
<code>INSERT</code>s with empty <code>VALUE</code> clauses, which are illegal. Beam actually handles
this gracefully. If a <code>SqlInsertValues</code> has no rows to insert, the <code>SqlInsert</code>
returned by <code>insert</code> will know that it is empty. Running this <code>SqlInsert</code>
results in nothing being sent to the database, which you can verify below.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item">
            <a href="#tab-7-Haskell" aria-controls="tab-7-Haskell" role="tab" data-toggle="tab" data-lang="haskell">Haskell</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-7-Postgres" aria-controls="tab-7-Postgres" role="tab" data-toggle="tab" data-lang="sql">Postgres</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-7-Sqlite" aria-controls="tab-7-Sqlite" role="tab" data-toggle="tab" data-lang="sql">Sqlite</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-7-Haskell">
            <div class="codehilite"><pre><span></span><code><span class="kr">let</span> <span class="n">superComplicatedAction</span> <span class="ow">=</span> <span class="n">pure</span> <span class="kt">[]</span> <span class="c1">-- Hopefully, you&#39;re more creative!</span>

<span class="nf">valuesToInsert</span> <span class="ow">&lt;-</span> <span class="n">superComplicatedAction</span>

<span class="nf">putStrLn</span> <span class="s">&quot;The following runInsert will send no commands to the database&quot;</span>
<span class="nf">runInsert</span> <span class="o">$</span> <span class="n">insert</span> <span class="p">(</span><span class="n">playlist</span> <span class="n">chinookDb</span><span class="p">)</span> <span class="o">$</span>
  <span class="n">insertValues</span> <span class="n">valuesToInsert</span>
<span class="nf">putStrLn</span> <span class="s">&quot;See! I told you!&quot;</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-7-Postgres">
            <div class="codehilite"><pre><span></span><code><span class="c1">-- Output: The following runInsert will send no commands to the database</span>
<span class="c1">-- Output: See! I told you!</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-7-Sqlite">
            <div class="codehilite"><pre><span></span><code><span class="c1">-- Output: The following runInsert will send no commands to the database</span>
<span class="c1">-- Output: See! I told you!</span>
</code></pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<h2 id="on-conflict"><code>ON CONFLICT</code></h2>
<p>Several backends (such as Postgres and SQLite) support <code>ON CONFLICT</code> subexpressions that specify
what action to take when an <code>INSERT</code> statement conlicts with already present data.</p>
<p>Beam support backend-agnostic <code>ON CONFLICT</code> statements via the <code>BeamHasInsertOnConflict</code>syntax. This
class contains a new function to generate an <code>SqlInsert</code>. The <code>insertOnConflict</code> function can be
used to attach <code>ON CONFLICT</code> actions to a <code>SqlInsert</code>.</p>
<div class="codehilite"><pre><span></span><code>  <span class="n">insertOnConflict</span>
    <span class="ow">::</span> <span class="kt">Beamable</span> <span class="n">table</span>
    <span class="ow">=&gt;</span> <span class="kt">DatabaseEntity</span> <span class="n">be</span> <span class="n">db</span> <span class="p">(</span><span class="kt">TableEntity</span> <span class="n">table</span><span class="p">)</span>
    <span class="ow">-&gt;</span> <span class="kt">SqlInsertValues</span> <span class="n">be</span> <span class="p">(</span><span class="n">table</span> <span class="p">(</span><span class="kt">QExpr</span> <span class="n">be</span> <span class="n">s</span><span class="p">))</span>
    <span class="ow">-&gt;</span> <span class="kt">SqlConflictTarget</span> <span class="n">be</span> <span class="n">table</span>
    <span class="ow">-&gt;</span> <span class="kt">SqlConflictAction</span> <span class="n">be</span> <span class="n">table</span>
    <span class="ow">-&gt;</span> <span class="kt">SqlInsert</span> <span class="n">be</span> <span class="n">table</span>
</code></pre></div>

<p>The <code>SqlConflictTarget</code> specifies on which kinds of conflicts the action should run. You have a few options</p>
<ul>
<li><code>anyConflict</code> - run the action on any conflict</li>
<li><code>conflictingFields</code> - run the action only when certain fields conflict</li>
<li><code>conflictingFieldsWhere</code> - run the action only when certain fields conflict and a particular
  expression evaluates to true.</li>
</ul>
<p>The <code>SqlConflictAction</code> specifies what to do when a conflict happens.</p>
<ul>
<li><code>onConflictDoNothing</code> - this cancels the insertion</li>
<li><code>onConflictUpdateSet</code> - sets fields to new values based on the current values</li>
<li><code>onConflictUpdateSetWhere</code> - sets fields to new values if a particular condition holds</li>
</ul>
<h3 id="acting-on-any-conflict">Acting on any conflict</h3>
<p>A common use case of <code>ON CONFLICT</code> is to <em>upsert</em> rows into a database. <em>Upsertion</em> refers to only
inserting a row if another conflicting row does not already exist. For example, if you have a new
customer with primary key 42, and you don't know if it's in the database or not, but you want to
insert it if not, you can use the <code>insertOnConflict</code> function with the <code>anyConflict</code> target.</p>
<div class="codehilite"><pre><span></span><code><span class="kr">let</span>
  <span class="n">newCustomer</span> <span class="ow">=</span> <span class="kt">Customer</span> <span class="mi">42</span> <span class="s">&quot;John&quot;</span> <span class="s">&quot;Doe&quot;</span> <span class="kt">Nothing</span> <span class="p">(</span><span class="kt">Address</span> <span class="p">(</span><span class="kt">Just</span> <span class="s">&quot;Street&quot;</span><span class="p">)</span> <span class="p">(</span><span class="kt">Just</span> <span class="s">&quot;City&quot;</span><span class="p">)</span> <span class="p">(</span><span class="kt">Just</span> <span class="s">&quot;State&quot;</span><span class="p">)</span> <span class="kt">Nothing</span> <span class="kt">Nothing</span><span class="p">)</span> <span class="kt">Nothing</span> <span class="kt">Nothing</span> <span class="s">&quot;john.doe@johndoe.com&quot;</span> <span class="n">nothing_</span>

<span class="nf">runInsert</span> <span class="o">$</span>
  <span class="n">insertOnConflict</span> <span class="p">(</span><span class="n">customer</span> <span class="n">chinookDb</span><span class="p">)</span> <span class="p">(</span><span class="n">insertValues</span> <span class="p">[</span><span class="n">newCustomer</span><span class="p">])</span>
     <span class="n">anyConflict</span>
     <span class="n">onConflictDoNothing</span>
</code></pre></div>

<h3 id="acting-only-on-certain-conflicts">Acting only on certain conflicts</h3>
<p>Sometimes you only want to perform an action if a certain constraint is violated. If the conflicting
index or constraint is on a field you can specify which fields with the function <code>conflictingFields</code>.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item">
            <a href="#tab-8-Haskell" aria-controls="tab-8-Haskell" role="tab" data-toggle="tab" data-lang="haskell">Haskell</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-8-Postgres" aria-controls="tab-8-Postgres" role="tab" data-toggle="tab" data-lang="sql">Postgres</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-8-Sqlite" aria-controls="tab-8-Sqlite" role="tab" data-toggle="tab" data-lang="sql">Sqlite</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-8-Haskell">
            <div class="codehilite"><pre><span></span><code><span class="o">--!</span> <span class="kr">import</span> <span class="nn">Database.Beam.Backend.SQL.BeamExtensions</span> <span class="p">(</span><span class="kt">BeamHasInsertOnConflict</span><span class="p">(</span><span class="o">..</span><span class="p">))</span>
<span class="kr">let</span>
  <span class="n">newCustomer</span> <span class="ow">=</span> <span class="kt">Customer</span> <span class="mi">42</span> <span class="s">&quot;John&quot;</span> <span class="s">&quot;Doe&quot;</span> <span class="kt">Nothing</span> <span class="p">(</span><span class="kt">Address</span> <span class="p">(</span><span class="kt">Just</span> <span class="s">&quot;Street&quot;</span><span class="p">)</span> <span class="p">(</span><span class="kt">Just</span> <span class="s">&quot;City&quot;</span><span class="p">)</span> <span class="p">(</span><span class="kt">Just</span> <span class="s">&quot;State&quot;</span><span class="p">)</span> <span class="kt">Nothing</span> <span class="kt">Nothing</span><span class="p">)</span> <span class="kt">Nothing</span> <span class="kt">Nothing</span> <span class="s">&quot;john.doe@johndoe.com&quot;</span> <span class="n">nothing_</span>

<span class="nf">runInsert</span> <span class="o">$</span>
  <span class="n">insertOnConflict</span> <span class="p">(</span><span class="n">customer</span> <span class="n">chinookDb</span><span class="p">)</span> <span class="p">(</span><span class="n">insertValues</span> <span class="p">[</span><span class="n">newCustomer</span><span class="p">])</span>
    <span class="p">(</span><span class="n">conflictingFields</span> <span class="p">(</span><span class="nf">\</span><span class="n">tbl</span> <span class="ow">-&gt;</span> <span class="n">primaryKey</span> <span class="n">tbl</span><span class="p">))</span>
    <span class="p">(</span><span class="n">onConflictUpdateSet</span> <span class="p">(</span><span class="nf">\</span><span class="n">fields</span> <span class="n">oldValues</span> <span class="ow">-&gt;</span> <span class="n">fields</span> <span class="o">&lt;-.</span> <span class="n">val_</span> <span class="n">newCustomer</span><span class="p">))</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-8-Postgres">
            <div class="codehilite"><pre><span></span><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="ss">&quot;Customer&quot;</span><span class="p">(</span><span class="ss">&quot;CustomerId&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;FirstName&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;LastName&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;Company&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;Address&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;City&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;State&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;Country&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;PostalCode&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;Phone&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;Fax&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;Email&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;SupportRepId&quot;</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="s1">&#39;John&#39;</span><span class="p">,</span> <span class="s1">&#39;Doe&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="s1">&#39;Street&#39;</span><span class="p">,</span> <span class="s1">&#39;City&#39;</span><span class="p">,</span> <span class="s1">&#39;State&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="s1">&#39;john.doe@johndoe.com&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">)</span> <span class="k">ON</span> <span class="n">CONFLICT</span> <span class="p">(</span><span class="ss">&quot;CustomerId&quot;</span><span class="p">)</span> <span class="k">DO</span>
<span class="k">UPDATE</span>
<span class="k">SET</span> <span class="ss">&quot;CustomerId&quot;</span><span class="o">=</span><span class="p">(</span><span class="mi">42</span><span class="p">),</span>
    <span class="ss">&quot;FirstName&quot;</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;John&#39;</span><span class="p">),</span>
    <span class="ss">&quot;LastName&quot;</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Doe&#39;</span><span class="p">),</span>
    <span class="ss">&quot;Company&quot;</span><span class="o">=</span><span class="p">(</span><span class="k">null</span><span class="p">),</span>
    <span class="ss">&quot;Address&quot;</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Street&#39;</span><span class="p">),</span>
    <span class="ss">&quot;City&quot;</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;City&#39;</span><span class="p">),</span>
    <span class="ss">&quot;State&quot;</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;State&#39;</span><span class="p">),</span>
    <span class="ss">&quot;Country&quot;</span><span class="o">=</span><span class="p">(</span><span class="k">null</span><span class="p">),</span>
    <span class="ss">&quot;PostalCode&quot;</span><span class="o">=</span><span class="p">(</span><span class="k">null</span><span class="p">),</span>
    <span class="ss">&quot;Phone&quot;</span><span class="o">=</span><span class="p">(</span><span class="k">null</span><span class="p">),</span>
    <span class="ss">&quot;Fax&quot;</span><span class="o">=</span><span class="p">(</span><span class="k">null</span><span class="p">),</span>
    <span class="ss">&quot;Email&quot;</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;john.doe@johndoe.com&#39;</span><span class="p">),</span>
    <span class="ss">&quot;SupportRepId&quot;</span><span class="o">=</span><span class="p">(</span><span class="k">null</span><span class="p">);</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-8-Sqlite">
            <div class="codehilite"><pre><span></span><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="ss">&quot;Customer&quot;</span><span class="p">(</span><span class="ss">&quot;CustomerId&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;FirstName&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;LastName&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;Company&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;Address&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;City&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;State&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;Country&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;PostalCode&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;Phone&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;Fax&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;Email&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;SupportRepId&quot;</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="k">NULL</span><span class="p">)</span> <span class="k">ON</span> <span class="n">CONFLICT</span> <span class="p">(</span><span class="ss">&quot;CustomerId&quot;</span><span class="p">)</span> <span class="k">DO</span>
<span class="k">UPDATE</span>
<span class="k">SET</span> <span class="ss">&quot;CustomerId&quot;</span> <span class="o">=</span> <span class="o">?</span><span class="p">,</span>
    <span class="ss">&quot;FirstName&quot;</span> <span class="o">=</span> <span class="o">?</span><span class="p">,</span>
    <span class="ss">&quot;LastName&quot;</span> <span class="o">=</span> <span class="o">?</span><span class="p">,</span>
    <span class="ss">&quot;Company&quot;</span> <span class="o">=</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="ss">&quot;Address&quot;</span> <span class="o">=</span> <span class="o">?</span><span class="p">,</span>
    <span class="ss">&quot;City&quot;</span> <span class="o">=</span> <span class="o">?</span><span class="p">,</span>
    <span class="ss">&quot;State&quot;</span> <span class="o">=</span> <span class="o">?</span><span class="p">,</span>
    <span class="ss">&quot;Country&quot;</span> <span class="o">=</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="ss">&quot;PostalCode&quot;</span> <span class="o">=</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="ss">&quot;Phone&quot;</span> <span class="o">=</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="ss">&quot;Fax&quot;</span> <span class="o">=</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="ss">&quot;Email&quot;</span> <span class="o">=</span> <span class="o">?</span><span class="p">,</span>
    <span class="ss">&quot;SupportRepId&quot;</span> <span class="o">=</span> <span class="k">NULL</span><span class="p">;</span>

<span class="c1">-- With values: [SQLInteger 42,SQLText &quot;John&quot;,SQLText &quot;Doe&quot;,SQLText &quot;Street&quot;,SQLText &quot;City&quot;,SQLText &quot;State&quot;,SQLText &quot;john.doe@johndoe.com&quot;,SQLInteger 42,SQLText &quot;John&quot;,SQLText &quot;Doe&quot;,SQLText &quot;Street&quot;,SQLText &quot;City&quot;,SQLText &quot;State&quot;,SQLText &quot;john.doe@johndoe.com&quot;];</span>
</code></pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>To specify a conflict on the primary keys, use <code>conflictingFields primaryKey</code>.</p>
</div>
<p>You can also specify how to change the record should it not match. For example, to append the e-mail
as an alternate when you insert an existing row, you can use the <code>oldValues</code> argument to get access
to the old value.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item">
            <a href="#tab-9-Haskell" aria-controls="tab-9-Haskell" role="tab" data-toggle="tab" data-lang="haskell">Haskell</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-9-Postgres" aria-controls="tab-9-Postgres" role="tab" data-toggle="tab" data-lang="sql">Postgres</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-9-Sqlite" aria-controls="tab-9-Sqlite" role="tab" data-toggle="tab" data-lang="sql">Sqlite</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-9-Haskell">
            <div class="codehilite"><pre><span></span><code><span class="o">--!</span> <span class="kr">import</span> <span class="nn">Database.Beam.Backend.SQL.BeamExtensions</span> <span class="p">(</span><span class="kt">BeamHasInsertOnConflict</span><span class="p">(</span><span class="o">..</span><span class="p">))</span>
<span class="kr">let</span>
  <span class="n">newCustomer</span> <span class="ow">=</span> <span class="kt">Customer</span> <span class="mi">42</span> <span class="s">&quot;John&quot;</span> <span class="s">&quot;Doe&quot;</span> <span class="kt">Nothing</span> <span class="p">(</span><span class="kt">Address</span> <span class="p">(</span><span class="kt">Just</span> <span class="s">&quot;Street&quot;</span><span class="p">)</span> <span class="p">(</span><span class="kt">Just</span> <span class="s">&quot;City&quot;</span><span class="p">)</span> <span class="p">(</span><span class="kt">Just</span> <span class="s">&quot;State&quot;</span><span class="p">)</span> <span class="kt">Nothing</span> <span class="kt">Nothing</span><span class="p">)</span> <span class="kt">Nothing</span> <span class="kt">Nothing</span> <span class="s">&quot;john.doe@johndoe.com&quot;</span> <span class="n">nothing_</span>

<span class="nf">runInsert</span> <span class="o">$</span>
  <span class="n">insertOnConflict</span> <span class="p">(</span><span class="n">customer</span> <span class="n">chinookDb</span><span class="p">)</span> <span class="p">(</span><span class="n">insertValues</span> <span class="p">[</span><span class="n">newCustomer</span><span class="p">])</span>
    <span class="p">(</span><span class="n">conflictingFields</span> <span class="p">(</span><span class="nf">\</span><span class="n">tbl</span> <span class="ow">-&gt;</span> <span class="n">primaryKey</span> <span class="n">tbl</span><span class="p">))</span>
    <span class="p">(</span><span class="n">onConflictUpdateSet</span> <span class="p">(</span><span class="nf">\</span><span class="n">fields</span> <span class="n">oldValues</span> <span class="ow">-&gt;</span> <span class="n">customerEmail</span> <span class="n">fields</span> <span class="o">&lt;-.</span> <span class="n">concat_</span> <span class="p">[</span> <span class="n">customerEmail</span> <span class="n">oldValues</span><span class="p">,</span> <span class="s">&quot;;&quot;</span><span class="p">,</span> <span class="n">val_</span> <span class="p">(</span><span class="n">customerEmail</span> <span class="n">newCustomer</span><span class="p">)]))</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-9-Postgres">
            <div class="codehilite"><pre><span></span><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="ss">&quot;Customer&quot;</span><span class="p">(</span><span class="ss">&quot;CustomerId&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;FirstName&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;LastName&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;Company&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;Address&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;City&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;State&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;Country&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;PostalCode&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;Phone&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;Fax&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;Email&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;SupportRepId&quot;</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="s1">&#39;John&#39;</span><span class="p">,</span> <span class="s1">&#39;Doe&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="s1">&#39;Street&#39;</span><span class="p">,</span> <span class="s1">&#39;City&#39;</span><span class="p">,</span> <span class="s1">&#39;State&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="s1">&#39;john.doe@johndoe.com&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">)</span> <span class="k">ON</span> <span class="n">CONFLICT</span> <span class="p">(</span><span class="ss">&quot;CustomerId&quot;</span><span class="p">)</span> <span class="k">DO</span>
<span class="k">UPDATE</span>
<span class="k">SET</span> <span class="ss">&quot;Email&quot;</span><span class="o">=</span><span class="p">(</span><span class="n">CONCAT</span><span class="p">(</span><span class="ss">&quot;excluded&quot;</span><span class="p">.</span><span class="ss">&quot;Email&quot;</span><span class="p">,</span> <span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="s1">&#39;john.doe@johndoe.com&#39;</span><span class="p">));</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-9-Sqlite">
            <div class="codehilite"><pre><span></span><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="ss">&quot;Customer&quot;</span><span class="p">(</span><span class="ss">&quot;CustomerId&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;FirstName&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;LastName&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;Company&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;Address&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;City&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;State&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;Country&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;PostalCode&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;Phone&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;Fax&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;Email&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;SupportRepId&quot;</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="k">NULL</span><span class="p">)</span> <span class="k">ON</span> <span class="n">CONFLICT</span> <span class="p">(</span><span class="ss">&quot;CustomerId&quot;</span><span class="p">)</span> <span class="k">DO</span>
<span class="k">UPDATE</span>
<span class="k">SET</span> <span class="ss">&quot;Email&quot;</span> <span class="o">=</span> <span class="p">(</span><span class="ss">&quot;excluded&quot;</span><span class="p">.</span><span class="ss">&quot;Email&quot;</span> <span class="o">||</span> <span class="p">(</span><span class="o">?</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="o">?</span><span class="p">));</span>

<span class="c1">-- With values: [SQLInteger 42,SQLText &quot;John&quot;,SQLText &quot;Doe&quot;,SQLText &quot;Street&quot;,SQLText &quot;City&quot;,SQLText &quot;State&quot;,SQLText &quot;john.doe@johndoe.com&quot;,SQLText &quot;;&quot;,SQLText &quot;john.doe@johndoe.com&quot;];</span>
</code></pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<p>If you want to be even more particular and only do this transformation on rows corresponding to
customers from one state, use <code>conflictingFieldsWhere</code>.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item">
            <a href="#tab-34-Haskell" aria-controls="tab-34-Haskell" role="tab" data-toggle="tab" data-lang="haskell">Haskell</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-34-Postgres" aria-controls="tab-34-Postgres" role="tab" data-toggle="tab" data-lang="sql">Postgres</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-34-Sqlite" aria-controls="tab-34-Sqlite" role="tab" data-toggle="tab" data-lang="sql">Sqlite</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-34-Haskell">
            <div class="codehilite"><pre><span></span><code><span class="o">--!</span> <span class="kr">import</span> <span class="nn">Database.Beam.Backend.SQL.BeamExtensions</span> <span class="p">(</span><span class="kt">BeamHasInsertOnConflict</span><span class="p">(</span><span class="o">..</span><span class="p">))</span>
<span class="kr">let</span>
  <span class="n">newCustomer</span> <span class="ow">=</span> <span class="kt">Customer</span> <span class="mi">42</span> <span class="s">&quot;John&quot;</span> <span class="s">&quot;Doe&quot;</span> <span class="kt">Nothing</span> <span class="p">(</span><span class="kt">Address</span> <span class="p">(</span><span class="kt">Just</span> <span class="s">&quot;Street&quot;</span><span class="p">)</span> <span class="p">(</span><span class="kt">Just</span> <span class="s">&quot;City&quot;</span><span class="p">)</span> <span class="p">(</span><span class="kt">Just</span> <span class="s">&quot;State&quot;</span><span class="p">)</span> <span class="kt">Nothing</span> <span class="kt">Nothing</span><span class="p">)</span> <span class="kt">Nothing</span> <span class="kt">Nothing</span> <span class="s">&quot;john.doe@johndoe.com&quot;</span> <span class="n">nothing_</span>

<span class="nf">runInsert</span> <span class="o">$</span>
  <span class="n">insertOnConflict</span> <span class="p">(</span><span class="n">customer</span> <span class="n">chinookDb</span><span class="p">)</span> <span class="p">(</span><span class="n">insertValues</span> <span class="p">[</span><span class="n">newCustomer</span><span class="p">])</span>
    <span class="p">(</span><span class="n">conflictingFieldsWhere</span> <span class="p">(</span><span class="nf">\</span><span class="n">tbl</span> <span class="ow">-&gt;</span> <span class="n">primaryKey</span> <span class="n">tbl</span><span class="p">)</span> <span class="p">(</span><span class="nf">\</span><span class="n">tbl</span> <span class="ow">-&gt;</span> <span class="n">addressState</span> <span class="p">(</span><span class="n">customerAddress</span> <span class="n">tbl</span><span class="p">)</span> <span class="o">==.</span> <span class="n">val_</span> <span class="p">(</span><span class="kt">Just</span> <span class="s">&quot;CA&quot;</span><span class="p">)))</span>
    <span class="p">(</span><span class="n">onConflictUpdateSet</span> <span class="p">(</span><span class="nf">\</span><span class="n">fields</span> <span class="n">oldValues</span> <span class="ow">-&gt;</span> <span class="n">customerEmail</span> <span class="n">fields</span> <span class="o">&lt;-.</span> <span class="n">concat_</span> <span class="p">[</span> <span class="n">customerEmail</span> <span class="n">oldValues</span><span class="p">,</span> <span class="s">&quot;;&quot;</span><span class="p">,</span> <span class="n">val_</span> <span class="p">(</span><span class="n">customerEmail</span> <span class="n">newCustomer</span><span class="p">)]))</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-34-Postgres">
            <div class="codehilite"><pre><span></span><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="ss">&quot;Customer&quot;</span><span class="p">(</span><span class="ss">&quot;CustomerId&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;FirstName&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;LastName&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;Company&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;Address&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;City&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;State&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;Country&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;PostalCode&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;Phone&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;Fax&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;Email&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;SupportRepId&quot;</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="s1">&#39;John&#39;</span><span class="p">,</span> <span class="s1">&#39;Doe&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="s1">&#39;Street&#39;</span><span class="p">,</span> <span class="s1">&#39;City&#39;</span><span class="p">,</span> <span class="s1">&#39;State&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="s1">&#39;john.doe@johndoe.com&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">)</span> <span class="k">ON</span> <span class="n">CONFLICT</span> <span class="p">(</span><span class="ss">&quot;CustomerId&quot;</span><span class="p">)</span>
<span class="k">WHERE</span> <span class="p">((</span><span class="ss">&quot;State&quot;</span><span class="p">)</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">DISTINCT</span>
       <span class="k">FROM</span> <span class="p">(</span><span class="s1">&#39;CA&#39;</span><span class="p">))</span> <span class="k">DO</span>
  <span class="k">UPDATE</span>
  <span class="k">SET</span> <span class="ss">&quot;Email&quot;</span><span class="o">=</span><span class="p">(</span><span class="n">CONCAT</span><span class="p">(</span><span class="ss">&quot;excluded&quot;</span><span class="p">.</span><span class="ss">&quot;Email&quot;</span><span class="p">,</span> <span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="s1">&#39;john.doe@johndoe.com&#39;</span><span class="p">));</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-34-Sqlite">
            <div class="codehilite"><pre><span></span><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="ss">&quot;Customer&quot;</span><span class="p">(</span><span class="ss">&quot;CustomerId&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;FirstName&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;LastName&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;Company&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;Address&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;City&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;State&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;Country&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;PostalCode&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;Phone&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;Fax&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;Email&quot;</span><span class="p">,</span>
                       <span class="ss">&quot;SupportRepId&quot;</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="k">NULL</span><span class="p">)</span> <span class="k">ON</span> <span class="n">CONFLICT</span> <span class="p">(</span><span class="ss">&quot;CustomerId&quot;</span><span class="p">)</span>
<span class="k">WHERE</span> <span class="k">CASE</span>
          <span class="k">WHEN</span> <span class="p">((</span><span class="ss">&quot;State&quot;</span><span class="p">)</span> <span class="k">IS</span> <span class="k">NULL</span><span class="p">)</span>
               <span class="k">AND</span> <span class="p">((</span><span class="o">?</span><span class="p">)</span> <span class="k">IS</span> <span class="k">NULL</span><span class="p">)</span> <span class="k">THEN</span> <span class="o">?</span>
          <span class="k">WHEN</span> <span class="p">((</span><span class="ss">&quot;State&quot;</span><span class="p">)</span> <span class="k">IS</span> <span class="k">NULL</span><span class="p">)</span>
               <span class="k">OR</span> <span class="p">((</span><span class="o">?</span><span class="p">)</span> <span class="k">IS</span> <span class="k">NULL</span><span class="p">)</span> <span class="k">THEN</span> <span class="o">?</span>
          <span class="k">ELSE</span> <span class="p">(</span><span class="ss">&quot;State&quot;</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="o">?</span><span class="p">)</span>
      <span class="k">END</span> <span class="k">DO</span>
  <span class="k">UPDATE</span>
  <span class="k">SET</span> <span class="ss">&quot;Email&quot;</span> <span class="o">=</span> <span class="p">(</span><span class="ss">&quot;excluded&quot;</span><span class="p">.</span><span class="ss">&quot;Email&quot;</span> <span class="o">||</span> <span class="p">(</span><span class="o">?</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="o">?</span><span class="p">));</span>

<span class="c1">-- With values: [SQLInteger 42,SQLText &quot;John&quot;,SQLText &quot;Doe&quot;,SQLText &quot;Street&quot;,SQLText &quot;City&quot;,SQLText &quot;State&quot;,SQLText &quot;john.doe@johndoe.com&quot;,SQLText &quot;CA&quot;,SQLInteger 1,SQLText &quot;CA&quot;,SQLInteger 0,SQLText &quot;CA&quot;,SQLText &quot;;&quot;,SQLText &quot;john.doe@johndoe.com&quot;];</span>
</code></pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../../extensibility/" title="Custom queries" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Custom queries
              </div>
            </div>
          </a>
        
        
          <a href="../update/" title="UPDATE" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                UPDATE
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4,11V13H16L10.5,18.5L11.92,19.92L19.84,12L11.92,4.08L10.5,5.5L16,11H4Z" /></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    

      <script src="../../../assets/javascripts/vendor.36cbf620.min.js"></script>
      <script src="../../../assets/javascripts/bundle.00c583dd.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../../..",
          features: [],
          search: Object.assign({
            worker: "../../../assets/javascripts/worker/search.7f7c8775.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
<script type="text/javascript" language="javascript"  src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
<script type="text/javascript" language="javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script type="text/javascript" language="javascript">
 $(document.body).tab();
 $(".nav-item:first-child").tab("show");
</script>

  </body>
</html>