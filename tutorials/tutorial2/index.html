


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-5.0.2">
    
    
      
        <title>Part 2 - Beam Documentation</title>
      
    
    

      <link rel="stylesheet" href="../../assets/stylesheets/main.07c9fbf5.min.css">
      
      
    
<link rel="stylesheet" type="text/css" href="../../css/beam.css"/>

    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../../docs/theme/css/beam.css">
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#introduction" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="Beam Documentation" class="md-header-nav__button md-logo" aria-label="Beam Documentation">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,8A3,3 0 0,0 15,5A3,3 0 0,0 12,2A3,3 0 0,0 9,5A3,3 0 0,0 12,8M12,11.54C9.64,9.35 6.5,8 3,8V19C6.5,19 9.64,20.35 12,22.54C14.36,20.35 17.5,19 21,19V8C17.5,8 14.36,9.35 12,11.54Z" /></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z" /></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Beam Documentation
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Part 2
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" /></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/haskell-beam/beam/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    haskell-beam/beam
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Beam Documentation" class="md-nav__button md-logo" aria-label="Beam Documentation">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,8A3,3 0 0,0 15,5A3,3 0 0,0 12,2A3,3 0 0,0 9,5A3,3 0 0,0 12,8M12,11.54C9.64,9.35 6.5,8 3,8V19C6.5,19 9.64,20.35 12,22.54C14.36,20.35 17.5,19 21,19V8C17.5,8 14.36,9.35 12,11.54Z" /></svg>

    </a>
    Beam Documentation
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/haskell-beam/beam/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    haskell-beam/beam
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../about/faq/" title="Frequently Asked Questions" class="md-nav__link">
      Frequently Asked Questions
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Tutorial
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Tutorial" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Tutorial
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../tutorial1/" title="Part 1" class="md-nav__link">
      Part 1
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
    <a href="./" title="Part 2" class="md-nav__link md-nav__link--active">
      Part 2
    </a>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tutorial3/" title="Part 3" class="md-nav__link">
      Part 3
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      User Guide
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="User Guide" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        User Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/models/" title="Models" class="md-nav__link">
      Models
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/databases/" title="Databases" class="md-nav__link">
      Databases
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/backends/" title="Backends" class="md-nav__link">
      Backends
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/expressions/" title="Expressions" class="md-nav__link">
      Expressions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4-5" type="checkbox" id="nav-4-5">
    
    <label class="md-nav__link" for="nav-4-5">
      Queries
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Queries" data-md-level="2">
      <label class="md-nav__title" for="nav-4-5">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Queries
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/queries/basic/" title="Basic Queries" class="md-nav__link">
      Basic Queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/queries/select/" title="More complex SELECTs" class="md-nav__link">
      More complex SELECTs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/queries/ordering/" title="Ordering" class="md-nav__link">
      Ordering
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/queries/relationships/" title="Relationships" class="md-nav__link">
      Relationships
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/queries/aggregates/" title="Aggregates" class="md-nav__link">
      Aggregates
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/queries/combining-queries/" title="Combining queries" class="md-nav__link">
      Combining queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/queries/window-functions/" title="Window functions" class="md-nav__link">
      Window functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/queries/advanced-features/" title="Advanced features" class="md-nav__link">
      Advanced features
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/queries/common-table-expressions/" title="Common table expressions" class="md-nav__link">
      Common table expressions
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/extensibility/" title="Custom queries" class="md-nav__link">
      Custom queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4-7" type="checkbox" id="nav-4-7">
    
    <label class="md-nav__link" for="nav-4-7">
      Data Manipulation
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Data Manipulation" data-md-level="2">
      <label class="md-nav__title" for="nav-4-7">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Data Manipulation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/manipulation/insert/" title="INSERT" class="md-nav__link">
      INSERT
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/manipulation/update/" title="UPDATE" class="md-nav__link">
      UPDATE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/manipulation/delete/" title="DELETE" class="md-nav__link">
      DELETE
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Schema management
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Schema management" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Schema management
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../schema-guide/migrations/" title="The Migrations Framework" class="md-nav__link">
      The Migrations Framework
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../schema-guide/tool/" title="The beam-migrate tool" class="md-nav__link">
      The beam-migrate tool
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../schema-guide/library/" title="The beam-migrate library" class="md-nav__link">
      The beam-migrate library
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Backends
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Backends" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Backends
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/backends/beam-postgres/" title="beam-postgres" class="md-nav__link">
      beam-postgres
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/backends/beam-sqlite/" title="beam-sqlite" class="md-nav__link">
      beam-sqlite
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/custom-backends/" title="Writing a Custom Backend" class="md-nav__link">
      Writing a Custom Backend
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      About
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="About" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        About
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../about/compatibility/" title="Compatibility Matrix" class="md-nav__link">
      Compatibility Matrix
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../about/license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../about/release-notes/" title="Release Notes" class="md-nav__link">
      Release Notes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/haskell-beam/beam/edit/master/docs/tutorials/tutorial2.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z" /></svg>
                  </a>
                
                
                  
                
                
                <h1 id="introduction">Introduction</h1>
<p>In the last part, we created a simple database with one table. We then used the
beam interface to add entities into that table and query them. In this tutorial,
we'll see how to update and delete rows and how to establish and query relations
between tables.</p>
<p>We'll then delve deeper into queries to see how to create queries that return
multiple tables.</p>
<h1 id="adding-a-related-table">Adding a related table</h1>
<p>The users in our simple e-commerce application would like to ship orders to
their homes. Let's build an addresses model to allow users to add home addresses
to their profile. Our table will store United States addresses for now. An
address in the United States consists of</p>
<ul>
<li>an auto-incrementing primary key</li>
<li>one required house number and street line</li>
<li>an optional apartment/suite number line</li>
<li>a required city</li>
<li>a required 2-letter state/territory code</li>
<li>one 5-digit ZIP code</li>
</ul>
<p>Let's build the <code>AddressT</code> table. <code>AddressT</code> will follow a similar formula to
<code>UserT</code>, but it will contain a reference to a <code>UserT</code> table. ]</p>
<div class="codehilite"><pre><span></span><code><span class="kr">data</span> <span class="kt">AddressT</span> <span class="n">f</span> <span class="ow">=</span> <span class="kt">Address</span>
                <span class="p">{</span> <span class="n">_addressId</span>    <span class="ow">::</span> <span class="kt">C</span> <span class="n">f</span> <span class="kt">Int32</span>
                <span class="p">,</span> <span class="n">_addressLine1</span> <span class="ow">::</span> <span class="kt">C</span> <span class="n">f</span> <span class="kt">Text</span>
                <span class="p">,</span> <span class="n">_addressLine2</span> <span class="ow">::</span> <span class="kt">C</span> <span class="n">f</span> <span class="p">(</span><span class="kt">Maybe</span> <span class="kt">Text</span><span class="p">)</span>
                <span class="p">,</span> <span class="n">_addressCity</span>  <span class="ow">::</span> <span class="kt">C</span> <span class="n">f</span> <span class="kt">Text</span>
                <span class="p">,</span> <span class="n">_addressState</span> <span class="ow">::</span> <span class="kt">C</span> <span class="n">f</span> <span class="kt">Text</span>
                <span class="p">,</span> <span class="n">_addressZip</span>   <span class="ow">::</span> <span class="kt">C</span> <span class="n">f</span> <span class="kt">Text</span>

                <span class="p">,</span> <span class="n">_addressForUser</span> <span class="ow">::</span> <span class="kt">PrimaryKey</span> <span class="kt">UserT</span> <span class="n">f</span> <span class="p">}</span>
                  <span class="kr">deriving</span> <span class="p">(</span><span class="kt">Generic</span><span class="p">,</span> <span class="kt">Beamable</span><span class="p">)</span>
<span class="kr">type</span> <span class="kt">Address</span> <span class="ow">=</span> <span class="kt">AddressT</span> <span class="kt">Identity</span>
<span class="kr">deriving</span> <span class="kr">instance</span> <span class="kt">Show</span> <span class="p">(</span><span class="kt">PrimaryKey</span> <span class="kt">UserT</span> <span class="kt">Identity</span><span class="p">)</span>
<span class="kr">deriving</span> <span class="kr">instance</span> <span class="kt">Show</span> <span class="kt">Address</span>

<span class="kr">instance</span> <span class="kt">Table</span> <span class="kt">AddressT</span> <span class="kr">where</span>
    <span class="kr">data</span> <span class="kt">PrimaryKey</span> <span class="kt">AddressT</span> <span class="n">f</span> <span class="ow">=</span> <span class="kt">AddressId</span> <span class="p">(</span><span class="kt">Columnar</span> <span class="n">f</span> <span class="kt">Int32</span><span class="p">)</span> <span class="kr">deriving</span> <span class="p">(</span><span class="kt">Generic</span><span class="p">,</span> <span class="kt">Beamable</span><span class="p">)</span>
    <span class="n">primaryKey</span> <span class="ow">=</span> <span class="kt">AddressId</span> <span class="o">.</span> <span class="n">_addressId</span>
<span class="kr">type</span> <span class="kt">AddressId</span> <span class="ow">=</span> <span class="kt">PrimaryKey</span> <span class="kt">AddressT</span> <span class="kt">Identity</span> <span class="c1">-- For convenience</span>
</code></pre></div>

<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Above, we used the <code>C</code> constructor instead of <code>Columnar</code> for each column.
<code>C</code> is a type synonym for <code>Columnar</code>, and some find it reduces the syntactic
overhead of model declaration.</p>
</div>
<p>Notice that <code>_addressForUser</code> is declared as a <code>PrimaryKey UserT f</code>. This pulls
in all the columns necessary for referencing a <code>UserT</code> <sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup>. Later, we'll also
see how beam can use the field to automatically create JOINs.</p>
<p>Notice also that <code>_addressId</code> corresponds to our auto-increminting primary key
field. In general, beam doesn't care if the underlying field is assigned
automatically, only about the type of final values of that field.</p>
<p>We have all the tables we need now, so let's go ahead and redefine our newest
database type.</p>
<div class="codehilite"><pre><span></span><code><span class="kr">data</span> <span class="kt">ShoppingCartDb</span> <span class="n">f</span> <span class="ow">=</span> <span class="kt">ShoppingCartDb</span>
                      <span class="p">{</span> <span class="n">_shoppingCartUsers</span>         <span class="ow">::</span> <span class="n">f</span> <span class="p">(</span><span class="kt">TableEntity</span> <span class="kt">UserT</span><span class="p">)</span>
                      <span class="p">,</span> <span class="n">_shoppingCartUserAddresses</span> <span class="ow">::</span> <span class="n">f</span> <span class="p">(</span><span class="kt">TableEntity</span> <span class="kt">AddressT</span><span class="p">)</span> <span class="p">}</span>
                        <span class="kr">deriving</span> <span class="p">(</span><span class="kt">Generic</span><span class="p">,</span> <span class="kt">Database</span> <span class="n">be</span><span class="p">)</span>
</code></pre></div>

<h2 id="modifying-the-default-naming-choices">Modifying the default naming choices</h2>
<p>In the last part of the tutorial, we let beam decide our field names for us.
This is great for simple cases. However, sometimes you want more control over
the naming options.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Previous versions of this tutorial had instructions on changing the schema
type of particular tables. This functionality has been moved from
<code>beam-core</code> into the <code>beam-migrate</code> package. See
the <a href="../../schema-guide/migrations/">migrations guide</a> for more information.</p>
</div>
<p>The <code>defaultDbSettings</code> function generates names using the Haskell record
selector names <sup id="fnref:2"><a class="footnote-ref" href="#fn:2">2</a></sup>. This function returns the <code>DatabaseType</code> parameterized over
<code>DatabaseEntity</code>, which is a type that contains metadata about entity names. We
can <em>modify</em> this description after it is created by using the
<code>withDbModification</code> function. You can think of <code>withDbModification</code> as applying
a transformation function to each name in our database.</p>
<p>Most of the time <code>withDbModification</code> needs a full description of the database
names. However, most of the time we only want to rename certain columns or
tables. We can use the <code>dbModification</code> value to construct a modification that
doesn't change any names. We can then use the Haskell record update syntax to
update field and column names. This is best illustrated by an example.</p>
<p>Recall our Haskell data types above.</p>
<div class="codehilite"><pre><span></span><code><span class="kr">data</span> <span class="kt">UserT</span> <span class="n">f</span>
    <span class="ow">=</span> <span class="kt">User</span>
    <span class="p">{</span> <span class="n">_userEmail</span>     <span class="ow">::</span> <span class="kt">Columnar</span> <span class="n">f</span> <span class="kt">Text</span>
    <span class="p">,</span> <span class="n">_userFirstName</span> <span class="ow">::</span> <span class="kt">Columnar</span> <span class="n">f</span> <span class="kt">Text</span>
    <span class="p">,</span> <span class="n">_userLastName</span>  <span class="ow">::</span> <span class="kt">Columnar</span> <span class="n">f</span> <span class="kt">Text</span>
    <span class="p">,</span> <span class="n">_userPassword</span>  <span class="ow">::</span> <span class="kt">Columnar</span> <span class="n">f</span> <span class="kt">Text</span> <span class="p">}</span>
    <span class="kr">deriving</span> <span class="kt">Generic</span>

<span class="kr">data</span> <span class="kt">AddressT</span> <span class="n">f</span> <span class="ow">=</span> <span class="kt">Address</span>
                <span class="p">{</span> <span class="n">_addressId</span>    <span class="ow">::</span> <span class="kt">C</span> <span class="n">f</span> <span class="kt">Int32</span>
                <span class="p">,</span> <span class="n">_addressLine1</span> <span class="ow">::</span> <span class="kt">C</span> <span class="n">f</span> <span class="kt">Text</span>
                <span class="p">,</span> <span class="n">_addressLine2</span> <span class="ow">::</span> <span class="kt">C</span> <span class="n">f</span> <span class="p">(</span><span class="kt">Maybe</span> <span class="kt">Text</span><span class="p">)</span>
                <span class="p">,</span> <span class="n">_addressCity</span>  <span class="ow">::</span> <span class="kt">C</span> <span class="n">f</span> <span class="kt">Text</span>
                <span class="p">,</span> <span class="n">_addressState</span> <span class="ow">::</span> <span class="kt">C</span> <span class="n">f</span> <span class="kt">Text</span>
                <span class="p">,</span> <span class="n">_addressZip</span>   <span class="ow">::</span> <span class="kt">C</span> <span class="n">f</span> <span class="kt">Text</span>

                <span class="p">,</span> <span class="n">_addressForUser</span> <span class="ow">::</span> <span class="kt">PrimaryKey</span> <span class="kt">UserT</span> <span class="n">f</span> <span class="p">}</span>
                  <span class="kr">deriving</span> <span class="kt">Generic</span>

<span class="kr">data</span> <span class="kt">ShoppingCartDb</span> <span class="n">f</span> <span class="ow">=</span> <span class="kt">ShoppingCartDb</span>
                      <span class="p">{</span> <span class="n">_shoppingCartUsers</span>         <span class="ow">::</span> <span class="n">f</span> <span class="p">(</span><span class="kt">TableEntity</span> <span class="kt">UserT</span><span class="p">)</span>
                      <span class="p">,</span> <span class="n">_shoppingCartUserAddresses</span> <span class="ow">::</span> <span class="n">f</span> <span class="p">(</span><span class="kt">TableEntity</span> <span class="kt">AddressT</span><span class="p">)</span> <span class="p">}</span>
                        <span class="kr">deriving</span> <span class="kt">Generic</span>
</code></pre></div>

<p>Now, let's say we want beam to use the name <code>addresses</code> to access the
<code>_shoppingCartUserAddresses</code> table, and the names <code>address1</code> and <code>address2</code> to
access <code>_addressLine1</code> and <code>_addressLine2</code> respectively.</p>
<div class="codehilite"><pre><span></span><code><span class="nf">shoppingCartDb</span> <span class="ow">::</span> <span class="kt">DatabaseSettings</span> <span class="n">be</span> <span class="kt">ShoppingCartDb</span>
<span class="nf">shoppingCartDb</span> <span class="ow">=</span> <span class="n">defaultDbSettings</span> <span class="p">`</span><span class="n">withDbModification</span><span class="p">`</span>
                 <span class="n">dbModification</span> <span class="p">{</span>
                   <span class="n">_shoppingCartUserAddresses</span> <span class="ow">=</span>
                     <span class="n">setEntityName</span> <span class="s">&quot;addresses&quot;</span> <span class="o">&lt;&gt;</span>
                     <span class="n">modifyTableFields</span>
                       <span class="n">tableModification</span> <span class="p">{</span>
                         <span class="n">_addressLine1</span> <span class="ow">=</span> <span class="n">fieldNamed</span> <span class="s">&quot;address1&quot;</span><span class="p">,</span>
                         <span class="n">_addressLine2</span> <span class="ow">=</span> <span class="n">fieldNamed</span> <span class="s">&quot;address2&quot;</span>
                       <span class="p">}</span>
                 <span class="p">}</span>
</code></pre></div>

<p>Above, we use <code>dbModification</code> to produce a default modification, then
we override the <code>_shoppingCartUserAddresses</code> modification to change
the addresses table. We modify the table in two ways. First, we use
the <code>setEntityName</code> function to change the name of the table. Then, we
use <code>modifyTableFields</code> to change the names of each field. The
modifications can be combined with the semigroup operator <code>(&lt;&gt;)</code>.</p>
<p>We only override the <code>_addressLine1</code> and <code>_addressLine2</code> modifications with
<code>fieldNamed "address1"</code> and <code>fieldNamed "address2"</code>. Because <code>tableModification</code>
produces a default modification, the other columns are kept at their default
value.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The <code>OverloadedStrings</code> extension lets us avoid typing <code>fieldNamed</code>. For example, instead of</p>
<p><code>_addressLine1 = fieldNamed "address1"</code></p>
<p>we could have written</p>
<p><code>_addressLine1 = "address1"</code></p>
</div>
<p>When renaming a field referring to a foreign key (for example the
<code>_addressForUser</code> field), remember to wrap the field name with the table's
<code>PrimaryKey</code> constructor:</p>
<p><code>_addressForUser = UserId "user"</code></p>
<p>Given that in part one we defined <code>UserId</code> as the <code>PrimaryKey</code> constructor for
<code>UserT</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="kr">instance</span> <span class="kt">Table</span> <span class="kt">UserT</span> <span class="kr">where</span>
   <span class="kr">data</span> <span class="kt">PrimaryKey</span> <span class="kt">UserT</span> <span class="n">f</span> <span class="ow">=</span> <span class="kt">UserId</span> <span class="p">(</span><span class="kt">Columnar</span> <span class="n">f</span> <span class="kt">Text</span><span class="p">)</span> <span class="kr">deriving</span> <span class="p">(</span><span class="kt">Generic</span><span class="p">,</span> <span class="kt">Beamable</span><span class="p">)</span>
   <span class="n">primaryKey</span> <span class="ow">=</span> <span class="kt">UserId</span> <span class="o">.</span> <span class="n">_userEmail</span>
</code></pre></div>

<p>If you didn't need to modify any of the field names, you can omit
<code>modifyTableFields</code>. For example, to simply produce a database with
the first table named <code>users</code> and the second named <code>user_addresses</code>,
you can do</p>
<div class="codehilite"><pre><span></span><code><span class="nf">shoppingCartDb1</span> <span class="ow">::</span> <span class="kt">DatabaseSettings</span> <span class="n">be</span> <span class="kt">ShoppingCartDb</span>
<span class="nf">shoppingCartDb1</span> <span class="ow">=</span> <span class="n">defaultDbSettings</span> <span class="p">`</span><span class="n">withDbModification</span><span class="p">`</span>
                  <span class="n">dbModification</span> <span class="p">{</span>
                    <span class="n">_shoppingCartUsers</span> <span class="ow">=</span> <span class="n">setEntityName</span> <span class="s">&quot;users&quot;</span><span class="p">,</span>
                    <span class="n">_shoppingCartUserAddresses</span> <span class="ow">=</span> <span class="n">setEntityName</span> <span class="s">&quot;user_addresses&quot;</span>
                  <span class="p">}</span>
</code></pre></div>

<p>For the purposes of this tutorial, we'll stick with <code>shoppingCartDb</code>.</p>
<h1 id="easier-queries-with-lenses">Easier queries with lenses</h1>
<p>In the previous part, we accessed table columns by using regular Haskell record
syntax. Sometimes, we would like to use the more convenient lens syntax to
access columns. Of course, all of beam's definitions are compatible with the
<code>lens</code> library -- that is to say, <code>makeLenses</code> will work just fine. However,
beam's motivation is, in part, the avoidance of Template Haskell, and it would
hardly be worth it if you had to include a Template Haskell splice just to have
lenses for the models you declared TH free.</p>
<p>In reality, the <code>lens</code> library isn't required to construct valid lenses. Lenses
are a plain old Haskell type.</p>
<p>We can use beam's <code>Columnar</code> mechanism to automatically derive lenses. The
<code>tableLenses</code> function produces a table value where each column is given a type
<code>LensFor</code>, which is a <code>newtype</code> wrapper over a correctly constructed,
polymorphic Van Laarhoven lens.</p>
<p>We can bring these lenses into scope globally via a global pattern match against
<code>tableLenses</code>. For example, to get lenses for each column of the <code>AddressT</code> and
<code>UserT</code> table.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">-- Add the following to the top of the file, for GHC &gt;8.2</span>
<span class="cm">{-#  LANGUAGE ImpredicativeTypes #-}</span>

<span class="kt">Address</span> <span class="p">(</span><span class="kt">LensFor</span> <span class="n">addressId</span><span class="p">)</span>    <span class="p">(</span><span class="kt">LensFor</span> <span class="n">addressLine1</span><span class="p">)</span>
        <span class="p">(</span><span class="kt">LensFor</span> <span class="n">addressLine2</span><span class="p">)</span> <span class="p">(</span><span class="kt">LensFor</span> <span class="n">addressCity</span><span class="p">)</span>
        <span class="p">(</span><span class="kt">LensFor</span> <span class="n">addressState</span><span class="p">)</span> <span class="p">(</span><span class="kt">LensFor</span> <span class="n">addressZip</span><span class="p">)</span>
        <span class="p">(</span><span class="kt">UserId</span> <span class="p">(</span><span class="kt">LensFor</span> <span class="n">addressForUserId</span><span class="p">))</span> <span class="ow">=</span>
        <span class="n">tableLenses</span>

<span class="kt">User</span> <span class="p">(</span><span class="kt">LensFor</span> <span class="n">userEmail</span><span class="p">)</span>    <span class="p">(</span><span class="kt">LensFor</span> <span class="n">userFirstName</span><span class="p">)</span>
     <span class="p">(</span><span class="kt">LensFor</span> <span class="n">userLastName</span><span class="p">)</span> <span class="p">(</span><span class="kt">LensFor</span> <span class="n">userPassword</span><span class="p">)</span> <span class="ow">=</span>
     <span class="n">tableLenses</span>
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code>ImpredicativeTypes</code> language extension is necessary for newer
GHC to allow the polymorphically typed lenses to be introduced at
the top-level. Older GHCs were more lenient.</p>
</div>
<p>As in tables, we can generate lenses for databases via the <code>dbLenses</code> function.</p>
<div class="codehilite"><pre><span></span><code><span class="kt">ShoppingCartDb</span> <span class="p">(</span><span class="kt">TableLens</span> <span class="n">shoppingCartUsers</span><span class="p">)</span>
               <span class="p">(</span><span class="kt">TableLens</span> <span class="n">shoppingCartUserAddresses</span><span class="p">)</span> <span class="ow">=</span>
               <span class="n">dbLenses</span>
</code></pre></div>

<p>We can ask GHCi for the type of a column lens.</p>
<div class="codehilite"><pre><span></span><code><span class="n">Prelude</span> <span class="n">Database</span><span class="p">.</span><span class="n">Beam</span> <span class="n">Database</span><span class="p">.</span><span class="n">Beam</span><span class="p">.</span><span class="n">Sqlite</span> <span class="n">Data</span><span class="p">.</span><span class="n">Text</span> <span class="n">Database</span><span class="p">.</span><span class="n">SQLite</span><span class="p">.</span><span class="n">Simple</span><span class="o">&gt;</span> <span class="o">:</span><span class="n">t</span> <span class="n">addressId</span>
<span class="n">addressId</span>
  <span class="o">::</span> <span class="n">Functor</span> <span class="n">f2</span> <span class="o">=&gt;</span>
     <span class="p">(</span><span class="n">Columnar</span> <span class="n">f1</span> <span class="n">Int32</span> <span class="o">-&gt;</span> <span class="n">f2</span> <span class="p">(</span><span class="n">Columnar</span> <span class="n">f1</span> <span class="n">Int32</span><span class="p">))</span>
     <span class="o">-&gt;</span> <span class="n">AddressT</span> <span class="n">f1</span> <span class="o">-&gt;</span> <span class="n">f2</span> <span class="p">(</span><span class="n">AddressT</span> <span class="n">f1</span><span class="p">)</span>
</code></pre></div>

<p>This lens is compatible with those of the <code>lens</code> library.</p>
<p>And a table lens, for good measure</p>
<div class="codehilite"><pre><span></span><code><span class="n">Prelude</span> <span class="n">Database</span><span class="p">.</span><span class="n">Beam</span> <span class="n">Database</span><span class="p">.</span><span class="n">Beam</span><span class="p">.</span><span class="n">Sqlite</span> <span class="n">Data</span><span class="p">.</span><span class="n">Text</span> <span class="n">Database</span><span class="p">.</span><span class="n">SQLite</span><span class="p">.</span><span class="n">Simple</span><span class="o">&gt;</span> <span class="o">:</span><span class="n">t</span> <span class="n">shoppingCartUsers</span>
<span class="n">shoppingCartUsers</span>
  <span class="o">::</span> <span class="n">Functor</span> <span class="n">f1</span> <span class="o">=&gt;</span>
     <span class="p">(</span><span class="n">f2</span> <span class="p">(</span><span class="n">TableEntity</span> <span class="n">UserT</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">f1</span> <span class="p">(</span><span class="n">f2</span> <span class="p">(</span><span class="n">TableEntity</span> <span class="n">UserT</span><span class="p">)))</span>
     <span class="o">-&gt;</span> <span class="n">ShoppingCartDb</span> <span class="n">f2</span> <span class="o">-&gt;</span> <span class="n">f1</span> <span class="p">(</span><span class="n">ShoppingCartDb</span> <span class="n">f2</span><span class="p">)</span>
</code></pre></div>

<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>These lens generating functions are <em>awesome</em> but if you use them in a
compiled Haskell module (rather than GHC), GHC may give you odd compile
errors about ambiguous types. These occur due to what's known as the
monomorphism restriction. You can turn it off using the
<code>NoMonomorphismRestriction</code> extension.</p>
<p>The monomorphism restriction is part of the Haskell standard, but there has
been talk about removing it in future language versions. Basically, it
requires GHC to not automatically infer polymorphic types for global
definitions. In this case though, polymorphic global definitions is exactly
what we want.</p>
</div>
<h1 id="working-with-relations">Working with relations</h1>
<p>Now, let's see how we can add related addresses to our database. We begin by
opening up a connection for us to use in the rest of the tutorial.</p>
<p>First, let's open a new database and create the schema.</p>
<div class="codehilite"><pre><span></span><code><span class="gp">$ </span>sqlite3 shoppingcart2.db
<span class="go">SQLite version 3.14.0 2016-07-26 15:17:14</span>
<span class="go">Enter &quot;.help&quot; for usage hints.</span>
<span class="go">sqlite&gt; CREATE TABLE cart_users (email VARCHAR NOT NULL, first_name VARCHAR NOT NULL, last_name VARCHAR NOT NULL, password VARCHAR NOT NULL, PRIMARY KEY( email ));</span>
<span class="go">sqlite&gt; CREATE TABLE addresses ( id INTEGER PRIMARY KEY, address1 VARCHAR NOT NULL, address2 VARCHAR, city VARCHAR NOT NULL, state VARCHAR NOT NULL, zip VARCHAR NOT NULL, for_user__email VARCHAR NOT NULL );</span>
</code></pre></div>

<p>Now, in GHCi, we can use <code>sqlite-simple</code> to get a handle to this database.</p>
<div class="codehilite"><pre><span></span><code><span class="nf">conn</span> <span class="ow">&lt;-</span> <span class="n">open</span> <span class="s">&quot;shoppingcart2.db&quot;</span>
</code></pre></div>

<p>Before we add addresses, we need to add some users that we can reference.</p>
<div class="codehilite"><pre><span></span><code><span class="kr">let</span> <span class="n">james</span> <span class="ow">=</span> <span class="kt">User</span> <span class="s">&quot;james@example.com&quot;</span> <span class="s">&quot;James&quot;</span> <span class="s">&quot;Smith&quot;</span> <span class="s">&quot;b4cc344d25a2efe540adbf2678e2304c&quot;</span>
    <span class="n">betty</span> <span class="ow">=</span> <span class="kt">User</span> <span class="s">&quot;betty@example.com&quot;</span> <span class="s">&quot;Betty&quot;</span> <span class="s">&quot;Jones&quot;</span> <span class="s">&quot;82b054bd83ffad9b6cf8bdb98ce3cc2f&quot;</span>
    <span class="n">sam</span> <span class="ow">=</span> <span class="kt">User</span> <span class="s">&quot;sam@example.com&quot;</span> <span class="s">&quot;Sam&quot;</span> <span class="s">&quot;Taylor&quot;</span> <span class="s">&quot;332532dcfaa1cbf61e2a266bd723612c&quot;</span>
<span class="nf">runBeamSqliteDebug</span> <span class="n">putStrLn</span> <span class="n">conn</span> <span class="o">$</span> <span class="n">runInsert</span> <span class="o">$</span>
  <span class="n">insert</span> <span class="p">(</span><span class="n">_shoppingCartUsers</span> <span class="n">shoppingCartDb</span><span class="p">)</span> <span class="o">$</span>
  <span class="n">insertValues</span> <span class="p">[</span> <span class="n">james</span><span class="p">,</span> <span class="n">betty</span><span class="p">,</span> <span class="n">sam</span> <span class="p">]</span>
</code></pre></div>

<p>Now that we have some <code>User</code> objects, we can create associated addresses. Notice
that above, we used <code>insertValues</code> to insert concrete <code>User</code> rows. This worked
because we could determine every field of <code>User</code> before insertion. <code>Address</code>es
however have a pesky auto-incrementing primary key field. We can get around this
by inserting <em>expressions</em> instead of <em>values</em>. We can use <code>default_</code> to stand
for a value that the database needs to fill in. We can use <code>val_</code> to lift a
literal value into an expression.</p>
<p>With that in mind, let's give James one address, Betty two addresses, and Sam none.</p>
<div class="codehilite"><pre><span></span><code><span class="kr">let</span> <span class="n">addresses</span> <span class="ow">=</span> <span class="p">[</span> <span class="kt">Address</span> <span class="n">default_</span> <span class="p">(</span><span class="n">val_</span> <span class="s">&quot;123 Little Street&quot;</span><span class="p">)</span> <span class="p">(</span><span class="n">val_</span> <span class="kt">Nothing</span><span class="p">)</span> <span class="p">(</span><span class="n">val_</span> <span class="s">&quot;Boston&quot;</span><span class="p">)</span> <span class="p">(</span><span class="n">val_</span> <span class="s">&quot;MA&quot;</span><span class="p">)</span> <span class="p">(</span><span class="n">val_</span> <span class="s">&quot;12345&quot;</span><span class="p">)</span> <span class="p">(</span><span class="n">pk</span> <span class="n">james</span><span class="p">)</span>
                <span class="p">,</span> <span class="kt">Address</span> <span class="n">default_</span> <span class="p">(</span><span class="n">val_</span> <span class="s">&quot;222 Main Street&quot;</span><span class="p">)</span> <span class="p">(</span><span class="n">val_</span> <span class="p">(</span><span class="kt">Just</span> <span class="s">&quot;Ste 1&quot;</span><span class="p">))</span> <span class="p">(</span><span class="n">val_</span> <span class="s">&quot;Houston&quot;</span><span class="p">)</span> <span class="p">(</span><span class="n">val_</span> <span class="s">&quot;TX&quot;</span><span class="p">)</span> <span class="p">(</span><span class="n">val_</span> <span class="s">&quot;8888&quot;</span><span class="p">)</span> <span class="p">(</span><span class="n">pk</span> <span class="n">betty</span><span class="p">)</span>
                <span class="p">,</span> <span class="kt">Address</span> <span class="n">default_</span> <span class="p">(</span><span class="n">val_</span> <span class="s">&quot;9999 Residence Ave&quot;</span><span class="p">)</span> <span class="p">(</span><span class="n">val_</span> <span class="kt">Nothing</span><span class="p">)</span> <span class="p">(</span><span class="n">val_</span> <span class="s">&quot;Sugarland&quot;</span><span class="p">)</span> <span class="p">(</span><span class="n">val_</span> <span class="s">&quot;TX&quot;</span><span class="p">)</span> <span class="p">(</span><span class="n">val_</span> <span class="s">&quot;8989&quot;</span><span class="p">)</span> <span class="p">(</span><span class="n">pk</span> <span class="n">betty</span><span class="p">)</span> <span class="p">]</span>

<span class="nf">runBeamSqliteDebug</span> <span class="n">putStrLn</span> <span class="n">conn</span> <span class="o">$</span> <span class="n">runInsert</span> <span class="o">$</span>
  <span class="n">insert</span> <span class="p">(</span><span class="n">_shoppingCartUserAddresses</span> <span class="n">shoppingCartDb</span><span class="p">)</span> <span class="o">$</span>
  <span class="n">insertExpressions</span> <span class="n">addresses</span>
</code></pre></div>

<p>Notice that we used the <code>pk</code> function to assign the reference to the <code>UserT</code>
table. <code>pk</code> is a synonym of the <code>primaryKey</code> function from the <code>Table</code> type
class. It should be clear what's going on, but if it's not, let's ask GHCi.</p>
<div class="codehilite"><pre><span></span><code><span class="go">*NextSteps&gt; pk (james :: User)p</span>
<span class="go">UserId &quot;james@example.com&quot;</span>
</code></pre></div>

<p>If we query for all the addresses, we'll see that SQLite has assigned them an
appropriate id.</p>
<p>First, let's use the new lenses we made. Make sure to import <code>Lens.Micro</code> or
<code>Control.Lens</code> or whichever (van Laarhoven) lens module you prefer.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item">
            <a href="#tab-0-Haskell" aria-controls="tab-0-Haskell" role="tab" data-toggle="tab" data-lang="haskell">Haskell</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-0-Sql" aria-controls="tab-0-Sql" role="tab" data-toggle="tab" data-lang="sql">Sql</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-0-Output" aria-controls="tab-0-Output" role="tab" data-toggle="tab" data-lang="output">Output</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-0-Haskell">
            <div class="codehilite"><pre><span></span><code><span class="c1">-- import Lens.Micro</span>
<span class="c1">-- import Control.Lens</span>
<span class="nf">addresses</span> <span class="ow">&lt;-</span> <span class="n">runBeamSqliteDebug</span> <span class="n">putStrLn</span> <span class="n">conn</span> <span class="o">$</span>
             <span class="n">runSelectReturningList</span> <span class="o">$</span>
             <span class="n">select</span> <span class="p">(</span><span class="n">all_</span> <span class="p">(</span><span class="n">shoppingCartDb</span> <span class="o">^.</span> <span class="n">shoppingCartUserAddresses</span><span class="p">))</span>
<span class="nf">mapM_</span> <span class="n">print</span> <span class="n">addresses</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-0-Sql">
            <div class="codehilite"><pre><span></span><code><span class="k">SELECT</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;id&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;address1&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;address2&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res2&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;city&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res3&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;state&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res4&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;zip&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res5&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;for_user__email&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res6&quot;</span>
<span class="k">FROM</span> <span class="ss">&quot;addresses&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span><span class="p">;</span>

<span class="c1">-- With values: []</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-0-Output">
            <div class="codehilite"><pre><span></span><code><span class="n">Address</span><span class="w"> </span><span class="err">{</span><span class="n">_addressId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;123 Little Street&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Nothing</span><span class="p">,</span><span class="w"> </span><span class="n">_addressCity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Boston&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;MA&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressZip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;12345&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressForUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UserId</span><span class="w"> </span><span class="ss">&quot;james@example.com&quot;</span><span class="err">}</span><span class="w"></span>
<span class="n">Address</span><span class="w"> </span><span class="err">{</span><span class="n">_addressId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;222 Main Street&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Just</span><span class="w"> </span><span class="ss">&quot;Ste 1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressCity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Houston&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;TX&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressZip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;8888&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressForUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UserId</span><span class="w"> </span><span class="ss">&quot;betty@example.com&quot;</span><span class="err">}</span><span class="w"></span>
<span class="n">Address</span><span class="w"> </span><span class="err">{</span><span class="n">_addressId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;9999 Residence Ave&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Nothing</span><span class="p">,</span><span class="w"> </span><span class="n">_addressCity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Sugarland&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;TX&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressZip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;8989&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressForUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UserId</span><span class="w"> </span><span class="ss">&quot;betty@example.com&quot;</span><span class="err">}</span><span class="w"></span>
</code></pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<h1 id="a-note-about-queries">A note about queries</h1>
<p>In the last tutorial, we saw how queries and list supported similar interfaces.
Namely we saw how <code>limit_</code> is like <code>take</code>, <code>offset_</code> like <code>drop</code>, <code>orderBy</code> like
an enhanced <code>sortBy</code>, and <code>aggregate</code> like an enhanced <code>groupBy</code>. These
corresponded to the <code>LIMIT</code>, <code>OFFSET</code>, <code>ORDER BY</code>, and <code>GROUP BY</code> SQL
constructs. The missing SQL operation in this list is the <code>JOIN</code>, which computes
the cartesian product of two tables. In other words, a join between table <code>A</code>
and table <code>B</code> results in a query of pairs <code>(x, y)</code> for every <code>x</code> in <code>A</code> and
every <code>y</code> in <code>B</code>. SQL joins can result in two-way, three-way, four-way, etc.
cartesian products.</p>
<p>Those familiar with lists in Haskell will note that there is an easy abstraction
for taking <em>n</em>-ary cartesian products over lists: monads.</p>
<h2 id="the-list-monad">The list monad</h2>
<p>We can use GHCi to see what we mean.</p>
<div class="codehilite"><pre><span></span><code><span class="o">*</span><span class="kt">NextSteps</span><span class="o">&gt;</span> <span class="kr">do</span> <span class="p">{</span> <span class="n">x</span> <span class="ow">&lt;-</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">];</span> <span class="n">y</span> <span class="ow">&lt;-</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">];</span> <span class="n">return</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span> <span class="p">}</span>
<span class="p">[(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">)]</span>
</code></pre></div>

<p>We get the two-way cartesian product of <code>[1,2,3]</code> and <code>[4,5,6]</code>. We can make the
product arbitrarily long.</p>
<div class="codehilite"><pre><span></span><code><span class="o">*</span><span class="kt">NextSteps</span><span class="o">&gt;</span> <span class="kr">do</span> <span class="p">{</span> <span class="n">w</span> <span class="ow">&lt;-</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">];</span> <span class="n">x</span> <span class="ow">&lt;-</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">];</span> <span class="n">y</span> <span class="ow">&lt;-</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">];</span> <span class="n">z</span> <span class="ow">&lt;-</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">1</span><span class="p">];</span> <span class="n">return</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">w</span><span class="p">);</span> <span class="p">}</span>
<span class="p">[(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">10</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">10</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">10</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">10</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="o">...</span> <span class="p">]</span>
</code></pre></div>

<p>We can also use <code>guard</code> from <code>Control.Monad</code> to limit the combinations that the
list monad puts together. For example, if we had the lists</p>
<div class="codehilite"><pre><span></span><code><span class="kr">let</span> <span class="n">usersList</span> <span class="ow">=</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;james&quot;</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">&quot;betty&quot;</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s">&quot;tom&quot;</span><span class="p">)]</span>
    <span class="n">addressesList</span> <span class="ow">=</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;address1&quot;</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;address2&quot;</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s">&quot;address3&quot;</span><span class="p">)]</span>
</code></pre></div>

<p>We can use <code>guard</code> to return all pairs of elements from <code>usersList</code> and
<code>addressesList</code> that matched on their first element. For example,</p>
<div class="codehilite"><pre><span></span><code><span class="o">*</span><span class="kt">NextSteps</span><span class="o">&gt;</span> <span class="kr">do</span> <span class="p">{</span> <span class="n">user</span> <span class="ow">&lt;-</span> <span class="n">usersList</span><span class="p">;</span> <span class="n">address</span> <span class="ow">&lt;-</span> <span class="n">addressesList</span><span class="p">;</span> <span class="n">guard</span> <span class="p">(</span><span class="n">fst</span> <span class="n">user</span> <span class="o">==</span> <span class="n">fst</span> <span class="n">address</span><span class="p">);</span> <span class="n">return</span> <span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">address</span><span class="p">)</span> <span class="p">}</span>
<span class="p">[((</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;james&quot;</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;address1&quot;</span><span class="p">)),((</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;james&quot;</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;address2&quot;</span><span class="p">)),((</span><span class="mi">3</span><span class="p">,</span><span class="s">&quot;tom&quot;</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="s">&quot;address3&quot;</span><span class="p">))]</span>
</code></pre></div>

<h2 id="the-query-monad">The query monad</h2>
<p>As I claimed in the first tutorial, queries support many of the same interfaces and operations lists
do. It follows that queries also expose a monadic interface.</p>
<p>For example, to retrieve every pair of user and address, we can write the following query:</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item">
            <a href="#tab-1-Haskell" aria-controls="tab-1-Haskell" role="tab" data-toggle="tab" data-lang="haskell">Haskell</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-1-Sql" aria-controls="tab-1-Sql" role="tab" data-toggle="tab" data-lang="sql">Sql</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-1-Output" aria-controls="tab-1-Output" role="tab" data-toggle="tab" data-lang="output">Output</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-1-Haskell">
            <div class="codehilite"><pre><span></span><code><span class="nf">allPairs</span> <span class="ow">&lt;-</span> <span class="n">runBeamSqliteDebug</span> <span class="n">putStrLn</span> <span class="n">conn</span> <span class="o">$</span>
            <span class="n">runSelectReturningList</span> <span class="o">$</span> <span class="n">select</span> <span class="o">$</span> <span class="kr">do</span>
              <span class="n">user</span> <span class="ow">&lt;-</span> <span class="n">all_</span> <span class="p">(</span><span class="n">shoppingCartDb</span> <span class="o">^.</span> <span class="n">shoppingCartUsers</span><span class="p">)</span>
              <span class="n">address</span> <span class="ow">&lt;-</span> <span class="n">all_</span> <span class="p">(</span><span class="n">shoppingCartDb</span> <span class="o">^.</span> <span class="n">shoppingCartUserAddresses</span><span class="p">)</span>
              <span class="n">return</span> <span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">address</span><span class="p">)</span>

<span class="nf">mapM_</span> <span class="n">print</span> <span class="n">allPairs</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-1-Sql">
            <div class="codehilite"><pre><span></span><code><span class="k">SELECT</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;email&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;first_name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;last_name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res2&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;password&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res3&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;id&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res4&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;address1&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res5&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;address2&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res6&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;city&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res7&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;state&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res8&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;zip&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res9&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;for_user__email&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res10&quot;</span>
<span class="k">FROM</span> <span class="ss">&quot;cart_users&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span>
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="ss">&quot;addresses&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t1&quot;</span><span class="p">;</span>

<span class="c1">-- With values: []</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-1-Output">
            <div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="k">User</span><span class="w"> </span><span class="err">{</span><span class="n">_userEmail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;james@example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userFirstName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;James&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userLastName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Smith&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userPassword</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;b4cc344d25a2efe540adbf2678e2304c&quot;</span><span class="err">}</span><span class="p">,</span><span class="n">Address</span><span class="w"> </span><span class="err">{</span><span class="n">_addressId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;123 Little Street&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Nothing</span><span class="p">,</span><span class="w"> </span><span class="n">_addressCity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Boston&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;MA&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressZip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;12345&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressForUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UserId</span><span class="w"> </span><span class="ss">&quot;james@example.com&quot;</span><span class="err">}</span><span class="p">)</span><span class="w"></span>
<span class="p">(</span><span class="k">User</span><span class="w"> </span><span class="err">{</span><span class="n">_userEmail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;james@example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userFirstName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;James&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userLastName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Smith&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userPassword</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;b4cc344d25a2efe540adbf2678e2304c&quot;</span><span class="err">}</span><span class="p">,</span><span class="n">Address</span><span class="w"> </span><span class="err">{</span><span class="n">_addressId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;222 Main Street&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Just</span><span class="w"> </span><span class="ss">&quot;Ste 1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressCity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Houston&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;TX&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressZip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;8888&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressForUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UserId</span><span class="w"> </span><span class="ss">&quot;betty@example.com&quot;</span><span class="err">}</span><span class="p">)</span><span class="w"></span>
<span class="p">(</span><span class="k">User</span><span class="w"> </span><span class="err">{</span><span class="n">_userEmail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;james@example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userFirstName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;James&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userLastName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Smith&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userPassword</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;b4cc344d25a2efe540adbf2678e2304c&quot;</span><span class="err">}</span><span class="p">,</span><span class="n">Address</span><span class="w"> </span><span class="err">{</span><span class="n">_addressId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;9999 Residence Ave&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Nothing</span><span class="p">,</span><span class="w"> </span><span class="n">_addressCity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Sugarland&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;TX&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressZip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;8989&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressForUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UserId</span><span class="w"> </span><span class="ss">&quot;betty@example.com&quot;</span><span class="err">}</span><span class="p">)</span><span class="w"></span>
<span class="p">(</span><span class="k">User</span><span class="w"> </span><span class="err">{</span><span class="n">_userEmail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;betty@example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userFirstName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Betty&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userLastName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Jones&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userPassword</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;82b054bd83ffad9b6cf8bdb98ce3cc2f&quot;</span><span class="err">}</span><span class="p">,</span><span class="n">Address</span><span class="w"> </span><span class="err">{</span><span class="n">_addressId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;123 Little Street&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Nothing</span><span class="p">,</span><span class="w"> </span><span class="n">_addressCity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Boston&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;MA&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressZip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;12345&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressForUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UserId</span><span class="w"> </span><span class="ss">&quot;james@example.com&quot;</span><span class="err">}</span><span class="p">)</span><span class="w"></span>
<span class="p">(</span><span class="k">User</span><span class="w"> </span><span class="err">{</span><span class="n">_userEmail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;betty@example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userFirstName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Betty&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userLastName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Jones&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userPassword</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;82b054bd83ffad9b6cf8bdb98ce3cc2f&quot;</span><span class="err">}</span><span class="p">,</span><span class="n">Address</span><span class="w"> </span><span class="err">{</span><span class="n">_addressId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;222 Main Street&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Just</span><span class="w"> </span><span class="ss">&quot;Ste 1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressCity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Houston&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;TX&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressZip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;8888&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressForUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UserId</span><span class="w"> </span><span class="ss">&quot;betty@example.com&quot;</span><span class="err">}</span><span class="p">)</span><span class="w"></span>
<span class="p">(</span><span class="k">User</span><span class="w"> </span><span class="err">{</span><span class="n">_userEmail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;betty@example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userFirstName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Betty&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userLastName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Jones&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userPassword</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;82b054bd83ffad9b6cf8bdb98ce3cc2f&quot;</span><span class="err">}</span><span class="p">,</span><span class="n">Address</span><span class="w"> </span><span class="err">{</span><span class="n">_addressId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;9999 Residence Ave&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Nothing</span><span class="p">,</span><span class="w"> </span><span class="n">_addressCity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Sugarland&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;TX&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressZip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;8989&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressForUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UserId</span><span class="w"> </span><span class="ss">&quot;betty@example.com&quot;</span><span class="err">}</span><span class="p">)</span><span class="w"></span>
<span class="p">(</span><span class="k">User</span><span class="w"> </span><span class="err">{</span><span class="n">_userEmail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;sam@example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userFirstName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Sam&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userLastName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Taylor&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userPassword</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;332532dcfaa1cbf61e2a266bd723612c&quot;</span><span class="err">}</span><span class="p">,</span><span class="n">Address</span><span class="w"> </span><span class="err">{</span><span class="n">_addressId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;123 Little Street&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Nothing</span><span class="p">,</span><span class="w"> </span><span class="n">_addressCity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Boston&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;MA&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressZip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;12345&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressForUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UserId</span><span class="w"> </span><span class="ss">&quot;james@example.com&quot;</span><span class="err">}</span><span class="p">)</span><span class="w"></span>
<span class="p">(</span><span class="k">User</span><span class="w"> </span><span class="err">{</span><span class="n">_userEmail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;sam@example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userFirstName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Sam&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userLastName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Taylor&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userPassword</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;332532dcfaa1cbf61e2a266bd723612c&quot;</span><span class="err">}</span><span class="p">,</span><span class="n">Address</span><span class="w"> </span><span class="err">{</span><span class="n">_addressId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;222 Main Street&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Just</span><span class="w"> </span><span class="ss">&quot;Ste 1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressCity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Houston&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;TX&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressZip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;8888&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressForUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UserId</span><span class="w"> </span><span class="ss">&quot;betty@example.com&quot;</span><span class="err">}</span><span class="p">)</span><span class="w"></span>
<span class="p">(</span><span class="k">User</span><span class="w"> </span><span class="err">{</span><span class="n">_userEmail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;sam@example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userFirstName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Sam&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userLastName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Taylor&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userPassword</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;332532dcfaa1cbf61e2a266bd723612c&quot;</span><span class="err">}</span><span class="p">,</span><span class="n">Address</span><span class="w"> </span><span class="err">{</span><span class="n">_addressId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;9999 Residence Ave&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Nothing</span><span class="p">,</span><span class="w"> </span><span class="n">_addressCity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Sugarland&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;TX&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressZip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;8989&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressForUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UserId</span><span class="w"> </span><span class="ss">&quot;betty@example.com&quot;</span><span class="err">}</span><span class="p">)</span><span class="w"></span>
</code></pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<p>Just like with lists we can also use a construct similar to guard to ensure that
we only retrieve users and addresses that are related. The <code>guard_</code> function
takes in expression of type <code>QExpr s Bool</code> which represents a SQL expression
that returns a boolean. <code>QExpr s Bool</code>s support all the common operators we have
on regular <code>Bool</code>, except they're suffixed with a <code>.</code>. For example, where you'd
use <code>(&amp;&amp;)</code> on two Haskell-level <code>Bool</code>s, we'd use <code>(&amp;&amp;.)</code> on <code>QExpr</code>-level
bools.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item">
            <a href="#tab-2-Haskell" aria-controls="tab-2-Haskell" role="tab" data-toggle="tab" data-lang="haskell">Haskell</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-2-Sql" aria-controls="tab-2-Sql" role="tab" data-toggle="tab" data-lang="sql">Sql</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-2-Output" aria-controls="tab-2-Output" role="tab" data-toggle="tab" data-lang="output">Output</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-2-Haskell">
            <div class="codehilite"><pre><span></span><code><span class="nf">usersAndRelatedAddresses</span> <span class="ow">&lt;-</span>
  <span class="n">runBeamSqliteDebug</span> <span class="n">putStrLn</span> <span class="n">conn</span> <span class="o">$</span>
    <span class="n">runSelectReturningList</span> <span class="o">$</span> <span class="n">select</span> <span class="o">$</span>
    <span class="kr">do</span> <span class="n">user</span> <span class="ow">&lt;-</span> <span class="n">all_</span> <span class="p">(</span><span class="n">shoppingCartDb</span> <span class="o">^.</span> <span class="n">shoppingCartUsers</span><span class="p">)</span>
       <span class="n">address</span> <span class="ow">&lt;-</span> <span class="n">all_</span> <span class="p">(</span><span class="n">shoppingCartDb</span> <span class="o">^.</span> <span class="n">shoppingCartUserAddresses</span><span class="p">)</span>
       <span class="n">guard_</span> <span class="p">(</span><span class="n">address</span> <span class="o">^.</span> <span class="n">addressForUserId</span> <span class="o">==.</span> <span class="n">user</span> <span class="o">^.</span> <span class="n">userEmail</span><span class="p">)</span>
       <span class="n">pure</span> <span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">address</span><span class="p">)</span>

<span class="nf">mapM_</span> <span class="n">print</span> <span class="n">usersAndRelatedAddresses</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-2-Sql">
            <div class="codehilite"><pre><span></span><code><span class="k">SELECT</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;email&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;first_name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;last_name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res2&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;password&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res3&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;id&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res4&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;address1&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res5&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;address2&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res6&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;city&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res7&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;state&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res8&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;zip&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res9&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;for_user__email&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res10&quot;</span>
<span class="k">FROM</span> <span class="ss">&quot;cart_users&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span>
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="ss">&quot;addresses&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t1&quot;</span>
<span class="k">WHERE</span> <span class="p">(</span><span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;for_user__email&quot;</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;email&quot;</span><span class="p">);</span>

<span class="c1">-- With values: []</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-2-Output">
            <div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="k">User</span><span class="w"> </span><span class="err">{</span><span class="n">_userEmail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;james@example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userFirstName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;James&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userLastName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Smith&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userPassword</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;b4cc344d25a2efe540adbf2678e2304c&quot;</span><span class="err">}</span><span class="p">,</span><span class="n">Address</span><span class="w"> </span><span class="err">{</span><span class="n">_addressId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;123 Little Street&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Nothing</span><span class="p">,</span><span class="w"> </span><span class="n">_addressCity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Boston&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;MA&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressZip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;12345&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressForUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UserId</span><span class="w"> </span><span class="ss">&quot;james@example.com&quot;</span><span class="err">}</span><span class="p">)</span><span class="w"></span>
<span class="p">(</span><span class="k">User</span><span class="w"> </span><span class="err">{</span><span class="n">_userEmail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;betty@example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userFirstName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Betty&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userLastName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Jones&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userPassword</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;82b054bd83ffad9b6cf8bdb98ce3cc2f&quot;</span><span class="err">}</span><span class="p">,</span><span class="n">Address</span><span class="w"> </span><span class="err">{</span><span class="n">_addressId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;222 Main Street&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Just</span><span class="w"> </span><span class="ss">&quot;Ste 1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressCity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Houston&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;TX&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressZip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;8888&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressForUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UserId</span><span class="w"> </span><span class="ss">&quot;betty@example.com&quot;</span><span class="err">}</span><span class="p">)</span><span class="w"></span>
<span class="p">(</span><span class="k">User</span><span class="w"> </span><span class="err">{</span><span class="n">_userEmail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;betty@example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userFirstName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Betty&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userLastName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Jones&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userPassword</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;82b054bd83ffad9b6cf8bdb98ce3cc2f&quot;</span><span class="err">}</span><span class="p">,</span><span class="n">Address</span><span class="w"> </span><span class="err">{</span><span class="n">_addressId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;9999 Residence Ave&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Nothing</span><span class="p">,</span><span class="w"> </span><span class="n">_addressCity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Sugarland&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;TX&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressZip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;8989&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressForUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UserId</span><span class="w"> </span><span class="ss">&quot;betty@example.com&quot;</span><span class="err">}</span><span class="p">)</span><span class="w"></span>
</code></pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<p>Of course this is kind of messy because it involves manually matching the
primary key of <code>User</code> with the reference in <code>Address</code>. Alternatively, we can use
the <code>references_</code> predicate to have beam automatically generate a <code>QExpr</code>
expression that can match primary keys together.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item">
            <a href="#tab-3-Haskell" aria-controls="tab-3-Haskell" role="tab" data-toggle="tab" data-lang="haskell">Haskell</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-3-Sql" aria-controls="tab-3-Sql" role="tab" data-toggle="tab" data-lang="sql">Sql</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-3-Output" aria-controls="tab-3-Output" role="tab" data-toggle="tab" data-lang="output">Output</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-3-Haskell">
            <div class="codehilite"><pre><span></span><code><span class="nf">usersAndRelatedAddressesUsingReferences</span> <span class="ow">&lt;-</span>
  <span class="n">runBeamSqliteDebug</span> <span class="n">putStrLn</span> <span class="n">conn</span> <span class="o">$</span>
    <span class="n">runSelectReturningList</span> <span class="o">$</span> <span class="n">select</span> <span class="o">$</span>
    <span class="kr">do</span> <span class="n">user</span> <span class="ow">&lt;-</span> <span class="n">all_</span> <span class="p">(</span><span class="n">shoppingCartDb</span> <span class="o">^.</span> <span class="n">shoppingCartUsers</span><span class="p">)</span>
       <span class="n">address</span> <span class="ow">&lt;-</span> <span class="n">all_</span> <span class="p">(</span><span class="n">shoppingCartDb</span> <span class="o">^.</span> <span class="n">shoppingCartUserAddresses</span><span class="p">)</span>

       <span class="n">guard_</span> <span class="p">(</span><span class="n">_addressForUser</span> <span class="n">address</span> <span class="p">`</span><span class="n">references_</span><span class="p">`</span> <span class="n">user</span><span class="p">)</span>
       <span class="n">pure</span> <span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">address</span><span class="p">)</span>

<span class="nf">mapM_</span> <span class="n">print</span> <span class="n">usersAndRelatedAddressesUsingReferences</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-3-Sql">
            <div class="codehilite"><pre><span></span><code><span class="k">SELECT</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;email&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;first_name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;last_name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res2&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;password&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res3&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;id&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res4&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;address1&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res5&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;address2&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res6&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;city&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res7&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;state&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res8&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;zip&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res9&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;for_user__email&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res10&quot;</span>
<span class="k">FROM</span> <span class="ss">&quot;cart_users&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span>
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="ss">&quot;addresses&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t1&quot;</span>
<span class="k">WHERE</span> <span class="p">(</span><span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;for_user__email&quot;</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;email&quot;</span><span class="p">);</span>

<span class="c1">-- With values: []</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-3-Output">
            <div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="k">User</span><span class="w"> </span><span class="err">{</span><span class="n">_userEmail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;james@example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userFirstName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;James&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userLastName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Smith&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userPassword</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;b4cc344d25a2efe540adbf2678e2304c&quot;</span><span class="err">}</span><span class="p">,</span><span class="n">Address</span><span class="w"> </span><span class="err">{</span><span class="n">_addressId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;123 Little Street&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Nothing</span><span class="p">,</span><span class="w"> </span><span class="n">_addressCity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Boston&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;MA&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressZip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;12345&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressForUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UserId</span><span class="w"> </span><span class="ss">&quot;james@example.com&quot;</span><span class="err">}</span><span class="p">)</span><span class="w"></span>
<span class="p">(</span><span class="k">User</span><span class="w"> </span><span class="err">{</span><span class="n">_userEmail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;betty@example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userFirstName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Betty&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userLastName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Jones&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userPassword</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;82b054bd83ffad9b6cf8bdb98ce3cc2f&quot;</span><span class="err">}</span><span class="p">,</span><span class="n">Address</span><span class="w"> </span><span class="err">{</span><span class="n">_addressId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;222 Main Street&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Just</span><span class="w"> </span><span class="ss">&quot;Ste 1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressCity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Houston&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;TX&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressZip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;8888&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressForUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UserId</span><span class="w"> </span><span class="ss">&quot;betty@example.com&quot;</span><span class="err">}</span><span class="p">)</span><span class="w"></span>
<span class="p">(</span><span class="k">User</span><span class="w"> </span><span class="err">{</span><span class="n">_userEmail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;betty@example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userFirstName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Betty&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userLastName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Jones&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userPassword</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;82b054bd83ffad9b6cf8bdb98ce3cc2f&quot;</span><span class="err">}</span><span class="p">,</span><span class="n">Address</span><span class="w"> </span><span class="err">{</span><span class="n">_addressId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;9999 Residence Ave&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Nothing</span><span class="p">,</span><span class="w"> </span><span class="n">_addressCity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Sugarland&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;TX&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressZip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;8989&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressForUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UserId</span><span class="w"> </span><span class="ss">&quot;betty@example.com&quot;</span><span class="err">}</span><span class="p">)</span><span class="w"></span>
</code></pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<p>You may have noticed that the joins up until now did not include a SQL <code>ON</code>
clause. Instead we joined the tables together, and then used the <code>WHERE</code> clause
to filter out results we don't want. If you'd like to use the <code>ON</code> clause to
make the SQL clearer or save a line in your code, beam offers the <code>related_</code>
combinator to pull related tables directly into the query monad.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item">
            <a href="#tab-4-Haskell" aria-controls="tab-4-Haskell" role="tab" data-toggle="tab" data-lang="haskell">Haskell</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-4-Sql" aria-controls="tab-4-Sql" role="tab" data-toggle="tab" data-lang="sql">Sql</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-4-Output" aria-controls="tab-4-Output" role="tab" data-toggle="tab" data-lang="output">Output</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-4-Haskell">
            <div class="codehilite"><pre><span></span><code><span class="nf">usersAndRelatedAddressesUsingRelated</span> <span class="ow">&lt;-</span>
  <span class="n">runBeamSqliteDebug</span> <span class="n">putStrLn</span> <span class="n">conn</span> <span class="o">$</span>
    <span class="n">runSelectReturningList</span> <span class="o">$</span> <span class="n">select</span> <span class="o">$</span>
    <span class="kr">do</span> <span class="n">address</span> <span class="ow">&lt;-</span> <span class="n">all_</span> <span class="p">(</span><span class="n">shoppingCartDb</span> <span class="o">^.</span> <span class="n">shoppingCartUserAddresses</span><span class="p">)</span>
       <span class="n">user</span> <span class="ow">&lt;-</span> <span class="n">related_</span> <span class="p">(</span><span class="n">shoppingCartDb</span> <span class="o">^.</span> <span class="n">shoppingCartUsers</span><span class="p">)</span> <span class="p">(</span><span class="n">_addressForUser</span> <span class="n">address</span><span class="p">)</span>
       <span class="n">pure</span> <span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">address</span><span class="p">)</span>

<span class="nf">mapM_</span> <span class="n">print</span> <span class="n">usersAndRelatedAddressesUsingRelated</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-4-Sql">
            <div class="codehilite"><pre><span></span><code><span class="k">SELECT</span> <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;email&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;first_name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;last_name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res2&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;password&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res3&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;id&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res4&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;address1&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res5&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;address2&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res6&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;city&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res7&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;state&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res8&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;zip&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res9&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;for_user__email&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res10&quot;</span>
<span class="k">FROM</span> <span class="ss">&quot;addresses&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span>
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="ss">&quot;cart_users&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t1&quot;</span> <span class="k">ON</span> <span class="p">(</span><span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;for_user__email&quot;</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="ss">&quot;t1&quot;</span><span class="p">.</span><span class="ss">&quot;email&quot;</span><span class="p">);</span>

<span class="c1">-- With values: []</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-4-Output">
            <div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="k">User</span><span class="w"> </span><span class="err">{</span><span class="n">_userEmail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;james@example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userFirstName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;James&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userLastName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Smith&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userPassword</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;b4cc344d25a2efe540adbf2678e2304c&quot;</span><span class="err">}</span><span class="p">,</span><span class="n">Address</span><span class="w"> </span><span class="err">{</span><span class="n">_addressId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;123 Little Street&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Nothing</span><span class="p">,</span><span class="w"> </span><span class="n">_addressCity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Boston&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;MA&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressZip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;12345&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressForUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UserId</span><span class="w"> </span><span class="ss">&quot;james@example.com&quot;</span><span class="err">}</span><span class="p">)</span><span class="w"></span>
<span class="p">(</span><span class="k">User</span><span class="w"> </span><span class="err">{</span><span class="n">_userEmail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;betty@example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userFirstName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Betty&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userLastName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Jones&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userPassword</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;82b054bd83ffad9b6cf8bdb98ce3cc2f&quot;</span><span class="err">}</span><span class="p">,</span><span class="n">Address</span><span class="w"> </span><span class="err">{</span><span class="n">_addressId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;222 Main Street&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Just</span><span class="w"> </span><span class="ss">&quot;Ste 1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressCity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Houston&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;TX&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressZip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;8888&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressForUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UserId</span><span class="w"> </span><span class="ss">&quot;betty@example.com&quot;</span><span class="err">}</span><span class="p">)</span><span class="w"></span>
<span class="p">(</span><span class="k">User</span><span class="w"> </span><span class="err">{</span><span class="n">_userEmail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;betty@example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userFirstName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Betty&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userLastName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Jones&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userPassword</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;82b054bd83ffad9b6cf8bdb98ce3cc2f&quot;</span><span class="err">}</span><span class="p">,</span><span class="n">Address</span><span class="w"> </span><span class="err">{</span><span class="n">_addressId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;9999 Residence Ave&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Nothing</span><span class="p">,</span><span class="w"> </span><span class="n">_addressCity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Sugarland&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;TX&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressZip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;8989&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressForUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UserId</span><span class="w"> </span><span class="ss">&quot;betty@example.com&quot;</span><span class="err">}</span><span class="p">)</span><span class="w"></span>
</code></pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<p>We can also query the addresses for a particular user given a <code>UserId</code>.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item">
            <a href="#tab-5-Haskell" aria-controls="tab-5-Haskell" role="tab" data-toggle="tab" data-lang="haskell">Haskell</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-5-Sql" aria-controls="tab-5-Sql" role="tab" data-toggle="tab" data-lang="sql">Sql</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-5-Output" aria-controls="tab-5-Output" role="tab" data-toggle="tab" data-lang="output">Output</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-5-Haskell">
            <div class="codehilite"><pre><span></span><code><span class="c1">-- This is a contrived example to show how we can use an arbitrary UserId to fetch a particular user.</span>
<span class="c1">-- We don&#39;t always have access to the full &#39;User&#39; lying around. For example we may be in a function that</span>
<span class="c1">-- only accepts &#39;UserId&#39;s.</span>

<span class="kr">let</span> <span class="n">bettyId</span> <span class="ow">=</span> <span class="kt">UserId</span> <span class="s">&quot;betty@example.com&quot;</span> <span class="ow">::</span> <span class="kt">UserId</span>

<span class="nf">bettysAddresses</span> <span class="ow">&lt;-</span>
  <span class="n">runBeamSqliteDebug</span> <span class="n">putStrLn</span> <span class="n">conn</span> <span class="o">$</span>
    <span class="n">runSelectReturningList</span> <span class="o">$</span> <span class="n">select</span> <span class="o">$</span>
    <span class="kr">do</span> <span class="n">address</span> <span class="ow">&lt;-</span> <span class="n">all_</span> <span class="p">(</span><span class="n">shoppingCartDb</span> <span class="o">^.</span> <span class="n">shoppingCartUserAddresses</span><span class="p">)</span>
       <span class="n">guard_</span> <span class="p">(</span><span class="n">_addressForUser</span> <span class="n">address</span> <span class="o">==.</span> <span class="n">val_</span> <span class="n">bettyId</span><span class="p">)</span>
       <span class="n">pure</span> <span class="n">address</span>

<span class="nf">mapM_</span> <span class="n">print</span> <span class="n">bettysAddresses</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-5-Sql">
            <div class="codehilite"><pre><span></span><code><span class="k">SELECT</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;id&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;address1&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;address2&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res2&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;city&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res3&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;state&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res4&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;zip&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res5&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;for_user__email&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res6&quot;</span>
<span class="k">FROM</span> <span class="ss">&quot;addresses&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span>
<span class="k">WHERE</span> <span class="p">(</span><span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;for_user__email&quot;</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="o">?</span><span class="p">);</span>

<span class="c1">-- With values: [SQLText &quot;betty@example.com&quot;]</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-5-Output">
            <div class="codehilite"><pre><span></span><code><span class="n">Address</span><span class="w"> </span><span class="err">{</span><span class="n">_addressId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;222 Main Street&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Just</span><span class="w"> </span><span class="ss">&quot;Ste 1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressCity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Houston&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;TX&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressZip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;8888&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressForUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UserId</span><span class="w"> </span><span class="ss">&quot;betty@example.com&quot;</span><span class="err">}</span><span class="w"></span>
<span class="n">Address</span><span class="w"> </span><span class="err">{</span><span class="n">_addressId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;9999 Residence Ave&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Nothing</span><span class="p">,</span><span class="w"> </span><span class="n">_addressCity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Sugarland&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;TX&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressZip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;8989&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressForUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UserId</span><span class="w"> </span><span class="ss">&quot;betty@example.com&quot;</span><span class="err">}</span><span class="w"></span>
</code></pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>More complicated joins are also supported. See the section
on <a href="../../user-guide/queries/relationships/">relationships</a></p>
</div>
<h1 id="updates-and-deletions">Updates and deletions</h1>
<p>So far we've only seen how to insert data and query it. There are two other SQL
operations that we have not covered: updates and deletions. Beam has full
support for these manipulations as well.</p>
<h2 id="updates">Updates</h2>
<p>Like <code>INSERT</code> and <code>SELECT</code>, to run an <code>UPDATE</code> command, we use the <code>runUpdate</code>
function, with a value of <code>SqlUpdate</code>.</p>
<p>The <code>save</code> function constructs a value of <code>SqlUpdate</code> given a full record. It
will generate an <code>UPDATE</code> that will set every field (except for the primary key
fields) for the row that completely matches the primary key.</p>
<p>Let's first look at updating passwords given a <code>User</code>. For this we can use the
<code>saveTo</code> function. Suppose James wants to change his password to the md5 hash of
"supersecure", which is <code>52a516ca6df436828d9c0d26e31ef704</code>. We have a <code>User</code>
object representing James so we can simply call <code>saveTo</code> on the update value to
update the corresponding record in the database.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item">
            <a href="#tab-6-Haskell" aria-controls="tab-6-Haskell" role="tab" data-toggle="tab" data-lang="haskell">Haskell</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-6-Sql" aria-controls="tab-6-Sql" role="tab" data-toggle="tab" data-lang="sql">Sql</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-6-Output" aria-controls="tab-6-Output" role="tab" data-toggle="tab" data-lang="output">Output</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-6-Haskell">
            <div class="codehilite"><pre><span></span><code><span class="p">[</span><span class="n">james</span><span class="p">]</span> <span class="ow">&lt;-</span>
  <span class="n">runBeamSqliteDebug</span> <span class="n">putStrLn</span> <span class="n">conn</span> <span class="o">$</span>
    <span class="kr">do</span> <span class="n">runUpdate</span> <span class="o">$</span>
         <span class="n">save</span> <span class="p">(</span><span class="n">shoppingCartDb</span> <span class="o">^.</span> <span class="n">shoppingCartUsers</span><span class="p">)</span> <span class="p">(</span><span class="n">james</span> <span class="p">{</span> <span class="n">_userPassword</span> <span class="ow">=</span> <span class="s">&quot;52a516ca6df436828d9c0d26e31ef704&quot;</span> <span class="p">})</span>

       <span class="n">runSelectReturningList</span> <span class="o">$</span>
         <span class="n">lookup_</span> <span class="p">(</span><span class="n">shoppingCartDb</span> <span class="o">^.</span> <span class="n">shoppingCartUsers</span><span class="p">)</span> <span class="p">(</span><span class="kt">UserId</span> <span class="s">&quot;james@example.com&quot;</span><span class="p">)</span>

<span class="nf">putStrLn</span> <span class="p">(</span><span class="s">&quot;James&#39;s new password is &quot;</span> <span class="o">++</span> <span class="n">show</span> <span class="p">(</span><span class="n">james</span> <span class="o">^.</span> <span class="n">userPassword</span><span class="p">))</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-6-Sql">
            <div class="codehilite"><pre><span></span><code><span class="k">UPDATE</span> <span class="ss">&quot;cart_users&quot;</span>
<span class="k">SET</span> <span class="ss">&quot;first_name&quot;</span><span class="o">=?</span><span class="p">,</span>
    <span class="ss">&quot;last_name&quot;</span><span class="o">=?</span><span class="p">,</span>
    <span class="ss">&quot;password&quot;</span><span class="o">=?</span>
<span class="k">WHERE</span> <span class="p">(</span><span class="o">?</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="ss">&quot;email&quot;</span><span class="p">);</span>

<span class="c1">-- With values: [SQLText &quot;James&quot;,SQLText &quot;Smith&quot;,SQLText &quot;52a516ca6df436828d9c0d26e31ef704&quot;,SQLText &quot;james@example.com&quot;]</span>

<span class="k">SELECT</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;email&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;first_name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;last_name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res2&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;password&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res3&quot;</span>
<span class="k">FROM</span> <span class="ss">&quot;cart_users&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span>
<span class="k">WHERE</span> <span class="p">(</span><span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;email&quot;</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="o">?</span><span class="p">);</span>

<span class="c1">-- With values: [SQLText &quot;james@example.com&quot;]</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-6-Output">
            <div class="codehilite"><pre><span></span><code>James&#39;s new password is &quot;52a516ca6df436828d9c0d26e31ef704&quot;
</code></pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><code>lookup_</code> (defined in <code>Database.Beam.Query</code>) can be used to easily lookup a
single entity given a table entity in a database and a primary key.</p>
</div>
<p>This works great, but <code>save</code> requires that we have the whole <code>User</code> object at
our disposal. Additionally, you'll notice that it causes every field to be set
in the <code>UPDATE</code> query. Typically, this doesn't matter, but sometimes we'd like
to update fewer fields, multiple rows, or use criteria other than a primary key
match. The <code>update</code> function offers finer-grained control over the command
submitted to the database.</p>
<p>To illustrate use of this function, let's suppose the city of "Sugarland, TX"
was renamed "Sugarville, TX" and had its ZIP code changed to be "12345"
citywide. The following beam command will update all addresses in the old city
to use the new name and ZIP code.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item">
            <a href="#tab-7-Haskell" aria-controls="tab-7-Haskell" role="tab" data-toggle="tab" data-lang="haskell">Haskell</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-7-Sql" aria-controls="tab-7-Sql" role="tab" data-toggle="tab" data-lang="sql">Sql</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-7-Output" aria-controls="tab-7-Output" role="tab" data-toggle="tab" data-lang="output">Output</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-7-Haskell">
            <div class="codehilite"><pre><span></span><code><span class="nf">addresses</span> <span class="ow">&lt;-</span>
  <span class="n">runBeamSqliteDebug</span> <span class="n">putStrLn</span> <span class="n">conn</span> <span class="o">$</span>
    <span class="kr">do</span> <span class="n">runUpdate</span> <span class="o">$</span>
         <span class="n">update</span> <span class="p">(</span><span class="n">shoppingCartDb</span> <span class="o">^.</span> <span class="n">shoppingCartUserAddresses</span><span class="p">)</span>
                <span class="p">(</span><span class="nf">\</span><span class="n">address</span> <span class="ow">-&gt;</span> <span class="n">mconcat</span>
                             <span class="p">[</span> <span class="n">address</span> <span class="o">^.</span> <span class="n">addressCity</span> <span class="o">&lt;-.</span> <span class="n">val_</span> <span class="s">&quot;Sugarville&quot;</span>
                             <span class="p">,</span> <span class="n">address</span> <span class="o">^.</span> <span class="n">addressZip</span> <span class="o">&lt;-.</span> <span class="n">val_</span> <span class="s">&quot;12345&quot;</span> <span class="p">])</span>
                <span class="p">(</span><span class="nf">\</span><span class="n">address</span> <span class="ow">-&gt;</span> <span class="n">address</span> <span class="o">^.</span> <span class="n">addressCity</span> <span class="o">==.</span> <span class="n">val_</span> <span class="s">&quot;Sugarland&quot;</span> <span class="o">&amp;&amp;.</span>
                             <span class="n">address</span> <span class="o">^.</span> <span class="n">addressState</span> <span class="o">==.</span> <span class="n">val_</span> <span class="s">&quot;TX&quot;</span><span class="p">)</span>

       <span class="n">runSelectReturningList</span> <span class="o">$</span> <span class="n">select</span> <span class="o">$</span> <span class="n">all_</span> <span class="p">(</span><span class="n">shoppingCartDb</span> <span class="o">^.</span> <span class="n">shoppingCartUserAddresses</span><span class="p">)</span>

<span class="nf">mapM_</span> <span class="n">print</span> <span class="n">addresses</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-7-Sql">
            <div class="codehilite"><pre><span></span><code><span class="k">UPDATE</span> <span class="ss">&quot;addresses&quot;</span>
<span class="k">SET</span> <span class="ss">&quot;city&quot;</span><span class="o">=?</span><span class="p">,</span>
    <span class="ss">&quot;zip&quot;</span><span class="o">=?</span>
<span class="k">WHERE</span> <span class="p">((</span><span class="ss">&quot;city&quot;</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="o">?</span><span class="p">))</span>
  <span class="k">AND</span> <span class="p">((</span><span class="ss">&quot;state&quot;</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="o">?</span><span class="p">));</span>

<span class="c1">-- With values: [SQLText &quot;Sugarville&quot;,SQLText &quot;12345&quot;,SQLText &quot;Sugarland&quot;,SQLText &quot;TX&quot;]</span>

<span class="k">SELECT</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;id&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;address1&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;address2&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res2&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;city&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res3&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;state&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res4&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;zip&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res5&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;for_user__email&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res6&quot;</span>
<span class="k">FROM</span> <span class="ss">&quot;addresses&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span><span class="p">;</span>

<span class="c1">-- With values: []</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-7-Output">
            <div class="codehilite"><pre><span></span><code><span class="n">Address</span><span class="w"> </span><span class="err">{</span><span class="n">_addressId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;123 Little Street&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Nothing</span><span class="p">,</span><span class="w"> </span><span class="n">_addressCity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Boston&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;MA&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressZip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;12345&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressForUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UserId</span><span class="w"> </span><span class="ss">&quot;james@example.com&quot;</span><span class="err">}</span><span class="w"></span>
<span class="n">Address</span><span class="w"> </span><span class="err">{</span><span class="n">_addressId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;222 Main Street&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Just</span><span class="w"> </span><span class="ss">&quot;Ste 1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressCity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Houston&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;TX&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressZip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;8888&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressForUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UserId</span><span class="w"> </span><span class="ss">&quot;betty@example.com&quot;</span><span class="err">}</span><span class="w"></span>
<span class="n">Address</span><span class="w"> </span><span class="err">{</span><span class="n">_addressId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;9999 Residence Ave&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressLine2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Nothing</span><span class="p">,</span><span class="w"> </span><span class="n">_addressCity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Sugarville&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;TX&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressZip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;12345&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_addressForUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UserId</span><span class="w"> </span><span class="ss">&quot;betty@example.com&quot;</span><span class="err">}</span><span class="w"></span>
</code></pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<h2 id="deletions">Deletions</h2>
<p>Now suppose that Betty has decided to give up her place in Houston. We can use
<code>runDelete</code> to run a <code>DELETE</code> command.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item">
            <a href="#tab-8-Haskell" aria-controls="tab-8-Haskell" role="tab" data-toggle="tab" data-lang="haskell">Haskell</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-8-Sql" aria-controls="tab-8-Sql" role="tab" data-toggle="tab" data-lang="sql">Sql</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-8-Haskell">
            <div class="codehilite"><pre><span></span><code><span class="nf">runBeamSqliteDebug</span> <span class="n">putStrLn</span> <span class="n">conn</span> <span class="o">$</span>
  <span class="n">runDelete</span> <span class="o">$</span>
  <span class="n">delete</span> <span class="p">(</span><span class="n">shoppingCartDb</span> <span class="o">^.</span> <span class="n">shoppingCartUserAddresses</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">\</span><span class="n">address</span> <span class="ow">-&gt;</span> <span class="n">address</span> <span class="o">^.</span> <span class="n">addressCity</span> <span class="o">==.</span> <span class="s">&quot;Houston&quot;</span> <span class="o">&amp;&amp;.</span>
                      <span class="n">_addressForUser</span> <span class="n">address</span> <span class="p">`</span><span class="n">references_</span><span class="p">`</span> <span class="n">betty</span><span class="p">)</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-8-Sql">
            <div class="codehilite"><pre><span></span><code><span class="k">DELETE</span>
<span class="k">FROM</span> <span class="ss">&quot;addresses&quot;</span>
<span class="k">WHERE</span> <span class="p">((</span><span class="ss">&quot;city&quot;</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="o">?</span><span class="p">))</span>
  <span class="k">AND</span> <span class="p">((</span><span class="ss">&quot;for_user__email&quot;</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="o">?</span><span class="p">));</span>

<span class="c1">-- With values: [SQLText &quot;Houston&quot;,SQLText &quot;betty@example.com&quot;]</span>
</code></pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<h1 id="conclusion">Conclusion</h1>
<p>In this tutorial we created our first beam relationship. We saw how to use the
modifications system to override the default names given to database entities.
We saw how to use <code>tableLenses</code> to generate lenses that can be used with any
lens library. We used the monadic query interface to write queries that used SQL
joins, and we saw how beam makes it easy to automatically pull related tables
into our queries. Finally we introduced the <code>runUpdate</code> and <code>runDelete</code>
functions and demonstrated several ways to construct UPDATEs and DELETEs.</p>
<p>At this point, we've covered enough of the beam interface to start writing
interesting programs. Take some time to explore beam and create your own
databases. Afterwards, read on for the last part of the tutorial.</p>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>Actually, any <code>Beamable</code> type can be wholly embedded in another. See the
   section on models in the <a href="../../user-guide/models/">user guide</a> for more
   information.&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:2">
<p>The <a href="../../user-guide/models/">models guide</a> explains the exact mechanisms
   used&#160;<a class="footnote-backref" href="#fnref:2" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
</ol>
</div>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../tutorial1/" title="Part 1" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Part 1
              </div>
            </div>
          </a>
        
        
          <a href="../tutorial3/" title="Part 3" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Part 3
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4,11V13H16L10.5,18.5L11.92,19.92L19.84,12L11.92,4.08L10.5,5.5L16,11H4Z" /></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    

      <script src="../../assets/javascripts/vendor.36cbf620.min.js"></script>
      <script src="../../assets/javascripts/bundle.00c583dd.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.7f7c8775.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
<script type="text/javascript" language="javascript"  src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
<script type="text/javascript" language="javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script type="text/javascript" language="javascript">
 $(document.body).tab();
 $(".nav-item:first-child").tab("show");
</script>

  </body>
</html>