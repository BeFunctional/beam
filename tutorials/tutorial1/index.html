


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-5.0.2">
    
    
      
        <title>Part 1 - Beam Documentation</title>
      
    
    

      <link rel="stylesheet" href="../../assets/stylesheets/main.07c9fbf5.min.css">
      
      
    
<link rel="stylesheet" type="text/css" href="../../css/beam.css"/>

    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../../docs/theme/css/beam.css">
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#beam-module-structure" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="Beam Documentation" class="md-header-nav__button md-logo" aria-label="Beam Documentation">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,8A3,3 0 0,0 15,5A3,3 0 0,0 12,2A3,3 0 0,0 9,5A3,3 0 0,0 12,8M12,11.54C9.64,9.35 6.5,8 3,8V19C6.5,19 9.64,20.35 12,22.54C14.36,20.35 17.5,19 21,19V8C17.5,8 14.36,9.35 12,11.54Z" /></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z" /></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Beam Documentation
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Part 1
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" /></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/haskell-beam/beam/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    haskell-beam/beam
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Beam Documentation" class="md-nav__button md-logo" aria-label="Beam Documentation">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,8A3,3 0 0,0 15,5A3,3 0 0,0 12,2A3,3 0 0,0 9,5A3,3 0 0,0 12,8M12,11.54C9.64,9.35 6.5,8 3,8V19C6.5,19 9.64,20.35 12,22.54C14.36,20.35 17.5,19 21,19V8C17.5,8 14.36,9.35 12,11.54Z" /></svg>

    </a>
    Beam Documentation
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/haskell-beam/beam/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    haskell-beam/beam
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../about/faq/" title="Frequently Asked Questions" class="md-nav__link">
      Frequently Asked Questions
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Tutorial
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Tutorial" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Tutorial
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Part 1
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,9H17V7H3V9M3,13H17V11H3V13M3,17H17V15H3V17M19,17H21V15H19V17M19,7V9H21V7H19M19,13H21V11H19V13Z" /></svg>
        </span>
      </label>
    
    <a href="./" title="Part 1" class="md-nav__link md-nav__link--active">
      Part 1
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#beam-module-structure" class="md-nav__link">
    Beam Module Structure
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-our-first-table" class="md-nav__link">
    Defining our first table
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#teaching-beam-about-our-table" class="md-nav__link">
    Teaching Beam about our table
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-our-database" class="md-nav__link">
    Defining our database
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-users-to-our-database" class="md-nav__link">
    Adding users to our database
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#querying-the-database" class="md-nav__link">
    Querying the database
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregations" class="md-nav__link">
    Aggregations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    Conclusion
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tutorial2/" title="Part 2" class="md-nav__link">
      Part 2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tutorial3/" title="Part 3" class="md-nav__link">
      Part 3
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      User Guide
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="User Guide" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        User Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/models/" title="Models" class="md-nav__link">
      Models
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/databases/" title="Databases" class="md-nav__link">
      Databases
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/backends/" title="Backends" class="md-nav__link">
      Backends
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/expressions/" title="Expressions" class="md-nav__link">
      Expressions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4-5" type="checkbox" id="nav-4-5">
    
    <label class="md-nav__link" for="nav-4-5">
      Queries
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Queries" data-md-level="2">
      <label class="md-nav__title" for="nav-4-5">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Queries
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/queries/basic/" title="Basic Queries" class="md-nav__link">
      Basic Queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/queries/select/" title="More complex SELECTs" class="md-nav__link">
      More complex SELECTs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/queries/ordering/" title="Ordering" class="md-nav__link">
      Ordering
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/queries/relationships/" title="Relationships" class="md-nav__link">
      Relationships
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/queries/aggregates/" title="Aggregates" class="md-nav__link">
      Aggregates
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/queries/combining-queries/" title="Combining queries" class="md-nav__link">
      Combining queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/queries/window-functions/" title="Window functions" class="md-nav__link">
      Window functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/queries/advanced-features/" title="Advanced features" class="md-nav__link">
      Advanced features
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/queries/common-table-expressions/" title="Common table expressions" class="md-nav__link">
      Common table expressions
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/extensibility/" title="Custom queries" class="md-nav__link">
      Custom queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4-7" type="checkbox" id="nav-4-7">
    
    <label class="md-nav__link" for="nav-4-7">
      Data Manipulation
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Data Manipulation" data-md-level="2">
      <label class="md-nav__title" for="nav-4-7">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Data Manipulation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/manipulation/insert/" title="INSERT" class="md-nav__link">
      INSERT
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/manipulation/update/" title="UPDATE" class="md-nav__link">
      UPDATE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/manipulation/delete/" title="DELETE" class="md-nav__link">
      DELETE
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Schema management
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Schema management" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Schema management
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../schema-guide/migrations/" title="The Migrations Framework" class="md-nav__link">
      The Migrations Framework
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../schema-guide/tool/" title="The beam-migrate tool" class="md-nav__link">
      The beam-migrate tool
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../schema-guide/library/" title="The beam-migrate library" class="md-nav__link">
      The beam-migrate library
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Backends
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Backends" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Backends
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/backends/beam-postgres/" title="beam-postgres" class="md-nav__link">
      beam-postgres
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/backends/beam-sqlite/" title="beam-sqlite" class="md-nav__link">
      beam-sqlite
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/custom-backends/" title="Writing a Custom Backend" class="md-nav__link">
      Writing a Custom Backend
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      About
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="About" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        About
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../about/compatibility/" title="Compatibility Matrix" class="md-nav__link">
      Compatibility Matrix
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../about/license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../about/release-notes/" title="Release Notes" class="md-nav__link">
      Release Notes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#beam-module-structure" class="md-nav__link">
    Beam Module Structure
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-our-first-table" class="md-nav__link">
    Defining our first table
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#teaching-beam-about-our-table" class="md-nav__link">
    Teaching Beam about our table
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-our-database" class="md-nav__link">
    Defining our database
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-users-to-our-database" class="md-nav__link">
    Adding users to our database
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#querying-the-database" class="md-nav__link">
    Querying the database
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregations" class="md-nav__link">
    Aggregations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    Conclusion
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/haskell-beam/beam/edit/master/docs/tutorials/tutorial1.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z" /></svg>
                  </a>
                
                
                  
                
                
                  <h1>Part 1</h1>
                
                <p>In this tutorial sequence, we'll walk through creating a schema for a simple
shopping cart database. We'll start by defining a user table. Then, we'll show
how beam makes it easy to manipulate data in our database. Finally, we'll
demonstrate how beam lets us declare type-safe and composable queries.</p>
<h2 id="beam-module-structure">Beam Module Structure</h2>
<p>Beam makes extensive use of GHC's Generics mechanism. This extension means beam does not need to
rely on template haskell.</p>
<p>To start defining beam schemas and queries, you only need to import the
<code>Database.Beam</code> module. To interface with an actual database, you'll need to
import one of the database backends. We'll see how to use the Sqlite backend
here (found in the <code>beam-sqlite</code> package). Now, open up a GHCi prompt for us to
use. Make sure to get the <code>beam-core</code>, <code>beam-sqlite</code> and <code>text</code> packages.</p>
<div class="codehilite"><pre><span></span><code><span class="gp">$ </span>stack repl --package beam-core --package beam-sqlite --package sqlite-simple --package beam-migrate --package text
</code></pre></div>

<p>This will put you into a GHCi prompt with the <code>beam-core</code> and <code>beam-sqlite</code>
packages available. We also include the <code>sqlite-simple</code> package. Beam mainly
manages querying and data marshalling. Connections to the backends are done via
backend specific packages. In this case, <code>beam-sqlite</code> uses the <code>sqlite-simple</code>
backend.</p>
<p>Before starting, we'll need to enable some extensions.</p>
<div class="codehilite"><pre><span></span><code><span class="o">&gt;</span> <span class="p">:</span><span class="n">set</span> <span class="o">-</span><span class="n">XDeriveGeneric</span> <span class="o">-</span><span class="n">XGADTs</span> <span class="o">-</span><span class="n">XOverloadedStrings</span> <span class="o">-</span><span class="n">XFlexibleContexts</span> <span class="o">-</span><span class="n">XFlexibleInstances</span> <span class="o">-</span><span class="n">XTypeFamilies</span> <span class="o">-</span><span class="n">XTypeApplications</span> <span class="o">-</span><span class="n">XDeriveAnyClass</span>
</code></pre></div>

<p>And import some modules...</p>
<div class="codehilite"><pre><span></span><code><span class="kr">import</span> <span class="nn">Database.Beam</span>
<span class="kr">import</span> <span class="nn">Database.Beam.Sqlite</span>

<span class="kr">import</span> <span class="nn">Data.Text</span> <span class="p">(</span><span class="kt">Text</span><span class="p">)</span>
</code></pre></div>

<h2 id="defining-our-first-table">Defining our first table</h2>
<p>Beam tables are regular Haskell data types with a bit of scaffolding. Thankfully, the magic of the
modern Haskell type system allows us to remove the overhead and the syntactic fuzz of the
scaffolding in most situations.</p>
<p>We start by declaring a data structure named <code>UserT</code>. As a matter of convention, Beam table types
are suffixed with 'T'. Table types have only one constructor. Again, as a matter of convention, the
constructor has the same name as the table, but without the 'T' suffix. We'll soon see the reason
for this convention.</p>
<p>In this tutorial, I'll prefix all record selectors with an underscore. This is a matter of personal
preference. One reason for the prefix is that it plays nicely with the <code>lens</code> library. Beam does not
necessitate the use of <code>lens</code> (in fact Beam includes its own mechanism to generically derive van
Laarhoven lenses), but I recognize that some programmers use <code>lens</code> quite a lot.</p>
<div class="codehilite"><pre><span></span><code><span class="kr">data</span> <span class="kt">UserT</span> <span class="n">f</span>
    <span class="ow">=</span> <span class="kt">User</span>
    <span class="p">{</span> <span class="n">_userEmail</span>     <span class="ow">::</span> <span class="kt">Columnar</span> <span class="n">f</span> <span class="kt">Text</span>
    <span class="p">,</span> <span class="n">_userFirstName</span> <span class="ow">::</span> <span class="kt">Columnar</span> <span class="n">f</span> <span class="kt">Text</span>
    <span class="p">,</span> <span class="n">_userLastName</span>  <span class="ow">::</span> <span class="kt">Columnar</span> <span class="n">f</span> <span class="kt">Text</span>
    <span class="p">,</span> <span class="n">_userPassword</span>  <span class="ow">::</span> <span class="kt">Columnar</span> <span class="n">f</span> <span class="kt">Text</span> <span class="p">}</span>
    <span class="kr">deriving</span> <span class="kt">Generic</span>
</code></pre></div>

<p>This data type might look very complicated, so I'd like to show you that it's not that scary. Let's
see if we can use GHCi to help us.</p>
<div class="codehilite"><pre><span></span><code><span class="n">Prelude</span> <span class="n">Database</span><span class="p">.</span><span class="n">Beam</span><span class="p">.</span><span class="n">Sqlite</span> <span class="n">Database</span><span class="p">.</span><span class="n">Beam</span> <span class="n">Data</span><span class="p">.</span><span class="n">Text</span><span class="o">&gt;</span> <span class="o">:</span><span class="n">t</span> <span class="n">User</span>
<span class="n">User</span>
  <span class="o">::</span> <span class="n">Columnar</span> <span class="n">f</span> <span class="n">Text</span>
     <span class="o">-&gt;</span> <span class="n">Columnar</span> <span class="n">f</span> <span class="n">Text</span> <span class="o">-&gt;</span> <span class="n">Columnar</span> <span class="n">f</span> <span class="n">Text</span> <span class="o">-&gt;</span> <span class="n">Columnar</span> <span class="n">f</span> <span class="n">Text</span> <span class="o">-&gt;</span> <span class="n">UserT</span> <span class="n">f</span>
</code></pre></div>

<p>Hmm... That did not help much. Let's see what happens if we bind <code>f</code> to something concrete, like <code>Identity</code>. Using the <code>TypeApplications</code> extension:</p>
<div class="codehilite"><pre><span></span><code><span class="n">Prelude</span><span class="w"> </span><span class="k">Database</span><span class="p">.</span><span class="n">Beam</span><span class="w"> </span><span class="k">Database</span><span class="p">.</span><span class="n">Beam</span><span class="p">.</span><span class="n">Sqlite</span><span class="w"> </span><span class="k">Data</span><span class="p">.</span><span class="nc">Text</span><span class="o">&gt;</span><span class="w"> </span><span class="err">:</span><span class="n">t</span><span class="w"> </span><span class="p">(</span><span class="k">User</span><span class="w"> </span><span class="nv">@Identity</span><span class="p">)</span><span class="w"></span>
<span class="p">(</span><span class="k">User</span><span class="w"> </span><span class="nv">@Identity</span><span class="p">)</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="nc">Text</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Text</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Text</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Text</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">UserT</span><span class="w"> </span><span class="k">Identity</span><span class="w"></span>
</code></pre></div>

<p>Woah! That looks a lot like what we'd expect if we had declared the type in the "regular" Haskell way:</p>
<div class="codehilite"><pre><span></span><code><span class="kr">data</span> <span class="kt">User</span> <span class="ow">=</span> <span class="kt">User</span>
          <span class="p">{</span> <span class="n">_userEmail</span>     <span class="ow">::</span> <span class="kt">Text</span>
          <span class="p">,</span> <span class="n">_userFirstName</span> <span class="ow">::</span> <span class="kt">Text</span>
          <span class="p">,</span> <span class="n">_userLastName</span>  <span class="ow">::</span> <span class="kt">Text</span>
          <span class="p">,</span> <span class="n">_userPassword</span>  <span class="ow">::</span> <span class="kt">Text</span> <span class="p">}</span>
</code></pre></div>

<p>This functionality is due to the fact that <code>Columnar</code> is a type family defined
such that for any <code>x</code>, <code>Columnar Identity x = x</code>. This strategy is known as
<em>defunctionalization</em> <sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup> or <em>higher-kinded data types</em> <sup id="fnref:4"><a class="footnote-ref" href="#fn:4">2</a></sup>.</p>
<p>Knowing this, let's define a type synonym to make our life easier.</p>
<div class="codehilite"><pre><span></span><code><span class="kr">type</span> <span class="kt">User</span> <span class="ow">=</span> <span class="kt">UserT</span> <span class="kt">Identity</span>
<span class="kr">type</span> <span class="kt">UserId</span> <span class="ow">=</span> <span class="kt">PrimaryKey</span> <span class="kt">UserT</span> <span class="kt">Identity</span>
</code></pre></div>

<p>Now you can see why we named the type of the table <code>UserT</code> and its constructor
<code>User</code>. This allows us to use the "regular" <code>User</code> constructor to construct
values of type <code>User</code>. We can use the <code>StandaloneDeriving</code> and
<code>TypeSynonymInstances</code> extensions to derive instances of <code>Show</code> and <code>Eq</code> for the
'regular' datatype.</p>
<div class="codehilite"><pre><span></span><code>&gt; :set -XStandaloneDeriving -XTypeSynonymInstances -XMultiParamTypeClasses
</code></pre></div>

<p>Now we can derive <code>Show</code> and <code>Eq</code> instances.</p>
<div class="codehilite"><pre><span></span><code><span class="kr">deriving</span> <span class="kr">instance</span> <span class="kt">Show</span> <span class="kt">User</span>
<span class="kr">deriving</span> <span class="kr">instance</span> <span class="kt">Eq</span> <span class="kt">User</span>
</code></pre></div>

<p>Note that this does require us to use an explicit type signature where we
otherwise wouldn't. For example,</p>
<div class="codehilite"><pre><span></span><code><span class="kt">Prelude</span> <span class="kt">Database</span><span class="o">.</span><span class="kt">Beam</span><span class="o">.</span><span class="kt">Sqlite</span> <span class="kt">Database</span><span class="o">.</span><span class="kt">Beam</span> <span class="kt">Data</span><span class="o">.</span><span class="kt">Text</span><span class="o">&gt;</span> <span class="kt">User</span> <span class="s">&quot;john@example.com&quot;</span> <span class="s">&quot;John&quot;</span> <span class="s">&quot;Smith&quot;</span> <span class="s">&quot;password!&quot;</span>

<span class="o">&lt;</span><span class="n">interactive</span><span class="o">&gt;:</span><span class="mi">46</span><span class="kt">:</span><span class="mi">2</span><span class="kt">:</span> <span class="ne">error</span><span class="kt">:</span>
    <span class="o">*</span> <span class="kt">No</span> <span class="kr">instance</span> <span class="n">for</span> <span class="p">(</span><span class="kt">Show</span> <span class="p">(</span><span class="kt">UserT</span> <span class="n">f0</span><span class="p">))</span> <span class="n">arising</span> <span class="n">from</span> <span class="n">a</span> <span class="n">use</span> <span class="kr">of</span> <span class="err">‘</span><span class="n">print</span><span class="err">’</span>
    <span class="o">*</span> <span class="kt">In</span> <span class="n">a</span> <span class="n">stmt</span> <span class="kr">of</span> <span class="n">an</span> <span class="n">interactive</span> <span class="kt">GHCi</span> <span class="n">command</span><span class="kt">:</span> <span class="n">print</span> <span class="n">it</span>
</code></pre></div>

<p>Here, GHC is complaining that it cannot infer the type of the <code>f</code> parameter
based on the values we've supplied. This is because the <code>Columnar</code> type family
is non-injective. However, an explicit type annotation fixes it all up.</p>
<div class="codehilite"><pre><span></span><code><span class="n">Prelude</span><span class="w"> </span><span class="k">Database</span><span class="p">.</span><span class="n">Beam</span><span class="p">.</span><span class="n">Sqlite</span><span class="w"> </span><span class="k">Database</span><span class="p">.</span><span class="n">Beam</span><span class="w"> </span><span class="k">Data</span><span class="p">.</span><span class="nc">Text</span><span class="o">&gt;</span><span class="w"> </span><span class="k">User</span><span class="w"> </span><span class="ss">&quot;john@example.com&quot;</span><span class="w"> </span><span class="ss">&quot;John&quot;</span><span class="w"> </span><span class="ss">&quot;Smith&quot;</span><span class="w"> </span><span class="ss">&quot;password!&quot;</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="k">User</span><span class="w"></span>
<span class="k">User</span><span class="w"> </span><span class="err">{</span><span class="n">_userEmail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;john@example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userFirstName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;John&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userLastName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Smith&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userPassword</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;password!&quot;</span><span class="err">}</span><span class="w"></span>
</code></pre></div>

<p>You can also use type applications, if you like that style better:</p>
<div class="codehilite"><pre><span></span><code><span class="n">Prelude</span><span class="w"> </span><span class="k">Database</span><span class="p">.</span><span class="n">Beam</span><span class="w"> </span><span class="k">Database</span><span class="p">.</span><span class="n">Beam</span><span class="p">.</span><span class="n">Sqlite</span><span class="w"> </span><span class="k">Data</span><span class="p">.</span><span class="nc">Text</span><span class="o">&gt;</span><span class="w"> </span><span class="k">User</span><span class="w"> </span><span class="nv">@Identity</span><span class="w"> </span><span class="ss">&quot;john@example.com&quot;</span><span class="w"> </span><span class="ss">&quot;John&quot;</span><span class="w"> </span><span class="ss">&quot;Smith&quot;</span><span class="w"> </span><span class="ss">&quot;password!&quot;</span><span class="w"></span>
<span class="k">User</span><span class="w"> </span><span class="err">{</span><span class="n">_userEmail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;john@example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userFirstName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;John&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userLastName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Smith&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userPassword</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;password!&quot;</span><span class="err">}</span><span class="w"></span>
</code></pre></div>

<p>Usually, you won't need to deal with this, as you'll explicitly annotate your
top-level functions to use the <code>User</code> type.</p>
<h2 id="teaching-beam-about-our-table">Teaching Beam about our table</h2>
<p>We've defined a type that can represent the data in our table. Now, let's
inform beam that we'd like to use <code>UserT</code> as a table.</p>
<p>All beam tables need to implement the <code>Beamable</code> type class. Due to GHC's
DeriveGeneric and DefaultSignatures extensions, all these methods can be written
for us by the compiler at compile-time!</p>
<div class="codehilite"><pre><span></span><code><span class="kr">instance</span> <span class="kt">Beamable</span> <span class="kt">UserT</span>
</code></pre></div>

<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you turn on the <code>DeriveAnyClass</code> feature, you can simply <code>derive</code> the <code>Beamable</code> type class. For example, the type</p>
<p><code>data UserT f
    = User
    { _userEmail     :: Columnar f Text
    , _userFirstName :: Columnar f Text
    , _userLastName  :: Columnar f Text
    , _userPassword  :: Columnar f Text }
    deriving Generic</code></p>
<p>could be written</p>
<p><code>data UserT f
    = User
    { _userEmail     :: Columnar f Text
    , _userFirstName :: Columnar f Text
    , _userLastName  :: Columnar f Text
    , _userPassword  :: Columnar f Text }
    deriving (Generic, Beamable)</code></p>
</div>
<p>Additionally, all beam tables must implement the <code>Table</code> type class, which we
can use to declare a primary key.</p>
<p>The only thing we need to provide is the type of the primary keys for users, and
a function that can extract the primary key from any <code>UserT f</code> object. To do
this, add the following lines to the instance declaration.</p>
<div class="codehilite"><pre><span></span><code>instance Table UserT where
   data PrimaryKey UserT f = UserId (Columnar f Text) deriving (Generic, Beamable)
   primaryKey = UserId . _userEmail
</code></pre></div>

<p>The <code>data</code> declaration is similar to a toplevel data definition, construct a key
for <code>UserT</code> with the <code>UserId</code> constructor like a regular table.</p>
<div class="codehilite"><pre><span></span><code><span class="nf">userKey</span> <span class="ow">=</span> <span class="kt">UserId</span> <span class="s">&quot;john@doe.org&quot;</span>
</code></pre></div>

<h2 id="defining-our-database">Defining our database</h2>
<p>Now that we have our table, we're going to define a type to hold information about our
database. Defining our database is going to follow the same pattern as defining a table. We'll
define a higher-kinded datatype and then declare an instance of <code>Database</code>, and let the compiler
figure most of it out.</p>
<p>Tables are a collection of <code>Columnar</code> values. Databases are a collection of
entities, such as tables. Many database systems can also hold other entities
(such as views, domain types, etc). Beam allows you to declare these as well <sup id="fnref:2"><a class="footnote-ref" href="#fn:2">3</a></sup>.</p>
<p>Our database consists of only one table.</p>
<div class="codehilite"><pre><span></span><code><span class="kr">data</span> <span class="kt">ShoppingCartDb</span> <span class="n">f</span> <span class="ow">=</span> <span class="kt">ShoppingCartDb</span>
                      <span class="p">{</span> <span class="n">_shoppingCartUsers</span> <span class="ow">::</span> <span class="n">f</span> <span class="p">(</span><span class="kt">TableEntity</span> <span class="kt">UserT</span><span class="p">)</span> <span class="p">}</span>
                        <span class="kr">deriving</span> <span class="p">(</span><span class="kt">Generic</span><span class="p">,</span> <span class="kt">Database</span> <span class="n">be</span><span class="p">)</span>
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By deriving <code>Database be</code> we actually allowed our database to be used with any Beam
backend that supports it. We could also have explicitly listed the database backends we
liked. For example, specifying <code>deriving (Generic, Database Sqlite, Database Postgres)</code> would
derive instances only for SQLite or Postgres.</p>
</div>
<p>The next step is to create a description of the particular database we'd like to create. This
involves giving each of the tables in our database a name. If you've named all your database
selectors using camel case, beam can automatically figure out what all the table names should be. If
you haven't, or you have multiple tables holding the same type in your database, you might have to
manually name your tables. For now, we'll let beam do the hard work <sup id="fnref:3"><a class="footnote-ref" href="#fn:3">4</a></sup>.</p>
<div class="codehilite"><pre><span></span><code><span class="nf">shoppingCartDb</span> <span class="ow">::</span> <span class="kt">DatabaseSettings</span> <span class="n">be</span> <span class="kt">ShoppingCartDb</span>
<span class="nf">shoppingCartDb</span> <span class="ow">=</span> <span class="n">defaultDbSettings</span>
</code></pre></div>

<h2 id="adding-users-to-our-database">Adding users to our database</h2>
<p>Let's add some users to our database. As we said above, beam is
backend-agnostic. However, backend integration libraries are maintained in the
official beam repository. The <code>beam-sqlite</code> package offers straightforwards
integration with the <code>sqlite-simple</code> library.</p>
<p>First, let's create a sqlite3 database with the right schema. Open up terminal, and do</p>
<div class="codehilite"><pre><span></span><code><span class="gp">$ </span>sqlite3 shoppingcart1.db
<span class="go">SQLite version 3.14.0 2016-07-26 15:17:14</span>
<span class="go">Enter &quot;.help&quot; for usage hints.</span>
<span class="go">sqlite&gt; CREATE TABLE cart_users (email VARCHAR NOT NULL, first_name VARCHAR NOT NULL, last_name VARCHAR NOT NULL, password VARCHAR NOT NULL, PRIMARY KEY( email ));</span>
<span class="go">sqlite&gt;</span>
</code></pre></div>

<p>Now, let's open the database in Haskell.</p>
<div class="codehilite"><pre><span></span><code><span class="kr">import</span> <span class="nn">Database.SQLite.Simple</span>

<span class="nf">conn</span> <span class="ow">&lt;-</span> <span class="n">open</span> <span class="s">&quot;shoppingcart1.db&quot;</span>
</code></pre></div>

<p>Now let's add a few users. We'll give each user an MD5 encoded password too.
We'll use the <code>runBeamSqliteDebug</code> function (supplied by <code>beam-sqlite</code>) to
output the statements that beam would normally run. In production, you'd use the
<code>runBeamSqlite</code> function, or use the backend integration packages to directly
use the underlying backend library.</p>
<div class="codehilite"><pre><span></span><code><span class="nf">runBeamSqliteDebug</span> <span class="n">putStrLn</span> <span class="cm">{- for debug output -}</span> <span class="n">conn</span> <span class="o">$</span> <span class="n">runInsert</span> <span class="o">$</span>
<span class="nf">insert</span> <span class="p">(</span><span class="n">_shoppingCartUsers</span> <span class="n">shoppingCartDb</span><span class="p">)</span> <span class="o">$</span>
<span class="nf">insertValues</span> <span class="p">[</span> <span class="kt">User</span> <span class="s">&quot;james@example.com&quot;</span> <span class="s">&quot;James&quot;</span> <span class="s">&quot;Smith&quot;</span> <span class="s">&quot;b4cc344d25a2efe540adbf2678e2304c&quot;</span> <span class="cm">{- james -}</span>
             <span class="p">,</span> <span class="kt">User</span> <span class="s">&quot;betty@example.com&quot;</span> <span class="s">&quot;Betty&quot;</span> <span class="s">&quot;Jones&quot;</span> <span class="s">&quot;82b054bd83ffad9b6cf8bdb98ce3cc2f&quot;</span> <span class="cm">{- betty -}</span>
             <span class="p">,</span> <span class="kt">User</span> <span class="s">&quot;sam@example.com&quot;</span> <span class="s">&quot;Sam&quot;</span> <span class="s">&quot;Taylor&quot;</span> <span class="s">&quot;332532dcfaa1cbf61e2a266bd723612c&quot;</span> <span class="cm">{- sam -}</span> <span class="p">]</span>
</code></pre></div>

<p>The <code>runInsert</code> function runs an insert statement, which we construct using the
<code>insert</code> function. Since we're inserting concrete values, we use the
<code>insertValues</code> function to supply the values. We can also use the
<code>insertExpressions</code> function to insert arbitrary SQL expressions, or the
<code>insertFrom</code> to insert the results of an arbitrary select (the <code>INSERT INTO ..
SELECT ..</code> syntax).</p>
<p>Because we're in debug mode, we'll see the SQL that beam is running:</p>
<div class="codehilite"><pre><span></span><code><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="ss">&quot;cart_users&quot;</span><span class="p">(</span><span class="ss">&quot;email&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;first_name&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;last_name&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;password&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="vm">?</span><span class="p">,</span><span class="w"> </span><span class="vm">?</span><span class="p">,</span><span class="w"> </span><span class="vm">?</span><span class="p">,</span><span class="w"> </span><span class="vm">?</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="vm">?</span><span class="p">,</span><span class="w"> </span><span class="vm">?</span><span class="p">,</span><span class="w"> </span><span class="vm">?</span><span class="p">,</span><span class="w"> </span><span class="vm">?</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="vm">?</span><span class="p">,</span><span class="w"> </span><span class="vm">?</span><span class="p">,</span><span class="w"> </span><span class="vm">?</span><span class="p">,</span><span class="w"> </span><span class="vm">?</span><span class="p">)</span><span class="w"></span>
<span class="c1">-- With values: [SQLText &quot;james@example.com&quot;,SQLText &quot;James&quot;,SQLText &quot;Smith&quot;,SQLText &quot;b4cc344d25a2efe540adbf2678e2304c&quot;,SQLText &quot;betty@example.com&quot;,SQLText &quot;Betty&quot;,SQLText &quot;Jones&quot;,SQLText &quot;82b054bd83ffad9b6cf8bdb98ce3cc2f&quot;,SQLText &quot;sam@example.com&quot;,SQLText &quot;Sam&quot;,SQLText &quot;Taylor&quot;,SQLText &quot;332532dcfaa1cbf61e2a266bd723612c&quot;]</span>
</code></pre></div>

<p>The <code>?</code> represent the values passed to the database (beam uses the backend's
value interpolation to avoid SQL injection attacks).</p>
<h2 id="querying-the-database">Querying the database</h2>
<p>Now let's write some queries for the database. Let's get all the users we just
added. Click between the tabs to see the SQL and console output generated</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item">
            <a href="#tab-0-Haskell" aria-controls="tab-0-Haskell" role="tab" data-toggle="tab" data-lang="haskell">Haskell</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-0-Sql" aria-controls="tab-0-Sql" role="tab" data-toggle="tab" data-lang="sql">Sql</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-0-Output" aria-controls="tab-0-Output" role="tab" data-toggle="tab" data-lang="output">Output</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-0-Haskell">
            <div class="codehilite"><pre><span></span><code><span class="kr">let</span> <span class="n">allUsers</span> <span class="ow">=</span> <span class="n">all_</span> <span class="p">(</span><span class="n">_shoppingCartUsers</span> <span class="n">shoppingCartDb</span><span class="p">)</span>

<span class="nf">runBeamSqliteDebug</span> <span class="n">putStrLn</span> <span class="n">conn</span> <span class="o">$</span> <span class="kr">do</span>
  <span class="n">users</span> <span class="ow">&lt;-</span> <span class="n">runSelectReturningList</span> <span class="o">$</span> <span class="n">select</span> <span class="n">allUsers</span>
  <span class="n">mapM_</span> <span class="p">(</span><span class="n">liftIO</span> <span class="o">.</span> <span class="n">putStrLn</span> <span class="o">.</span> <span class="n">show</span><span class="p">)</span> <span class="n">users</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-0-Sql">
            <div class="codehilite"><pre><span></span><code><span class="k">SELECT</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;email&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;first_name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;last_name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res2&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;password&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res3&quot;</span>
<span class="k">FROM</span> <span class="ss">&quot;cart_users&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span><span class="p">;</span>

<span class="c1">-- With values: []</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-0-Output">
            <div class="codehilite"><pre><span></span><code><span class="k">User</span><span class="w"> </span><span class="err">{</span><span class="n">_userEmail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;james@example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userFirstName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;James&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userLastName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Smith&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userPassword</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;b4cc344d25a2efe540adbf2678e2304c&quot;</span><span class="err">}</span><span class="w"></span>
<span class="k">User</span><span class="w"> </span><span class="err">{</span><span class="n">_userEmail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;betty@example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userFirstName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Betty&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userLastName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Jones&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userPassword</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;82b054bd83ffad9b6cf8bdb98ce3cc2f&quot;</span><span class="err">}</span><span class="w"></span>
<span class="k">User</span><span class="w"> </span><span class="err">{</span><span class="n">_userEmail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;sam@example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userFirstName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Sam&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userLastName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Taylor&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userPassword</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;332532dcfaa1cbf61e2a266bd723612c&quot;</span><span class="err">}</span><span class="w"></span>
</code></pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code>--</code> at the ends of the console output lines are an artifact of the
documentation build process. They won't appear in your console.</p>
</div>
<p>Next let's suppose you wanted to sort the users into order by their first name,
and then descending by their last name. We can use the <code>orderBy_</code> function to
order the query results. This is similar to the <code>sortBy</code> function for lists.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item">
            <a href="#tab-1-Haskell" aria-controls="tab-1-Haskell" role="tab" data-toggle="tab" data-lang="haskell">Haskell</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-1-Sql" aria-controls="tab-1-Sql" role="tab" data-toggle="tab" data-lang="sql">Sql</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-1-Output" aria-controls="tab-1-Output" role="tab" data-toggle="tab" data-lang="output">Output</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-1-Haskell">
            <div class="codehilite"><pre><span></span><code><span class="kr">let</span> <span class="n">sortUsersByFirstName</span> <span class="ow">=</span> <span class="n">orderBy_</span> <span class="p">(</span><span class="nf">\</span><span class="n">u</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">asc_</span> <span class="p">(</span><span class="n">_userFirstName</span> <span class="n">u</span><span class="p">),</span> <span class="n">desc_</span> <span class="p">(</span><span class="n">_userLastName</span> <span class="n">u</span><span class="p">)))</span> <span class="p">(</span><span class="n">all_</span> <span class="p">(</span><span class="n">_shoppingCartUsers</span> <span class="n">shoppingCartDb</span><span class="p">))</span>

<span class="nf">runBeamSqliteDebug</span> <span class="n">putStrLn</span> <span class="n">conn</span> <span class="o">$</span> <span class="kr">do</span>
  <span class="n">users</span> <span class="ow">&lt;-</span> <span class="n">runSelectReturningList</span> <span class="o">$</span> <span class="n">select</span> <span class="n">sortUsersByFirstName</span>
  <span class="n">mapM_</span> <span class="p">(</span><span class="n">liftIO</span> <span class="o">.</span> <span class="n">putStrLn</span> <span class="o">.</span> <span class="n">show</span><span class="p">)</span> <span class="n">users</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-1-Sql">
            <div class="codehilite"><pre><span></span><code><span class="k">SELECT</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;email&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;first_name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;last_name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res2&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;password&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res3&quot;</span>
<span class="k">FROM</span> <span class="ss">&quot;cart_users&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;first_name&quot;</span> <span class="k">ASC</span><span class="p">,</span>
         <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;last_name&quot;</span> <span class="k">DESC</span><span class="p">;</span>

<span class="c1">-- With values: []</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-1-Output">
            <div class="codehilite"><pre><span></span><code><span class="k">User</span><span class="w"> </span><span class="err">{</span><span class="n">_userEmail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;betty@example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userFirstName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Betty&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userLastName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Jones&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userPassword</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;82b054bd83ffad9b6cf8bdb98ce3cc2f&quot;</span><span class="err">}</span><span class="w"></span>
<span class="k">User</span><span class="w"> </span><span class="err">{</span><span class="n">_userEmail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;james@example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userFirstName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;James&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userLastName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Smith&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userPassword</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;b4cc344d25a2efe540adbf2678e2304c&quot;</span><span class="err">}</span><span class="w"></span>
<span class="k">User</span><span class="w"> </span><span class="err">{</span><span class="n">_userEmail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;sam@example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userFirstName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Sam&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userLastName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Taylor&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userPassword</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;332532dcfaa1cbf61e2a266bd723612c&quot;</span><span class="err">}</span><span class="w"></span>
</code></pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<p>We can use <code>limit_</code> and <code>offset_</code> in a similar manner to <code>take</code> and <code>drop</code> respectively.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item">
            <a href="#tab-2-Haskell" aria-controls="tab-2-Haskell" role="tab" data-toggle="tab" data-lang="haskell">Haskell</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-2-Sql" aria-controls="tab-2-Sql" role="tab" data-toggle="tab" data-lang="sql">Sql</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-2-Output" aria-controls="tab-2-Output" role="tab" data-toggle="tab" data-lang="output">Output</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-2-Haskell">
            <div class="codehilite"><pre><span></span><code><span class="kr">let</span> <span class="n">boundedQuery</span> <span class="ow">=</span> <span class="n">limit_</span> <span class="mi">1</span> <span class="o">$</span> <span class="n">offset_</span> <span class="mi">1</span> <span class="o">$</span>
                   <span class="n">orderBy_</span> <span class="p">(</span><span class="n">asc_</span> <span class="o">.</span> <span class="n">_userFirstName</span><span class="p">)</span> <span class="o">$</span>
                   <span class="n">all_</span> <span class="p">(</span><span class="n">_shoppingCartUsers</span> <span class="n">shoppingCartDb</span><span class="p">)</span>

<span class="nf">runBeamSqliteDebug</span> <span class="n">putStrLn</span> <span class="n">conn</span> <span class="o">$</span> <span class="kr">do</span>
  <span class="n">users</span> <span class="ow">&lt;-</span> <span class="n">runSelectReturningList</span> <span class="p">(</span><span class="n">select</span> <span class="n">boundedQuery</span><span class="p">)</span>
  <span class="n">mapM_</span> <span class="p">(</span><span class="n">liftIO</span> <span class="o">.</span> <span class="n">putStrLn</span> <span class="o">.</span> <span class="n">show</span><span class="p">)</span> <span class="n">users</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-2-Sql">
            <div class="codehilite"><pre><span></span><code><span class="k">SELECT</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;email&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;first_name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;last_name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res2&quot;</span><span class="p">,</span>
       <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;password&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res3&quot;</span>
<span class="k">FROM</span> <span class="ss">&quot;cart_users&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;first_name&quot;</span> <span class="k">ASC</span>
<span class="k">LIMIT</span> <span class="mi">1</span>
<span class="k">OFFSET</span> <span class="mi">1</span><span class="p">;</span>

<span class="c1">-- With values: []</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-2-Output">
            <div class="codehilite"><pre><span></span><code><span class="k">User</span><span class="w"> </span><span class="err">{</span><span class="n">_userEmail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;james@example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userFirstName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;James&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userLastName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Smith&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_userPassword</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;b4cc344d25a2efe540adbf2678e2304c&quot;</span><span class="err">}</span><span class="w"></span>
</code></pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<h2 id="aggregations">Aggregations</h2>
<p>Sometimes we also want to group our data together and perform calculations over
the groups of data. SQL calls these aggregations.</p>
<p>The simplest aggregation is counting. We use the <code>aggregate_</code> function to create
aggregations. For example, to count all users, we can use the <code>countAll_</code>
aggregation. We also use the <code>runSelectReturningOne</code> function to get at most one
record from the database.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item">
            <a href="#tab-3-Haskell" aria-controls="tab-3-Haskell" role="tab" data-toggle="tab" data-lang="haskell">Haskell</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-3-Sql" aria-controls="tab-3-Sql" role="tab" data-toggle="tab" data-lang="sql">Sql</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-3-Output" aria-controls="tab-3-Output" role="tab" data-toggle="tab" data-lang="output">Output</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-3-Haskell">
            <div class="codehilite"><pre><span></span><code><span class="kr">let</span> <span class="n">userCount</span> <span class="ow">=</span> <span class="n">aggregate_</span> <span class="p">(</span><span class="nf">\</span><span class="n">u</span> <span class="ow">-&gt;</span> <span class="n">as_</span> <span class="o">@</span><span class="kt">Int32</span> <span class="n">countAll_</span><span class="p">)</span> <span class="p">(</span><span class="n">all_</span> <span class="p">(</span><span class="n">_shoppingCartUsers</span> <span class="n">shoppingCartDb</span><span class="p">))</span>

<span class="nf">runBeamSqliteDebug</span> <span class="n">putStrLn</span> <span class="n">conn</span> <span class="o">$</span> <span class="kr">do</span>
  <span class="kt">Just</span> <span class="n">c</span> <span class="ow">&lt;-</span> <span class="n">runSelectReturningOne</span> <span class="o">$</span> <span class="n">select</span> <span class="n">userCount</span>
  <span class="n">liftIO</span> <span class="o">$</span> <span class="n">putStrLn</span> <span class="p">(</span><span class="s">&quot;We have &quot;</span> <span class="o">++</span> <span class="n">show</span> <span class="n">c</span> <span class="o">++</span> <span class="s">&quot; users in the database&quot;</span><span class="p">)</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-3-Sql">
            <div class="codehilite"><pre><span></span><code><span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span>
<span class="k">FROM</span> <span class="ss">&quot;cart_users&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span><span class="p">;</span>

<span class="c1">-- With values: []</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-3-Output">
            <div class="codehilite"><pre><span></span><code>We have 3 users in the database
</code></pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code>countAll_</code> is happy to unmarshal into any <code>Integral</code> type, so we use <code>as_</code>
to constrain the type to <code>Int32</code>.</p>
</div>
<p>Maybe we'd like something a little more interesting, such as the number of users
for each unique first name. We can also express these aggregations using the
<code>aggregate_</code> function. In order to get interesting results, we'll need to add
more users to our database.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item">
            <a href="#tab-4-Haskell" aria-controls="tab-4-Haskell" role="tab" data-toggle="tab" data-lang="haskell">Haskell</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-4-Sql" aria-controls="tab-4-Sql" role="tab" data-toggle="tab" data-lang="sql">Sql</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-4-Haskell">
            <div class="codehilite"><pre><span></span><code><span class="nf">runBeamSqliteDebug</span> <span class="n">putStrLn</span> <span class="n">conn</span> <span class="o">$</span>
  <span class="n">runInsert</span> <span class="o">$</span>
  <span class="n">insert</span> <span class="p">(</span><span class="n">_shoppingCartUsers</span> <span class="n">shoppingCartDb</span><span class="p">)</span> <span class="o">$</span>
  <span class="n">insertValues</span> <span class="p">[</span> <span class="kt">User</span> <span class="s">&quot;james@pallo.com&quot;</span> <span class="s">&quot;James&quot;</span> <span class="s">&quot;Pallo&quot;</span> <span class="s">&quot;b4cc344d25a2efe540adbf2678e2304c&quot;</span> <span class="cm">{- james -}</span>
               <span class="p">,</span> <span class="kt">User</span> <span class="s">&quot;betty@sims.com&quot;</span> <span class="s">&quot;Betty&quot;</span> <span class="s">&quot;Sims&quot;</span> <span class="s">&quot;82b054bd83ffad9b6cf8bdb98ce3cc2f&quot;</span> <span class="cm">{- betty -}</span>
               <span class="p">,</span> <span class="kt">User</span> <span class="s">&quot;james@oreily.com&quot;</span> <span class="s">&quot;James&quot;</span> <span class="s">&quot;O&#39;Reily&quot;</span> <span class="s">&quot;b4cc344d25a2efe540adbf2678e2304c&quot;</span> <span class="cm">{- james -}</span>
               <span class="p">,</span> <span class="kt">User</span> <span class="s">&quot;sam@sophitz.com&quot;</span> <span class="s">&quot;Sam&quot;</span> <span class="s">&quot;Sophitz&quot;</span> <span class="s">&quot;332532dcfaa1cbf61e2a266bd723612c&quot;</span> <span class="cm">{- sam -}</span>
               <span class="p">,</span> <span class="kt">User</span> <span class="s">&quot;sam@jely.com&quot;</span> <span class="s">&quot;Sam&quot;</span> <span class="s">&quot;Jely&quot;</span> <span class="s">&quot;332532dcfaa1cbf61e2a266bd723612c&quot;</span> <span class="cm">{- sam -}</span> <span class="p">]</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-4-Sql">
            <div class="codehilite"><pre><span></span><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="ss">&quot;cart_users&quot;</span><span class="p">(</span><span class="ss">&quot;email&quot;</span><span class="p">,</span>
                         <span class="ss">&quot;first_name&quot;</span><span class="p">,</span>
                         <span class="ss">&quot;last_name&quot;</span><span class="p">,</span>
                         <span class="ss">&quot;password&quot;</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">),</span>
       <span class="p">(</span><span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">),</span>
       <span class="p">(</span><span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">),</span>
       <span class="p">(</span><span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">),</span>
       <span class="p">(</span><span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">);</span>

<span class="c1">-- With values: [SQLText &quot;james@pallo.com&quot;,SQLText &quot;James&quot;,SQLText &quot;Pallo&quot;,SQLText &quot;b4cc344d25a2efe540adbf2678e2304c&quot;,SQLText &quot;betty@sims.com&quot;,SQLText &quot;Betty&quot;,SQLText &quot;Sims&quot;,SQLText &quot;82b054bd83ffad9b6cf8bdb98ce3cc2f&quot;,SQLText &quot;james@oreily.com&quot;,SQLText &quot;James&quot;,SQLText &quot;O&#39;Reily&quot;,SQLText &quot;b4cc344d25a2efe540adbf2678e2304c&quot;,SQLText &quot;sam@sophitz.com&quot;,SQLText &quot;Sam&quot;,SQLText &quot;Sophitz&quot;,SQLText &quot;332532dcfaa1cbf61e2a266bd723612c&quot;,SQLText &quot;sam@jely.com&quot;,SQLText &quot;Sam&quot;,SQLText &quot;Jely&quot;,SQLText &quot;332532dcfaa1cbf61e2a266bd723612c&quot;]</span>
</code></pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<p>Now we can use <code>aggregate_</code> to both group by a user's first name, and then count
the number of users.</p>
<p>
                <div class="code-nav-container">
                    
        <ul class="nav nav-tabs">
            
        <li class="nav-item">
            <a href="#tab-5-Haskell" aria-controls="tab-5-Haskell" role="tab" data-toggle="tab" data-lang="haskell">Haskell</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-5-Sql" aria-controls="tab-5-Sql" role="tab" data-toggle="tab" data-lang="sql">Sql</a>
        </li>
    
        <li class="nav-item">
            <a href="#tab-5-Output" aria-controls="tab-5-Output" role="tab" data-toggle="tab" data-lang="output">Output</a>
        </li>
    
        </ul>
    
        <div class="tab-content">
            
        <div role="tabpanel" class="tab-pane active" id="tab-5-Haskell">
            <div class="codehilite"><pre><span></span><code><span class="kr">let</span> <span class="n">numberOfUsersByName</span> <span class="ow">=</span> <span class="n">aggregate_</span> <span class="p">(</span><span class="nf">\</span><span class="n">u</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">group_</span> <span class="p">(</span><span class="n">_userFirstName</span> <span class="n">u</span><span class="p">),</span> <span class="n">as_</span> <span class="o">@</span><span class="kt">Int32</span> <span class="n">countAll_</span><span class="p">))</span> <span class="o">$</span>
                          <span class="n">all_</span> <span class="p">(</span><span class="n">_shoppingCartUsers</span> <span class="n">shoppingCartDb</span><span class="p">)</span>

<span class="nf">runBeamSqliteDebug</span> <span class="n">putStrLn</span> <span class="n">conn</span> <span class="o">$</span> <span class="kr">do</span>
  <span class="n">countedByName</span> <span class="ow">&lt;-</span> <span class="n">runSelectReturningList</span> <span class="o">$</span> <span class="n">select</span> <span class="n">numberOfUsersByName</span>
  <span class="n">mapM_</span> <span class="p">(</span><span class="n">liftIO</span> <span class="o">.</span> <span class="n">putStrLn</span> <span class="o">.</span> <span class="n">show</span><span class="p">)</span> <span class="n">countedByName</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-5-Sql">
            <div class="codehilite"><pre><span></span><code><span class="k">SELECT</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;first_name&quot;</span> <span class="k">AS</span> <span class="ss">&quot;res0&quot;</span><span class="p">,</span>
       <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">AS</span> <span class="ss">&quot;res1&quot;</span>
<span class="k">FROM</span> <span class="ss">&quot;cart_users&quot;</span> <span class="k">AS</span> <span class="ss">&quot;t0&quot;</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="ss">&quot;t0&quot;</span><span class="p">.</span><span class="ss">&quot;first_name&quot;</span><span class="p">;</span>

<span class="c1">-- With values: []</span>
</code></pre></div>

        </div>
    
        <div role="tabpanel" class="tab-pane " id="tab-5-Output">
            <div class="codehilite"><pre><span></span><code>(&quot;Betty&quot;,2)
(&quot;James&quot;,3)
(&quot;Sam&quot;,3)
</code></pre></div>

        </div>
    
        </div>
    
                </div>
                    </p>
<h2 id="conclusion">Conclusion</h2>
<p>In this tutorial, we've covered creating a database schema, opening up a beam
database, inserting values into the database, and querying values from them. We
used the knowledge we learned to create a partial shopping cart database that
contains information about users. In the next tutorial, we'll delve deeper into
the some of the query types and show how we can create relations between tables.
We'll also use the monadic query interface to create SQL joins.</p>
<p>Until next time!</p>
<p>If you have any questions about beam, feel free to send them to
travis@athougies.net . Pull requests and bug reports are welcome
on <a href="https://github.com/haskell-beam/beam">GitHub</a>.</p>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>Thanks to various bloggers for pointing this out. You can read more about this technique
   <a href="https://typesandkinds.wordpress.com/2013/04/01/defunctionalization-for-the-win/">here</a>.&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:4">
<p>https://reasonablypolymorphic.com/blog/higher-kinded-data/&#160;<a class="footnote-backref" href="#fnref:4" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
<li id="fn:2">
<p>Adding entities other than tables is covered in more depth in
   the <a href="../../user-guide/databases/">user guide</a>.&#160;<a class="footnote-backref" href="#fnref:2" title="Jump back to footnote 3 in the text">&#8617;</a></p>
</li>
<li id="fn:3">
<p>More on the default naming conventions can be found in
   the <a href="../../user-guide/models/">models section</a> of the user guide. We'll talk
   about how to override defaults in the next sections.&#160;<a class="footnote-backref" href="#fnref:3" title="Jump back to footnote 4 in the text">&#8617;</a></p>
</li>
</ol>
</div>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../../about/faq/" title="Frequently Asked Questions" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Frequently Asked Questions
              </div>
            </div>
          </a>
        
        
          <a href="../tutorial2/" title="Part 2" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Part 2
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4,11V13H16L10.5,18.5L11.92,19.92L19.84,12L11.92,4.08L10.5,5.5L16,11H4Z" /></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    

      <script src="../../assets/javascripts/vendor.36cbf620.min.js"></script>
      <script src="../../assets/javascripts/bundle.00c583dd.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.7f7c8775.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
<script type="text/javascript" language="javascript"  src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
<script type="text/javascript" language="javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script type="text/javascript" language="javascript">
 $(document.body).tab();
 $(".nav-item:first-child").tab("show");
</script>

  </body>
</html>